<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Enhanced - An√°lise Consolidada de Apostas</title>
    <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --color-primary: #6B21A8;
            --color-accent: #9333EA;
            --color-success: #22C55E;
            --color-warning: #F59E0B;
            --color-danger: #EF4444;
            --color-info: #06B6D4;
            --color-bg-dark: #0A0A0A;
            --color-bg-medium: #141414;
            --color-bg-light: #1F1F1F;
            --color-text-primary: #E5E7EB;
            --color-text-secondary: #A1A1AA;
            --color-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Oxanium', sans-serif;
            background: var(--color-bg-dark);
            color: var(--color-text-primary);
            padding: 24px 24px 24px 70px;
            min-height: 100vh;
        }

        .particles {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -1;
            top: 0;
            left: 0;
            opacity: 0.15;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(107, 33, 168, 0.5);
            border-radius: 50%;
            animation: particleFloat 40s infinite linear;
        }

        @keyframes particleFloat {
            0% {
                transform: translateY(0) translateX(0);
                opacity: 0;
            }

            10% {
                opacity: 0.8;
            }

            90% {
                opacity: 0.8;
            }

            100% {
                transform: translateY(-100vh) translateX(30px);
                opacity: 0;
            }
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 70px;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(10px);
            border-right: 1px solid var(--color-border);
            transition: width 0.3s ease;
            z-index: 1000;
            overflow: hidden;
        }

        .sidebar:hover {
            width: 260px;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            padding: 20px 15px;
            gap: 15px;
            border-bottom: 1px solid var(--color-border);
        }

        .sidebar-logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--color-accent), #A855F7);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar:hover .sidebar-title {
            opacity: 1;
        }

        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: var(--color-text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
            gap: 15px;
        }

        .sidebar-menu a:hover {
            background: rgba(107, 33, 168, 0.1);
            color: var(--color-accent);
            transform: translateX(5px);
        }

        .sidebar-menu li.active a {
            background: linear-gradient(90deg, rgba(0, 255, 136, 0.2), transparent);
            color: var(--color-accent);
            border-left: 3px solid var(--color-accent);
        }

        .sidebar-menu .icon {
            font-size: 1.3rem;
            width: 30px;
            text-align: center;
            flex-shrink: 0;
        }

        .sidebar-menu .label {
            opacity: 0;
            transition: opacity 0.3s ease;
            font-weight: 600;
        }

        .sidebar:hover .sidebar-menu .label {
            opacity: 1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--color-bg-medium);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
            padding: 24px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--color-border);
        }

        .header h1 {
            font-size: 28px;
            color: #FFFFFF;
            letter-spacing: 1.5px;
            text-transform: uppercase;
        }

        .nav-buttons {
            display: flex;
            gap: 12px;
        }

        .nav-button {
            background: linear-gradient(45deg, var(--color-primary), var(--color-accent));
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            color: #FFFFFF;
            font-family: 'Oxanium', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-button:hover {
            background: linear-gradient(45deg, var(--color-accent), var(--color-primary));
            transform: translateY(-2px);
        }

        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .tab {
            background: var(--color-bg-light);
            padding: 10px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            white-space: nowrap;
        }

        .tab:hover {
            background: #2A2A2A;
            color: #FFFFFF;
            border-color: var(--color-primary);
        }

        .tab.active {
            background: linear-gradient(45deg, var(--color-primary), var(--color-accent));
            color: #FFFFFF;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .game-card {
            background: var(--color-bg-light);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--color-border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .game-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(107, 33, 168, 0.3);
            border-color: var(--color-accent);
        }

        .game-status {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .game-status.live {
            background: var(--color-danger);
            color: white;
        }

        .game-status.upcoming {
            background: var(--color-info);
            color: white;
        }

        .game-status.final {
            background: var(--color-text-secondary);
            color: white;
        }

        .teams-matchup {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .team {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .team-logo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid var(--color-accent);
        }

        .team-name {
            text-align: center;
        }

        .team-city {
            font-size: 16px;
            font-weight: 700;
            color: #FFFFFF;
        }

        .team-nickname {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        .team-record {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        .vs-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            margin: 0 20px;
        }

        .game-time {
            font-size: 18px;
            font-weight: 600;
            color: var(--color-info);
        }

        .game-score {
            font-size: 24px;
            font-weight: 700;
            color: #FFFFFF;
        }

        .betting-analysis {
            background: rgba(107, 33, 168, 0.1);
            border: 1px solid rgba(107, 33, 168, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
        }

        .analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .analysis-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--color-accent);
            text-transform: uppercase;
        }

        .confidence-score {
            font-size: 18px;
            font-weight: 700;
            padding: 4px 12px;
            border-radius: 8px;
        }

        .confidence-high {
            background: var(--color-success);
            color: white;
        }

        .confidence-medium {
            background: var(--color-warning);
            color: white;
        }

        .confidence-low {
            background: var(--color-text-secondary);
            color: white;
        }

        .markets-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 12px;
        }

        .market-card {
            background: var(--color-bg-medium);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            border: 1px solid var(--color-border);
        }

        .market-title {
            font-size: 12px;
            color: var(--color-text-secondary);
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .market-value {
            font-size: 16px;
            font-weight: 700;
            color: #FFFFFF;
        }

        .market-prediction {
            font-size: 12px;
            margin-top: 4px;
            font-weight: 600;
        }

        .prediction-over {
            color: var(--color-success);
        }

        .prediction-under {
            color: var(--color-danger);
        }

        .prediction-home {
            color: var(--color-info);
        }

        .prediction-away {
            color: var(--color-warning);
        }

        .key-insights {
            margin-top: 12px;
        }

        .insights-title {
            font-size: 12px;
            color: var(--color-text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .insight-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            margin-bottom: 4px;
        }

        .insight-icon {
            width: 16px;
            text-align: center;
        }

        .analyze-btn {
            width: 100%;
            background: linear-gradient(45deg, var(--color-primary), var(--color-accent));
            border: none;
            padding: 12px;
            border-radius: 8px;
            color: #FFFFFF;
            font-family: 'Oxanium', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 12px;
        }

        .analyze-btn:hover {
            background: linear-gradient(45deg, var(--color-accent), var(--color-primary));
            transform: translateY(-2px);
        }

        /* Estilos para an√°lise avan√ßada */
        .injury-alert {
            background: rgba(220, 53, 69, 0.1);
            border: 1px solid rgba(220, 53, 69, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .injury-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--color-danger);
            margin-bottom: 6px;
            text-transform: uppercase;
        }

        .injury-team {
            font-size: 11px;
            color: var(--color-text-secondary);
            margin-bottom: 2px;
        }

        .key-players-section {
            background: var(--color-bg-medium);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            border: 1px solid var(--color-border);
        }

        .players-title {
            font-size: 12px;
            color: var(--color-text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .players-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .team-players {
            background: var(--color-bg-dark);
            border-radius: 6px;
            padding: 8px;
        }

        .team-label {
            font-size: 10px;
            color: var(--color-primary);
            font-weight: 600;
            margin-bottom: 6px;
            text-transform: uppercase;
        }

        .key-player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
            padding: 2px 0;
        }

        .player-name {
            font-size: 11px;
            color: #FFFFFF;
            font-weight: 500;
        }

        .player-stats {
            font-size: 10px;
            color: var(--color-text-secondary);
        }

        .market-confidence {
            font-size: 10px;
            color: var(--color-text-secondary);
            margin-top: 2px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.show {
            opacity: 1;
        }

        .modal-content {
            background: var(--color-bg-medium);
            border-radius: 16px;
            padding: 24px;
            max-width: 1200px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--color-border);
        }

        .modal-header h2 {
            font-size: 24px;
            color: #FFFFFF;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--color-danger);
            font-size: 24px;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: var(--color-info);
        }

        .detailed-analysis {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .analysis-section {
            background: var(--color-bg-light);
            border-radius: 12px;
            padding: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #FFFFFF;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stats-comparison {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 12px;
            align-items: center;
            margin-bottom: 12px;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 600;
        }

        .stat-label {
            font-size: 12px;
            color: var(--color-text-secondary);
            text-align: center;
            text-transform: uppercase;
        }

        .home-stat {
            text-align: left;
            color: var(--color-info);
        }

        .away-stat {
            text-align: right;
            color: var(--color-warning);
        }

        .betting-recommendations {
            grid-column: 1 / -1;
            background: var(--color-bg-light);
            border-radius: 12px;
            padding: 20px;
            margin-top: 24px;
        }

        .recommendation-card {
            background: var(--color-bg-medium);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid;
        }

        .recommendation-card.high-confidence {
            border-color: var(--color-success);
        }

        .recommendation-card.medium-confidence {
            border-color: var(--color-warning);
        }

        .recommendation-card.low-confidence {
            border-color: var(--color-text-secondary);
        }

        .recommendation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .recommendation-title {
            font-size: 16px;
            font-weight: 600;
            color: #FFFFFF;
        }

        .recommendation-confidence {
            font-size: 14px;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .recommendation-reasons {
            font-size: 13px;
            color: var(--color-text-secondary);
            line-height: 1.4;
        }

        .error {
            color: var(--color-danger);
            padding: 16px;
            text-align: center;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        @media (max-width: 768px) {
            body {
                padding-left: 60px;
            }

            .sidebar {
                width: 60px;
            }

            .sidebar:hover {
                width: 220px;
            }

            .games-grid {
                grid-template-columns: 1fr;
            }

            .detailed-analysis {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="particles" id="particles"></div>

    <nav class="sidebar">
        <div class="sidebar-header">
            <img src="https://i.ibb.co/G4Y8sHMk/Chat-GPT-Image-21-de-abr-de-2025-16-14-34-1.png" alt="RW Tips"
                class="sidebar-logo">
            <span class="sidebar-title">RW Tips</span>
        </div>
        <ul class="sidebar-menu">
            <li><a href="visualization.html"><span class="icon">‚öΩ</span><span class="label">Pr√≥ximos Jogos</span></a>
            </li>
            <li><a href="results.html"><span class="icon">üìä</span><span class="label">√öltimos Resultados</span></a>
            </li>
            <li><a href="live_v2.html"><span class="icon">üî¥</span><span class="label">AO VIVO</span></a></li>
            <li><a href="statistics.html"><span class="icon">üìà</span><span class="label">Estat√≠sticas das
                        Ligas</span></a></li>
            <li><a href="formularioApostas.html"><span class="icon">üí∞</span><span class="label">Registrar
                        Apostas</span></a></li>
            <li><a href="players.html"><span class="icon">üéÆ</span><span class="label">An√°lise de Jogadores</span></a>
            </li>
            <li><a href="dashboard.html"><span class="icon">üìã</span><span class="label">Dashboard</span></a></li>
            <li class="active"><a href="NBA-Enhanced.html"><span class="icon">üèÄ</span><span class="label">NBA
                        Enhanced</span></a></li>
            <li><a href="radar.html"><span class="icon">üéØ</span><span class="label">Radar</span></a></li>
            <li><a href="over.html"><span class="icon">üìç</span><span class="label">Over Analysis</span></a></li>
        </ul>
    </nav>

    <div class="container">
        <div class="header">
            <h1>üèÄ NBA ENHANCED - AN√ÅLISE CONSOLIDADA</h1>
            <div class="nav-buttons">
                <button id="refreshBtn" class="nav-button"><i class="fas fa-sync-alt"></i> Atualizar</button>
                <button id="logoutBtn" class="nav-button">Sair</button>
            </div>
        </div>
        <div class="tabs" id="tabs"></div>
        <div class="games-grid" id="gamesGrid"></div>
    </div>

    <div class="modal" id="detailedAnalysisModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle"></h2>
                <button class="close-btn" id="closeModal">√ó</button>
            </div>
            <div class="detailed-analysis" id="detailedAnalysis"></div>
            <div class="betting-recommendations" id="bettingRecommendations"></div>
        </div>
    </div>

    <script>
        // Configura√ß√µes da API
        const API_CONFIG = {
            BASE_URL: 'https://stats.sports.bellmedia.ca/sports/basketball/leagues/nba',
            PROXY_URL: 'https://api.allorigins.win/raw?url=',
            BRAND: 'tsn',
            TYPE: 'json'
        };

        // Estado da aplica√ß√£o
        let currentDate = null;
        let gamesData = [];
        let autoUpdateInterval = null;

        // Elementos DOM
        const tabsDiv = document.getElementById('tabs');
        const gamesGrid = document.getElementById('gamesGrid');
        const modal = document.getElementById('detailedAnalysisModal');
        const modalTitle = document.getElementById('modalTitle');
        const detailedAnalysis = document.getElementById('detailedAnalysis');
        const bettingRecommendations = document.getElementById('bettingRecommendations');
        const closeModalBtn = document.getElementById('closeModal');

        // Verifica√ß√£o de login
        function checkUserLogin() {
            if (!sessionStorage.getItem('loggedIn')) {
                window.location.replace('index.html');
                return false;
            }
            return true;
        }

        function logout() {
            sessionStorage.removeItem('loggedIn');
            window.location.replace('index.html');
        }

        // Cria√ß√£o de part√≠culas
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 10; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100 + 100}%`;
                particle.style.animationDuration = `${Math.random() * 20 + 20}s`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particlesContainer.appendChild(particle);
            }
        }

        // Utilit√°rios de data
        function formatarDataBrasil(dataStr) {
            const data = new Date(dataStr + 'T12:00:00');
            const options = { weekday: 'short', month: 'short', day: 'numeric', timeZone: 'America/Sao_Paulo' };
            return data.toLocaleDateString('pt-BR', options).replace('.', '').toUpperCase();
        }

        function getDataAtualSP() {
            const now = new Date();
            const spTime = new Date(now.toLocaleString('en-US', { timeZone: 'America/Sao_Paulo' }));
            return spTime.toISOString().split('T')[0];
        }

        function formatTime(dateET) {
            const date = new Date(dateET);
            return date.toLocaleTimeString('pt-BR', {
                timeZone: 'America/Sao_Paulo',
                hour: 'numeric',
                minute: 'numeric',
                hour12: false
            });
        }

        // Fun√ß√µes da API
        async function fetchDates() {
            const url = `${API_CONFIG.BASE_URL}/scheduleV2/subset/dates?brand=${API_CONFIG.BRAND}&type=${API_CONFIG.TYPE}`;
            const proxyUrl = `${API_CONFIG.PROXY_URL}${encodeURIComponent(url)}`;
            const response = await fetch(proxyUrl);
            const data = await response.json();
            return Object.keys(data).sort();
        }

        async function fetchSchedule(date) {
            const url = `${API_CONFIG.BASE_URL}/scheduleV2/subset/dates?brand=${API_CONFIG.BRAND}&type=${API_CONFIG.TYPE}&dateOrId=${date}`;
            const proxyUrl = `${API_CONFIG.PROXY_URL}${encodeURIComponent(url)}`;
            const response = await fetch(proxyUrl);
            const data = await response.json();
            return data[date];
        }

        async function fetchTeamStats(eventId) {
            const url = `${API_CONFIG.BASE_URL}/event/${eventId}/competitorSeasonStats?brand=${API_CONFIG.BRAND}&type=${API_CONFIG.TYPE}`;
            const proxyUrl = `${API_CONFIG.PROXY_URL}${encodeURIComponent(url)}`;
            const response = await fetch(proxyUrl);
            return await response.json();
        }

        async function fetchPlayerStats(eventId) {
            const url = `${API_CONFIG.BASE_URL}/event/${eventId}/playerSeasonStats?nbPlayersToShow=5&brand=${API_CONFIG.BRAND}&qualifiedOnly=true&type=${API_CONFIG.TYPE}&seasonType=regular_season`;
            const proxyUrl = `${API_CONFIG.PROXY_URL}${encodeURIComponent(url)}`;
            const response = await fetch(proxyUrl);
            return await response.json();
        }

        // Cache para estat√≠sticas de jogadores e les√µes
        const playerStatsCache = new Map();
        const injuryReportsCache = new Map();

        // Fun√ß√£o para buscar estat√≠sticas detalhadas de jogadores
        async function fetchDetailedPlayerStats(eventId) {
            const cacheKey = `player_stats_${eventId}`;
            if (playerStatsCache.has(cacheKey)) {
                return playerStatsCache.get(cacheKey);
            }

            try {
                const response = await fetch(`${API_CONFIG.PROXY_URL}${encodeURIComponent(API_CONFIG.BASE_URL + '/event/' + eventId + '/playerSeasonStats?brand=' + API_CONFIG.BRAND + '&type=' + API_CONFIG.TYPE)}`);
                
                if (!response.ok) throw new Error('Falha ao buscar estat√≠sticas de jogadores');
                
                const data = await response.json();
                const processedData = processPlayerStatsData(data);
                
                playerStatsCache.set(cacheKey, processedData);
                return processedData;
            } catch (error) {
                console.error('Erro ao buscar estat√≠sticas de jogadores:', error);
                return null;
            }
        }

        // Fun√ß√£o para processar dados de jogadores
        function processPlayerStatsData(data) {
            if (!data || !data.playerSeasonStats) return null;

            const homeTeam = data.playerSeasonStats.home || [];
            const awayTeam = data.playerSeasonStats.away || [];

            return {
                home: {
                    topScorers: getTopPlayers(homeTeam, 'pointsPerGame', 3),
                    topRebounders: getTopPlayers(homeTeam, 'reboundsPerGame', 3),
                    topAssists: getTopPlayers(homeTeam, 'assistsPerGame', 3),
                    keyPlayers: getKeyPlayers(homeTeam),
                    teamDepth: calculateTeamDepth(homeTeam)
                },
                away: {
                    topScorers: getTopPlayers(awayTeam, 'pointsPerGame', 3),
                    topRebounders: getTopPlayers(awayTeam, 'reboundsPerGame', 3),
                    topAssists: getTopPlayers(awayTeam, 'assistsPerGame', 3),
                    keyPlayers: getKeyPlayers(awayTeam),
                    teamDepth: calculateTeamDepth(awayTeam)
                }
            };
        }

        // Fun√ß√£o para obter os melhores jogadores por categoria
        function getTopPlayers(players, stat, count = 3) {
            if (!players || !Array.isArray(players)) return [];
            
            return players
                .filter(player => player.stats && parseFloat(player.stats[stat]) > 0)
                .sort((a, b) => parseFloat(b.stats[stat]) - parseFloat(a.stats[stat]))
                .slice(0, count)
                .map(player => ({
                    name: player.player?.displayName || 'N/A',
                    value: parseFloat(player.stats[stat]).toFixed(1),
                    gamesPlayed: parseInt(player.stats.gamesPlayed) || 0,
                    efficiency: calculatePlayerEfficiency(player.stats)
                }));
        }

        // Fun√ß√£o para identificar jogadores-chave
        function getKeyPlayers(players) {
            if (!players || !Array.isArray(players)) return [];
            
            return players
                .filter(player => {
                    const stats = player.stats;
                    if (!stats) return false;
                    
                    const ppg = parseFloat(stats.pointsPerGame) || 0;
                    const rpg = parseFloat(stats.reboundsPerGame) || 0;
                    const apg = parseFloat(stats.assistsPerGame) || 0;
                    const games = parseInt(stats.gamesPlayed) || 0;
                    
                    return games >= 10 && (ppg >= 15 || rpg >= 8 || apg >= 6);
                })
                .sort((a, b) => calculatePlayerEfficiency(b.stats) - calculatePlayerEfficiency(a.stats))
                .slice(0, 5)
                .map(player => ({
                    name: player.player?.displayName || 'N/A',
                    ppg: parseFloat(player.stats.pointsPerGame).toFixed(1),
                    rpg: parseFloat(player.stats.reboundsPerGame).toFixed(1),
                    apg: parseFloat(player.stats.assistsPerGame).toFixed(1),
                    efficiency: calculatePlayerEfficiency(player.stats).toFixed(1),
                    impact: calculatePlayerImpact(player.stats)
                }));
        }

        // Fun√ß√£o para calcular efici√™ncia do jogador
        function calculatePlayerEfficiency(stats) {
            if (!stats) return 0;
            
            const ppg = parseFloat(stats.pointsPerGame) || 0;
            const rpg = parseFloat(stats.reboundsPerGame) || 0;
            const apg = parseFloat(stats.assistsPerGame) || 0;
            const spg = parseFloat(stats.stealsPerGame) || 0;
            const bpg = parseFloat(stats.blocksPerGame) || 0;
            const tpg = parseFloat(stats.turnoversPerGame) || 0;
            const fgPct = parseFloat(stats.fieldGoalPercentage) || 0;
            
            return (ppg + rpg + apg + spg + bpg - tpg) * fgPct;
        }

        // Fun√ß√£o para calcular impacto do jogador
        function calculatePlayerImpact(stats) {
            const efficiency = calculatePlayerEfficiency(stats);
            const minutes = parseFloat(stats.minutesPerGame) || 0;
            
            if (efficiency > 20 && minutes > 30) return 'Alto';
            if (efficiency > 12 && minutes > 25) return 'M√©dio';
            return 'Baixo';
        }

        // Fun√ß√£o para calcular profundidade do time
        function calculateTeamDepth(players) {
            if (!players || !Array.isArray(players)) return { score: 0, quality: 'Baixa' };
            
            const qualityPlayers = players.filter(player => {
                const stats = player.stats;
                if (!stats) return false;
                
                const ppg = parseFloat(stats.pointsPerGame) || 0;
                const minutes = parseFloat(stats.minutesPerGame) || 0;
                const games = parseInt(stats.gamesPlayed) || 0;
                
                return games >= 5 && minutes >= 15 && ppg >= 8;
            });
            
            const depthScore = qualityPlayers.length;
            let quality = 'Baixa';
            
            if (depthScore >= 8) quality = 'Excelente';
            else if (depthScore >= 6) quality = 'Boa';
            else if (depthScore >= 4) quality = 'M√©dia';
            
            return { score: depthScore, quality };
        }

        // Sistema de an√°lise de les√µes (placeholder com dados simulados)
        async function fetchInjuryReports(eventId) {
            const cacheKey = `injuries_${eventId}`;
            if (injuryReportsCache.has(cacheKey)) {
                return injuryReportsCache.get(cacheKey);
            }

            try {
                const simulatedInjuries = generateSimulatedInjuries(eventId);
                injuryReportsCache.set(cacheKey, simulatedInjuries);
                return simulatedInjuries;
            } catch (error) {
                console.error('Erro ao buscar relat√≥rio de les√µes:', error);
                return { home: [], away: [] };
            }
        }

        // Fun√ß√£o para gerar dados simulados de les√µes
        function generateSimulatedInjuries(eventId) {
            const seed = parseInt(eventId) || 0;
            const random = (seed * 9301 + 49297) % 233280;
            
            const injuryTypes = [
                { type: 'Question√°vel', severity: 'low', icon: 'üü°' },
                { type: 'Duvidoso', severity: 'medium', icon: 'üü†' },
                { type: 'Fora', severity: 'high', icon: 'üî¥' }
            ];
            
            const bodyParts = ['joelho', 'tornozelo', 'ombro', 'costas', 'punho', 'coxa'];
            const homeInjuries = [];
            const awayInjuries = [];
            
            const homeInjuryCount = (random % 4);
            const awayInjuryCount = ((random * 7) % 4);
            
            for (let i = 0; i < homeInjuryCount; i++) {
                const injuryType = injuryTypes[(random + i) % injuryTypes.length];
                const bodyPart = bodyParts[(random + i * 2) % bodyParts.length];
                
                homeInjuries.push({
                    player: `Jogador ${i + 1}`,
                    injury: `Les√£o no ${bodyPart}`,
                    status: injuryType.type,
                    severity: injuryType.severity,
                    icon: injuryType.icon,
                    impact: injuryType.severity === 'high' ? 'Alto' : injuryType.severity === 'medium' ? 'M√©dio' : 'Baixo'
                });
            }
            
            for (let i = 0; i < awayInjuryCount; i++) {
                const injuryType = injuryTypes[(random + i + 5) % injuryTypes.length];
                const bodyPart = bodyParts[(random + i * 3) % bodyParts.length];
                
                awayInjuries.push({
                    player: `Jogador ${i + 1}`,
                    injury: `Les√£o no ${bodyPart}`,
                    status: injuryType.type,
                    severity: injuryType.severity,
                    icon: injuryType.icon,
                    impact: injuryType.severity === 'high' ? 'Alto' : injuryType.severity === 'medium' ? 'M√©dio' : 'Baixo'
                });
            }
            
            return { home: homeInjuries, away: awayInjuries };
        }

        // Utilit√°rios de equipe
        function splitTeamName(fullName) {
            const specialCases = {
                'Trail Blazers': 'Portland', 'Timberwolves': 'Minnesota', 'Thunder': 'Oklahoma City', 'Jazz': 'Utah',
                'Heat': 'Miami', 'Magic': 'Orlando', 'Wizards': 'Washington', 'Pacers': 'Indiana', 'Knicks': 'New York',
                'Nets': 'Brooklyn', 'Celtics': 'Boston', '76ers': 'Philadelphia', 'Raptors': 'Toronto', 'Bulls': 'Chicago',
                'Cavaliers': 'Cleveland', 'Pistons': 'Detroit', 'Bucks': 'Milwaukee', 'Hawks': 'Atlanta', 'Hornets': 'Charlotte',
                'Mavericks': 'Dallas', 'Rockets': 'Houston', 'Grizzlies': 'Memphis', 'Pelicans': 'New Orleans', 'Spurs': 'San Antonio',
                'Nuggets': 'Denver', 'Warriors': 'Golden State', 'Clippers': 'LA Clippers', 'Lakers': 'Los Angeles', 'Suns': 'Phoenix',
                'Kings': 'Sacramento'
            };
            for (const [nickname, city] of Object.entries(specialCases)) {
                if (fullName.includes(nickname)) return { city, nickname };
            }
            const parts = fullName.split(' ');
            if (parts.length === 1) return { city: fullName, nickname: '' };
            const nickname = parts.pop();
            const city = parts.join(' ');
            return { city, nickname };
        }

        function getTeamLogoUrl(seoIdentifier) {
            return `https://tsnimages.tsn.ca/ImageProvider/TeamLogo?seoId=${seoIdentifier}&width=60&height=60`;
        }

        function formatRecord(record) {
            if (!record) return '';
            const [wins, losses] = record.split('-');
            return `<span style="color: var(--color-success)">${wins}</span>-<span style="color: var(--color-danger)">${losses}</span>`;
        }

        // Sistema de an√°lise melhorado
        class BettingAnalyzer {
            constructor() {
                this.weights = {
                    offense: 0.25,
                    defense: 0.25,
                    pace: 0.15,
                    efficiency: 0.20,
                    recent_form: 0.15
                };
            }

            // An√°lise aprimorada considerando jogadores e les√µes
            async calculateAdvancedPredictions(homeStats, awayStats, eventId) {
                try {
                    const [playerStats, injuries] = await Promise.all([
                        fetchDetailedPlayerStats(eventId),
                        fetchInjuryReports(eventId)
                    ]);

                    const basePredictions = {
                        total: this.calculateTotalPrediction(homeStats, awayStats),
                        spread: this.calculateSpreadPrediction(homeStats, awayStats),
                        moneyline: this.calculateMoneylinePrediction(homeStats, awayStats)
                    };

                    // Ajustar previs√µes baseado em jogadores e les√µes
                    const adjustedPredictions = this.adjustPredictionsForPlayers(
                        basePredictions, 
                        playerStats, 
                        injuries
                    );

                    return {
                        ...adjustedPredictions,
                        playerAnalysis: playerStats,
                        injuryReport: injuries,
                        keyFactors: this.identifyKeyFactors(homeStats, awayStats, playerStats, injuries)
                    };
                } catch (error) {
                    console.error('Erro na an√°lise avan√ßada:', error);
                    return {
                        total: this.calculateTotalPrediction(homeStats, awayStats),
                        spread: this.calculateSpreadPrediction(homeStats, awayStats),
                        moneyline: this.calculateMoneylinePrediction(homeStats, awayStats),
                        playerAnalysis: null,
                        injuryReport: { home: [], away: [] },
                        keyFactors: []
                    };
                }
            }

            // Ajustar previs√µes baseado em an√°lise de jogadores
            adjustPredictionsForPlayers(predictions, playerStats, injuries) {
                if (!playerStats || !injuries) return predictions;

                let totalAdjustment = 0;
                let spreadAdjustment = 0;
                let confidenceAdjustment = 0;

                // Ajustes baseados em les√µes
                const homeInjuryImpact = this.calculateInjuryImpact(injuries.home);
                const awayInjuryImpact = this.calculateInjuryImpact(injuries.away);

                // Les√µes afetam o total de pontos
                totalAdjustment -= (homeInjuryImpact + awayInjuryImpact) * 2;

                // Les√µes afetam o spread
                spreadAdjustment += (awayInjuryImpact - homeInjuryImpact) * 1.5;

                // Les√µes reduzem a confian√ßa
                confidenceAdjustment -= Math.max(homeInjuryImpact, awayInjuryImpact) * 5;

                // Ajustes baseados na profundidade do elenco
                const homeDepth = playerStats.home?.teamDepth?.score || 0;
                const awayDepth = playerStats.away?.teamDepth?.score || 0;

                if (homeDepth > awayDepth + 2) {
                    spreadAdjustment += 1;
                    confidenceAdjustment += 5;
                } else if (awayDepth > homeDepth + 2) {
                    spreadAdjustment -= 1;
                    confidenceAdjustment += 5;
                }

                return {
                    total: {
                        ...predictions.total,
                        total: Math.round(predictions.total.total + totalAdjustment),
                        confidence: Math.max(0, Math.min(100, predictions.total.confidence + confidenceAdjustment))
                    },
                    spread: {
                        ...predictions.spread,
                        spread: Math.round((predictions.spread.spread + spreadAdjustment) * 2) / 2,
                        confidence: Math.max(0, Math.min(100, predictions.spread.confidence + confidenceAdjustment))
                    },
                    moneyline: {
                        ...predictions.moneyline,
                        confidence: Math.max(0, Math.min(100, predictions.moneyline.confidence + confidenceAdjustment))
                    }
                };
            }

            // Calcular impacto das les√µes
            calculateInjuryImpact(injuries) {
                if (!injuries || injuries.length === 0) return 0;

                return injuries.reduce((total, injury) => {
                    switch (injury.severity) {
                        case 'high': return total + 3;
                        case 'medium': return total + 2;
                        case 'low': return total + 1;
                        default: return total;
                    }
                }, 0);
            }

            // Identificar fatores-chave do jogo
            identifyKeyFactors(homeStats, awayStats, playerStats, injuries) {
                const factors = [];

                // Fatores baseados em estat√≠sticas de time
                const homePPG = parseFloat(homeStats?.stats?.pointsForPerGame) || 0;
                const awayPPG = parseFloat(awayStats?.stats?.pointsForPerGame) || 0;

                if (Math.abs(homePPG - awayPPG) > 8) {
                    const betterOffense = homePPG > awayPPG ? 'Casa' : 'Visitante';
                    factors.push({
                        icon: 'üèÄ',
                        text: `${betterOffense} tem vantagem ofensiva significativa`,
                        type: 'offense',
                        impact: 'high'
                    });
                }

                // Fatores baseados em jogadores
                if (playerStats) {
                    const homeKeyPlayers = playerStats.home?.keyPlayers?.length || 0;
                    const awayKeyPlayers = playerStats.away?.keyPlayers?.length || 0;

                    if (Math.abs(homeKeyPlayers - awayKeyPlayers) >= 2) {
                        const betterDepth = homeKeyPlayers > awayKeyPlayers ? 'Casa' : 'Visitante';
                        factors.push({
                            icon: 'üë•',
                            text: `${betterDepth} tem elenco mais profundo`,
                            type: 'depth',
                            impact: 'medium'
                        });
                    }
                }

                // Fatores baseados em les√µes
                if (injuries) {
                    const homeInjuries = injuries.home?.filter(inj => inj.severity === 'high').length || 0;
                    const awayInjuries = injuries.away?.filter(inj => inj.severity === 'high').length || 0;

                    if (homeInjuries > 0 || awayInjuries > 0) {
                        const moreInjured = homeInjuries > awayInjuries ? 'Casa' : 'Visitante';
                        factors.push({
                            icon: 'üè•',
                            text: `${moreInjured} tem jogadores importantes lesionados`,
                            type: 'injury',
                            impact: 'high'
                        });
                    }
                }

                return factors;
            }

            calculateTotalPrediction(homeStats, awayStats) {
                const homePPG = parseFloat(homeStats?.stats?.pointsForPerGame) || 0;
                const awayPPG = parseFloat(awayStats?.stats?.pointsForPerGame) || 0;
                const homeDefPPG = parseFloat(homeStats?.stats?.pointsAgainstPerGame) || 0;
                const awayDefPPG = parseFloat(awayStats?.stats?.pointsAgainstPerGame) || 0;

                // C√°lculo mais sofisticado
                const homeProjected = (homePPG + awayDefPPG) / 2;
                const awayProjected = (awayPPG + homeDefPPG) / 2;
                const total = homeProjected + awayProjected;

                // Ajuste por ritmo de jogo
                const homePace = parseFloat(homeStats?.stats?.possessionsPerGame) || 100;
                const awayPace = parseFloat(awayStats?.stats?.possessionsPerGame) || 100;
                const avgPace = (homePace + awayPace) / 2;
                const paceAdjustment = (avgPace - 100) * 0.5;

                return {
                    total: Math.round(total + paceAdjustment),
                    homeProjected: Math.round(homeProjected),
                    awayProjected: Math.round(awayProjected),
                    confidence: this.calculateConfidence(homeStats, awayStats, 'total')
                };
            }

            calculateSpreadPrediction(homeStats, awayStats) {
                const homePPG = parseFloat(homeStats?.stats?.pointsForPerGame) || 0;
                const awayPPG = parseFloat(awayStats?.stats?.pointsForPerGame) || 0;
                const homeDefPPG = parseFloat(homeStats?.stats?.pointsAgainstPerGame) || 0;
                const awayDefPPG = parseFloat(awayStats?.stats?.pointsAgainstPerGame) || 0;

                // Net rating calculation
                const homeNetRating = homePPG - homeDefPPG;
                const awayNetRating = awayPPG - awayDefPPG;

                // Home court advantage (aproximadamente 3 pontos)
                const homeAdvantage = 3;
                const spread = (homeNetRating - awayNetRating) + homeAdvantage;

                return {
                    spread: Math.round(spread * 2) / 2, // Arredondar para 0.5
                    favorite: spread > 0 ? 'home' : 'away',
                    confidence: this.calculateConfidence(homeStats, awayStats, 'spread')
                };
            }

            calculateMoneylinePrediction(homeStats, awayStats) {
                const homeWinPct = parseFloat(homeStats?.stats?.winPercentage) || 0.5;
                const awayWinPct = parseFloat(awayStats?.stats?.winPercentage) || 0.5;

                // Ajuste para home court advantage
                const adjustedHomePct = Math.min(0.95, homeWinPct + 0.1);
                const adjustedAwayPct = Math.max(0.05, awayWinPct - 0.05);

                return {
                    homeWinProbability: adjustedHomePct,
                    awayWinProbability: adjustedAwayPct,
                    favorite: adjustedHomePct > adjustedAwayPct ? 'home' : 'away',
                    confidence: this.calculateConfidence(homeStats, awayStats, 'moneyline')
                };
            }

            calculateConfidence(homeStats, awayStats, betType) {
                let confidence = 50;

                // Fatores que aumentam a confian√ßa
                const homeGames = parseInt(homeStats?.stats?.gamesPlayed) || 0;
                const awayGames = parseInt(awayStats?.stats?.gamesPlayed) || 0;

                if (homeGames > 10 && awayGames > 10) confidence += 15;

                // Consist√™ncia das estat√≠sticas
                const homePPGVar = this.calculateVariance(homeStats);
                const awayPPGVar = this.calculateVariance(awayStats);

                if (homePPGVar < 10 && awayPPGVar < 10) confidence += 10;

                // Diferen√ßa significativa entre times
                if (betType === 'spread') {
                    const homeNetRating = (parseFloat(homeStats?.stats?.pointsForPerGame) || 0) -
                        (parseFloat(homeStats?.stats?.pointsAgainstPerGame) || 0);
                    const awayNetRating = (parseFloat(awayStats?.stats?.pointsForPerGame) || 0) -
                        (parseFloat(awayStats?.stats?.pointsAgainstPerGame) || 0);

                    const netDiff = Math.abs(homeNetRating - awayNetRating);
                    if (netDiff > 5) confidence += 15;
                    else if (netDiff > 3) confidence += 10;
                }

                return Math.max(0, Math.min(100, Math.round(confidence)));
            }

            calculateVariance(stats) {
                // Simula√ß√£o de vari√¢ncia baseada em estat√≠sticas dispon√≠veis
                const ppg = parseFloat(stats?.stats?.pointsForPerGame) || 0;
                const games = parseInt(stats?.stats?.gamesPlayed) || 1;

                // Estimativa simples de vari√¢ncia
                return Math.max(5, 15 - (games * 0.5));
            }

            generateInsights(homeStats, awayStats, predictions) {
                const insights = [];

                // Insights sobre total
                if (predictions.total.total > 230) {
                    insights.push({
                        icon: 'üî•',
                        text: 'Jogo de alto scoring esperado',
                        type: 'positive'
                    });
                } else if (predictions.total.total < 210) {
                    insights.push({
                        icon: 'üõ°Ô∏è',
                        text: 'Defesas s√≥lidas, jogo de baixo scoring',
                        type: 'defensive'
                    });
                }

                // Insights sobre ritmo
                const homePace = parseFloat(homeStats?.stats?.possessionsPerGame) || 100;
                const awayPace = parseFloat(awayStats?.stats?.possessionsPerGame) || 100;
                const avgPace = (homePace + awayPace) / 2;

                if (avgPace > 102) {
                    insights.push({
                        icon: '‚ö°',
                        text: 'Ritmo acelerado favorece Over',
                        type: 'pace'
                    });
                } else if (avgPace < 98) {
                    insights.push({
                        icon: 'üêå',
                        text: 'Ritmo lento favorece Under',
                        type: 'pace'
                    });
                }

                // Insights sobre spread
                if (Math.abs(predictions.spread.spread) > 7) {
                    insights.push({
                        icon: 'üìä',
                        text: 'Grande diferen√ßa entre os times',
                        type: 'spread'
                    });
                }

                return insights;
            }
        }

        const analyzer = new BettingAnalyzer();

        // Renderiza√ß√£o das abas
        async function renderTabs() {
            if (!checkUserLogin()) return;

            try {
                const dates = await fetchDates();
                const hoje = getDataAtualSP();
                let dataAtiva = dates.includes(hoje) ? hoje : dates[0];

                let html = dates.map(date => {
                    const ativa = date === dataAtiva;
                    const textoAba = formatarDataBrasil(date);
                    return `<div class="tab${ativa ? ' active' : ''}" data-date="${date}">${textoAba}</div>`;
                }).join('');

                tabsDiv.innerHTML = html;
                currentDate = dataAtiva;

                // Event listeners para as abas
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        currentDate = tab.dataset.date;
                        renderGames();
                    });
                });

                // Event listeners para bot√µes
                document.getElementById('refreshBtn').addEventListener('click', renderGames);
                document.getElementById('logoutBtn').addEventListener('click', logout);

                createParticles();
                renderGames();
            } catch (error) {
                console.error('Erro ao renderizar abas:', error);
                tabsDiv.innerHTML = '<div class="error">Erro ao carregar datas</div>';
            }
        }

        // Renderiza√ß√£o dos jogos
        async function renderGames() {
            try {
                gamesGrid.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--color-text-secondary);">Carregando jogos...</div>';

                const data = await fetchSchedule(currentDate);
                if (!data || !data.events) {
                    gamesGrid.innerHTML = '<div class="error">Nenhum jogo encontrado para esta data</div>';
                    return;
                }

                gamesData = data.events;
                let html = '';

                for (const event of data.events) {
                    const eventData = event.event;
                    const { top: home, bottom: away, status, dateET } = eventData;
                    const eventId = event.eventId;

                    const isLive = status.includes('Progress') || status.includes('Em Andamento');
                    const isFinal = status.includes('Final') || status.includes('Terminado');
                    const isUpcoming = !isLive && !isFinal;

                    const homeTeam = splitTeamName(home.name);
                    const awayTeam = splitTeamName(away.name);
                    const homeLogo = getTeamLogoUrl(home.seoIdentifier);
                    const awayLogo = getTeamLogoUrl(away.seoIdentifier);

                    let statusClass = 'upcoming';
                    let statusText = formatTime(dateET);

                    if (isLive) {
                        statusClass = 'live';
                        statusText = 'üî¥ AO VIVO';
                    } else if (isFinal) {
                        statusClass = 'final';
                        statusText = 'FINAL';
                    }

                    // An√°lise r√°pida avan√ßada para jogos futuros
                    let quickAnalysis = '';
                    if (isUpcoming) {
                        try {
                            const teamStats = await fetchTeamStats(eventId);
                            const homeStats = teamStats?.home;
                            const awayStats = teamStats?.away;

                            if (homeStats && awayStats) {
                                // Buscar estat√≠sticas detalhadas de jogadores
                                const [homePlayerStats, awayPlayerStats] = await Promise.all([
                                    fetchDetailedPlayerStats(home.seoIdentifier),
                                    fetchDetailedPlayerStats(away.seoIdentifier)
                                ]);

                                // Buscar relat√≥rios de les√µes
                                const [homeInjuries, awayInjuries] = await Promise.all([
                                    fetchInjuryReports(home.seoIdentifier),
                                    fetchInjuryReports(away.seoIdentifier)
                                ]);

                                // Calcular previs√µes avan√ßadas com an√°lise de jogadores e les√µes
                                const predictions = analyzer.calculateAdvancedPredictions(
                                    homeStats, awayStats, 
                                    homePlayerStats, awayPlayerStats,
                                    homeInjuries, awayInjuries
                                );

                                const insights = analyzer.generateInsights(homeStats, awayStats, predictions);
                                const keyFactors = analyzer.identifyKeyFactors(
                                    homeStats, awayStats, 
                                    homePlayerStats, awayPlayerStats,
                                    homeInjuries, awayInjuries
                                );

                                const avgConfidence = Math.round((predictions.total.confidence + predictions.spread.confidence + predictions.moneyline.confidence) / 3);

                                let confidenceClass = 'confidence-low';
                                if (avgConfidence >= 75) confidenceClass = 'confidence-high';
                                else if (avgConfidence >= 60) confidenceClass = 'confidence-medium';

                                // Identificar jogadores-chave
                                const homeKeyPlayers = getKeyPlayers(homePlayerStats);
                                const awayKeyPlayers = getKeyPlayers(awayPlayerStats);

                                // Contar les√µes importantes
                                const homeInjuryCount = homeInjuries.filter(inj => inj.severity === 'high' || inj.severity === 'medium').length;
                                const awayInjuryCount = awayInjuries.filter(inj => inj.severity === 'high' || inj.severity === 'medium').length;

                                quickAnalysis = `
                                    <div class="betting-analysis">
                                        <div class="analysis-header">
                                            <div class="analysis-title">An√°lise Avan√ßada</div>
                                            <div class="confidence-score ${confidenceClass}">${avgConfidence}%</div>
                                        </div>
                                        
                                        ${(homeInjuryCount > 0 || awayInjuryCount > 0) ? `
                                        <div class="injury-alert">
                                            <div class="injury-title">‚ö†Ô∏è Relat√≥rio de Les√µes</div>
                                            ${homeInjuryCount > 0 ? `<div class="injury-team">${homeTeam.city}: ${homeInjuryCount} jogador(es) lesionado(s)</div>` : ''}
                                            ${awayInjuryCount > 0 ? `<div class="injury-team">${awayTeam.city}: ${awayInjuryCount} jogador(es) lesionado(s)</div>` : ''}
                                        </div>
                                        ` : ''}

                                        <div class="key-players-section">
                                            <div class="players-title">üåü Jogadores-Chave</div>
                                            <div class="players-grid">
                                                <div class="team-players">
                                                    <div class="team-label">${homeTeam.city}</div>
                                                    ${homeKeyPlayers.slice(0, 2).map(player => `
                                                        <div class="key-player">
                                                            <span class="player-name">${player.name}</span>
                                                            <span class="player-stats">${player.points}pts ${player.rebounds}reb</span>
                                                        </div>
                                                    `).join('')}
                                                </div>
                                                <div class="team-players">
                                                    <div class="team-label">${awayTeam.city}</div>
                                                    ${awayKeyPlayers.slice(0, 2).map(player => `
                                                        <div class="key-player">
                                                            <span class="player-name">${player.name}</span>
                                                            <span class="player-stats">${player.points}pts ${player.rebounds}reb</span>
                                                        </div>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        </div>

                                        <div class="markets-grid">
                                            <div class="market-card">
                                                <div class="market-title">Total</div>
                                                <div class="market-value">${predictions.total.total}</div>
                                                <div class="market-prediction ${predictions.total.total > 220 ? 'prediction-over' : 'prediction-under'}">
                                                    ${predictions.total.total > 220 ? 'OVER' : 'UNDER'}
                                                </div>
                                                <div class="market-confidence">${predictions.total.confidence}%</div>
                                            </div>
                                            <div class="market-card">
                                                <div class="market-title">Spread</div>
                                                <div class="market-value">${predictions.spread.spread > 0 ? '+' : ''}${predictions.spread.spread}</div>
                                                <div class="market-prediction ${predictions.spread.favorite === 'home' ? 'prediction-home' : 'prediction-away'}">
                                                    ${predictions.spread.favorite === 'home' ? homeTeam.city : awayTeam.city}
                                                </div>
                                                <div class="market-confidence">${predictions.spread.confidence}%</div>
                                            </div>
                                            <div class="market-card">
                                                <div class="market-title">Favorito</div>
                                                <div class="market-value">${Math.round(predictions.moneyline.homeWinProbability * 100)}%</div>
                                                <div class="market-prediction ${predictions.moneyline.favorite === 'home' ? 'prediction-home' : 'prediction-away'}">
                                                    ${predictions.moneyline.favorite === 'home' ? homeTeam.city : awayTeam.city}
                                                </div>
                                                <div class="market-confidence">${predictions.moneyline.confidence}%</div>
                                            </div>
                                        </div>

                                        <div class="key-insights">
                                            <div class="insights-title">Fatores-Chave do Jogo</div>
                                            ${keyFactors.slice(0, 3).map(factor => `
                                                <div class="insight-item">
                                                    <span class="insight-icon">${factor.icon}</span>
                                                    <span>${factor.text}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                        
                                        <button class="analyze-btn" onclick="openDetailedAnalysis('${eventId}', '${home.name}', '${away.name}')">
                                            <i class="fas fa-chart-line"></i> An√°lise Completa
                                        </button>
                                    </div>
                                `;
                            }
                        } catch (error) {
                            console.log('Erro na an√°lise r√°pida:', error);
                        }
                    }

                    const scoreDisplay = (home.score != null && away.score != null) ?
                        `<div class="game-score">${away.score} - ${home.score}</div>` :
                        `<div class="game-time">${statusText}</div>`;

                    html += `
                        <div class="game-card">
                            <div class="game-status ${statusClass}">${statusText}</div>
                            <div class="teams-matchup">
                                <div class="team">
                                    <img src="${awayLogo}" alt="${away.name}" class="team-logo">
                                    <div class="team-name">
                                        <div class="team-city">${awayTeam.city}</div>
                                        <div class="team-nickname">${awayTeam.nickname}</div>
                                    </div>
                                    <div class="team-record">${formatRecord(away.record)}</div>
                                </div>
                                <div class="vs-section">
                                    ${scoreDisplay}
                                    <div style="font-size: 14px; color: var(--color-text-secondary);">VS</div>
                                </div>
                                <div class="team">
                                    <img src="${homeLogo}" alt="${home.name}" class="team-logo">
                                    <div class="team-name">
                                        <div class="team-city">${homeTeam.city}</div>
                                        <div class="team-nickname">${homeTeam.nickname}</div>
                                    </div>
                                    <div class="team-record">${formatRecord(home.record)}</div>
                                </div>
                            </div>
                            ${quickAnalysis}
                        </div>
                    `;
                }

                gamesGrid.innerHTML = html;
            } catch (error) {
                console.error('Erro ao renderizar jogos:', error);
                gamesGrid.innerHTML = '<div class="error">Erro ao carregar jogos</div>';
            }
        }

        // An√°lise detalhada
        async function openDetailedAnalysis(eventId, homeName, awayName) {
            try {
                modalTitle.textContent = `${awayName} @ ${homeName}`;

                // Mostrar modal com loading
                detailedAnalysis.innerHTML = '<div style="text-align: center; padding: 40px;">Carregando an√°lise detalhada...</div>';
                bettingRecommendations.innerHTML = '';
                modal.style.display = 'flex';
                setTimeout(() => modal.classList.add('show'), 10);

                // Buscar dados
                const [teamStats, playerStats] = await Promise.all([
                    fetchTeamStats(eventId),
                    fetchPlayerStats(eventId)
                ]);

                const homeStats = teamStats?.home;
                const awayStats = teamStats?.away;

                if (!homeStats || !awayStats) {
                    throw new Error('Dados de estat√≠sticas n√£o dispon√≠veis');
                }

                // Calcular previs√µes
                const predictions = {
                    total: analyzer.calculateTotalPrediction(homeStats, awayStats),
                    spread: analyzer.calculateSpreadPrediction(homeStats, awayStats),
                    moneyline: analyzer.calculateMoneylinePrediction(homeStats, awayStats)
                };

                const insights = analyzer.generateInsights(homeStats, awayStats, predictions);

                // Renderizar an√°lise detalhada
                renderDetailedAnalysis(homeStats, awayStats, predictions, insights, playerStats);
                renderBettingRecommendations(predictions, insights, homeName, awayName);

            } catch (error) {
                console.error('Erro na an√°lise detalhada:', error);
                detailedAnalysis.innerHTML = `<div class="error">Erro ao carregar an√°lise: ${error.message}</div>`;
            }
        }

        function renderDetailedAnalysis(homeStats, awayStats, predictions, insights, playerStats) {
            const homeTeam = splitTeamName(homeStats.competitor.name);
            const awayTeam = splitTeamName(awayStats.competitor.name);

            detailedAnalysis.innerHTML = `
                <div class="analysis-section">
                    <div class="section-title">
                        <i class="fas fa-chart-bar"></i>
                        Compara√ß√£o de Estat√≠sticas
                    </div>
                    
                    <div class="stats-comparison">
                        <div class="stat-value home-stat">${parseFloat(homeStats.stats.pointsForPerGame).toFixed(1)}</div>
                        <div class="stat-label">Pontos por Jogo</div>
                        <div class="stat-value away-stat">${parseFloat(awayStats.stats.pointsForPerGame).toFixed(1)}</div>
                    </div>
                    
                    <div class="stats-comparison">
                        <div class="stat-value home-stat">${parseFloat(homeStats.stats.pointsAgainstPerGame).toFixed(1)}</div>
                        <div class="stat-label">Pontos Sofridos</div>
                        <div class="stat-value away-stat">${parseFloat(awayStats.stats.pointsAgainstPerGame).toFixed(1)}</div>
                    </div>
                    
                    <div class="stats-comparison">
                        <div class="stat-value home-stat">${parseFloat(homeStats.stats.fieldGoalPercentage * 100).toFixed(1)}%</div>
                        <div class="stat-label">% Arremessos</div>
                        <div class="stat-value away-stat">${parseFloat(awayStats.stats.fieldGoalPercentage * 100).toFixed(1)}%</div>
                    </div>
                    
                    <div class="stats-comparison">
                        <div class="stat-value home-stat">${parseFloat(homeStats.stats.reboundsPerGame).toFixed(1)}</div>
                        <div class="stat-label">Rebotes por Jogo</div>
                        <div class="stat-value away-stat">${parseFloat(awayStats.stats.reboundsPerGame).toFixed(1)}</div>
                    </div>
                    
                    <div class="stats-comparison">
                        <div class="stat-value home-stat">${parseFloat(homeStats.stats.assistsPerGame).toFixed(1)}</div>
                        <div class="stat-label">Assist√™ncias</div>
                        <div class="stat-value away-stat">${parseFloat(awayStats.stats.assistsPerGame).toFixed(1)}</div>
                    </div>
                </div>

                <div class="analysis-section">
                    <div class="section-title">
                        <i class="fas fa-bullseye"></i>
                        Previs√µes dos Mercados
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--color-info); margin-bottom: 8px;">Total de Pontos</h4>
                        <div style="font-size: 24px; font-weight: 700; color: #FFFFFF; margin-bottom: 4px;">
                            ${predictions.total.total} pontos
                        </div>
                        <div style="font-size: 14px; color: var(--color-text-secondary);">
                            ${homeTeam.city}: ${predictions.total.homeProjected} | ${awayTeam.city}: ${predictions.total.awayProjected}
                        </div>
                        <div style="margin-top: 8px;">
                            <span style="background: var(--color-success); color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px;">
                                Confian√ßa: ${predictions.total.confidence}%
                            </span>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--color-warning); margin-bottom: 8px;">Spread</h4>
                        <div style="font-size: 24px; font-weight: 700; color: #FFFFFF; margin-bottom: 4px;">
                            ${homeTeam.city} ${predictions.spread.spread > 0 ? '+' : ''}${predictions.spread.spread}
                        </div>
                        <div style="font-size: 14px; color: var(--color-text-secondary);">
                            Favorito: ${predictions.spread.favorite === 'home' ? homeTeam.city : awayTeam.city}
                        </div>
                        <div style="margin-top: 8px;">
                            <span style="background: var(--color-warning); color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px;">
                                Confian√ßa: ${predictions.spread.confidence}%
                            </span>
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="color: var(--color-accent); margin-bottom: 8px;">Moneyline</h4>
                        <div style="font-size: 18px; font-weight: 600; color: #FFFFFF; margin-bottom: 4px;">
                            ${homeTeam.city}: ${Math.round(predictions.moneyline.homeWinProbability * 100)}%
                        </div>
                        <div style="font-size: 18px; font-weight: 600; color: #FFFFFF; margin-bottom: 4px;">
                            ${awayTeam.city}: ${Math.round(predictions.moneyline.awayWinProbability * 100)}%
                        </div>
                        <div style="margin-top: 8px;">
                            <span style="background: var(--color-accent); color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px;">
                                Confian√ßa: ${predictions.moneyline.confidence}%
                            </span>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderBettingRecommendations(predictions, insights, homeName, awayName) {
            const recommendations = [];

            // Recomenda√ß√£o para Total
            if (predictions.total.confidence >= 70) {
                const overUnder = predictions.total.total > 220 ? 'OVER' : 'UNDER';
                recommendations.push({
                    title: `${overUnder} ${predictions.total.total} Pontos`,
                    confidence: predictions.total.confidence,
                    reasons: `Baseado na m√©dia ofensiva e defensiva das equipes. ${homeName} projeta ${predictions.total.homeProjected} pontos, ${awayName} projeta ${predictions.total.awayProjected} pontos.`,
                    tier: predictions.total.confidence >= 80 ? 'high' : 'medium'
                });
            }

            // Recomenda√ß√£o para Spread
            if (predictions.spread.confidence >= 65) {
                const favoriteTeam = predictions.spread.favorite === 'home' ? homeName : awayName;
                const spread = Math.abs(predictions.spread.spread);
                recommendations.push({
                    title: `${favoriteTeam} -${spread}`,
                    confidence: predictions.spread.confidence,
                    reasons: `${favoriteTeam} tem vantagem significativa baseada no net rating e estat√≠sticas da temporada.`,
                    tier: predictions.spread.confidence >= 80 ? 'high' : 'medium'
                });
            }

            // Recomenda√ß√£o para Moneyline
            const strongFavorite = predictions.moneyline.homeWinProbability > 0.65 || predictions.moneyline.awayWinProbability > 0.65;
            if (strongFavorite && predictions.moneyline.confidence >= 60) {
                const favoriteTeam = predictions.moneyline.favorite === 'home' ? homeName : awayName;
                const probability = predictions.moneyline.favorite === 'home' ?
                    predictions.moneyline.homeWinProbability : predictions.moneyline.awayWinProbability;

                recommendations.push({
                    title: `${favoriteTeam} Moneyline`,
                    confidence: predictions.moneyline.confidence,
                    reasons: `${favoriteTeam} tem ${Math.round(probability * 100)}% de probabilidade de vit√≥ria baseado no hist√≥rico da temporada.`,
                    tier: predictions.moneyline.confidence >= 75 ? 'high' : 'medium'
                });
            }

            // Ordenar por confian√ßa
            recommendations.sort((a, b) => b.confidence - a.confidence);

            let html = `
                <div class="section-title">
                    <i class="fas fa-lightbulb"></i>
                    Recomenda√ß√µes de Apostas
                </div>
            `;

            if (recommendations.length === 0) {
                html += '<div style="text-align: center; color: var(--color-text-secondary); padding: 20px;">Nenhuma recomenda√ß√£o com alta confian√ßa encontrada para este jogo.</div>';
            } else {
                recommendations.forEach(rec => {
                    const confidenceClass = rec.tier === 'high' ? 'high-confidence' : 'medium-confidence';
                    const confidenceColor = rec.tier === 'high' ? 'var(--color-success)' : 'var(--color-warning)';

                    html += `
                        <div class="recommendation-card ${confidenceClass}">
                            <div class="recommendation-header">
                                <div class="recommendation-title">${rec.title}</div>
                                <div class="recommendation-confidence" style="background: ${confidenceColor};">
                                    ${rec.confidence}%
                                </div>
                            </div>
                            <div class="recommendation-reasons">${rec.reasons}</div>
                        </div>
                    `;
                });
            }

            // Adicionar insights gerais
            if (insights.length > 0) {
                html += `
                    <div style="margin-top: 24px;">
                        <h4 style="color: var(--color-accent); margin-bottom: 12px;">Insights Adicionais</h4>
                        ${insights.map(insight => `
                            <div class="insight-item" style="margin-bottom: 8px;">
                                <span class="insight-icon">${insight.icon}</span>
                                <span>${insight.text}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            bettingRecommendations.innerHTML = html;
        }

        // Event listeners para modal
        closeModalBtn.addEventListener('click', () => {
            modal.classList.remove('show');
            setTimeout(() => modal.style.display = 'none', 300);
        });

        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                modal.classList.remove('show');
                setTimeout(() => modal.style.display = 'none', 300);
            }
        });

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            renderTabs();
        });

        // Fun√ß√£o global para an√°lise detalhada
        window.openDetailedAnalysis = openDetailedAnalysis;

        // Auto-refresh a cada 5 minutos para jogos ao vivo
        function startAutoRefresh() {
            if (autoUpdateInterval) clearInterval(autoUpdateInterval);

            autoUpdateInterval = setInterval(() => {
                const hasLiveGames = gamesData.some(game =>
                    game.event.status.includes('Progress') ||
                    game.event.status.includes('Em Andamento')
                );

                if (hasLiveGames) {
                    renderGames();
                }
            }, 300000); // 5 minutos
        }

        // Parar auto-refresh quando a p√°gina n√£o estiver vis√≠vel
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                if (autoUpdateInterval) {
                    clearInterval(autoUpdateInterval);
                    autoUpdateInterval = null;
                }
            } else {
                startAutoRefresh();
            }
        });

        // Iniciar auto-refresh
        startAutoRefresh();

        // Adicionar anima√ß√µes suaves
        function addSmoothAnimations() {
            const style = document.createElement('style');
            style.textContent = `
                .game-card {
                    animation: fadeInUp 0.6s ease-out;
                }
                
                .game-card:nth-child(2) { animation-delay: 0.1s; }
                .game-card:nth-child(3) { animation-delay: 0.2s; }
                .game-card:nth-child(4) { animation-delay: 0.3s; }
                
                @keyframes fadeInUp {
                    from {
                        opacity: 0;
                        transform: translateY(30px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                
                .betting-analysis {
                    animation: slideIn 0.4s ease-out;
                }
                
                @keyframes slideIn {
                    from {
                        opacity: 0;
                        transform: translateX(-20px);
                    }
                    to {
                        opacity: 1;
                        transform: translateX(0);
                    }
                }
            `;
            document.head.appendChild(style);
        }

        // Adicionar anima√ß√µes quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', () => {
            addSmoothAnimations();
        });

        // Fun√ß√£o para formatar n√∫meros grandes
        function formatLargeNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // Fun√ß√£o para calcular tend√™ncias
        function calculateTrends(stats) {
            const trends = {};

            // Tend√™ncia ofensiva
            const ppg = parseFloat(stats.pointsForPerGame) || 0;
            if (ppg > 115) trends.offense = 'high';
            else if (ppg > 105) trends.offense = 'medium';
            else trends.offense = 'low';

            // Tend√™ncia defensiva
            const oppPpg = parseFloat(stats.pointsAgainstPerGame) || 0;
            if (oppPpg < 105) trends.defense = 'high';
            else if (oppPpg < 115) trends.defense = 'medium';
            else trends.defense = 'low';

            return trends;
        }

        // Fun√ß√£o para detectar dispositivos m√≥veis
        function isMobile() {
            return window.innerWidth <= 768;
        }

        // Ajustar layout para mobile
        function adjustForMobile() {
            if (isMobile()) {
                document.body.style.paddingLeft = '60px';
                const gamesGrid = document.getElementById('gamesGrid');
                if (gamesGrid) {
                    gamesGrid.style.gridTemplateColumns = '1fr';
                }
            }
        }

        // Event listener para redimensionamento
        window.addEventListener('resize', adjustForMobile);

        // Fun√ß√£o para salvar prefer√™ncias do usu√°rio
        function saveUserPreferences() {
            const preferences = {
                lastViewedDate: currentDate,
                autoRefresh: true,
                theme: 'dark'
            };
            localStorage.setItem('nbaEnhancedPrefs', JSON.stringify(preferences));
        }

        // Fun√ß√£o para carregar prefer√™ncias do usu√°rio
        function loadUserPreferences() {
            const saved = localStorage.getItem('nbaEnhancedPrefs');
            if (saved) {
                try {
                    return JSON.parse(saved);
                } catch (e) {
                    console.log('Erro ao carregar prefer√™ncias:', e);
                }
            }
            return null;
        }

        // Salvar prefer√™ncias quando a data mudar
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('tab')) {
                setTimeout(saveUserPreferences, 100);
            }
        });

        // Fun√ß√£o para mostrar notifica√ß√µes
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--color-${type === 'error' ? 'danger' : 'success'});
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 3000;
                animation: slideInRight 0.3s ease-out;
                max-width: 300px;
                font-size: 14px;
                font-weight: 600;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Adicionar estilos para notifica√ß√µes
        const notificationStyles = document.createElement('style');
        notificationStyles.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(notificationStyles);

        // Interceptar erros e mostrar notifica√ß√µes
        window.addEventListener('error', (e) => {
            console.error('Erro capturado:', e.error);
            showNotification('Ocorreu um erro. Tente atualizar a p√°gina.', 'error');
        });

        // Fun√ß√£o para debug (apenas em desenvolvimento)
        function debugLog(...args) {
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                console.log('[NBA Enhanced Debug]:', ...args);
            }
        }

        // Log de inicializa√ß√£o
        debugLog('NBA Enhanced carregado com sucesso');
    </script>
</body>

</html>