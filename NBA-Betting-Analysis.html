<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Betting Analysis - RW Tips</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a73e8;
            --success: #34a853;
            --warning: #fbbc04;
            --danger: #ea4335;
            --bg-primary: #0f1419;
            --bg-secondary: #1a1f2e;
            --bg-tertiary: #252b3b;
            --text-primary: #ffffff;
            --text-secondary: #b3b8cd;
            --text-muted: #6b7280;
            --border: #2d3748;
            --accent: #00d4aa;
            --purple: #8b5cf6;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--purple));
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(26, 115, 232, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .games-grid {
            display: grid;
            gap: 24px;
            margin-bottom: 30px;
        }

        .game-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--primary));
        }

        .game-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 212, 170, 0.2);
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .game-time {
            background: var(--bg-tertiary);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--accent);
        }

        .live-indicator {
            background: var(--danger);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .teams-matchup {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            margin-bottom: 24px;
        }

        .team {
            text-align: center;
        }

        .team-logo {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 12px;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            border: 2px solid var(--border);
        }

        .team-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .team-record {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .vs-section {
            text-align: center;
        }

        .vs-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .spread {
            background: var(--bg-tertiary);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .betting-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .analysis-section {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title i {
            color: var(--accent);
        }

        .betting-lines {
            display: grid;
            gap: 12px;
        }

        .betting-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border-left: 4px solid var(--accent);
        }

        .line-type {
            font-weight: 500;
            color: var(--text-primary);
        }

        .line-value {
            font-weight: 600;
            color: var(--accent);
        }

        .confidence-meter {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .confidence-bar {
            flex: 1;
            height: 6px;
            background: var(--bg-secondary);
            border-radius: 3px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--danger), var(--warning), var(--success));
            transition: width 0.3s ease;
        }

        .confidence-text {
            font-size: 0.8rem;
            font-weight: 500;
            min-width: 60px;
        }

        .key-factors {
            display: grid;
            gap: 8px;
        }

        .factor {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: var(--bg-secondary);
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .factor-icon {
            width: 20px;
            text-align: center;
        }

        .factor.positive .factor-icon {
            color: var(--success);
        }

        .factor.negative .factor-icon {
            color: var(--danger);
        }

        .factor.neutral .factor-icon {
            color: var(--warning);
        }

        .predictions-grid {
            display: grid;
            gap: 12px;
        }

        .prediction {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .prediction-market {
            font-weight: 500;
        }

        .prediction-pick {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .pick-confidence {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .pick-confidence.high {
            background: var(--success);
            color: white;
        }

        .pick-confidence.medium {
            background: var(--warning);
            color: black;
        }

        .pick-confidence.low {
            background: var(--danger);
            color: white;
        }

        .stats-comparison {
            display: grid;
            gap: 12px;
        }

        .stat-row {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 12px;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .stat-value {
            font-weight: 600;
            text-align: center;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-align: center;
        }

        .stat-advantage {
            color: var(--success);
        }

        .value-analysis, .trends-analysis {
            display: grid;
            gap: 12px;
        }

        .value-bet {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border-left: 4px solid var(--success);
        }

        .value-bet.negative {
            border-left-color: var(--danger);
        }

        .value-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .value-market {
            font-weight: 600;
            color: var(--text-primary);
        }

        .value-details {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .value-score {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .ev-value {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .ev-value.positive {
            color: var(--success);
        }

        .ev-value.negative {
            color: var(--danger);
        }

        .kelly-percentage {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .trend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .trend-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .trend-icon.bullish {
            background: rgba(52, 168, 83, 0.2);
            color: var(--success);
        }

        .trend-icon.bearish {
            background: rgba(234, 67, 53, 0.2);
            color: var(--danger);
        }

        .trend-icon.neutral {
            background: rgba(251, 188, 4, 0.2);
            color: var(--warning);
        }

        .trend-content {
            flex: 1;
        }

        .trend-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .trend-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .trend-stats {
            display: flex;
            gap: 16px;
            margin-top: 8px;
        }

        .trend-stat {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .trend-stat strong {
            color: var(--text-secondary);
        }

        /* Estilos para Ferramentas de Previsão */
        .prediction-tools {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 15px;
            border: 1px solid #333;
        }

        .prediction-tools h3 {
            color: #fff;
            margin-bottom: 20px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prediction-tools h3 i {
            color: #9c27b0;
        }

        .prediction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .prediction-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .prediction-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(156, 39, 176, 0.2);
            border-color: rgba(156, 39, 176, 0.3);
        }

        .prediction-card h4 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 1.1em;
            border-bottom: 2px solid #9c27b0;
            padding-bottom: 8px;
        }

        .prediction-results {
            color: #ccc;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .prediction-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .prediction-metric:last-child {
            border-bottom: none;
        }

        .prediction-metric .label {
            color: #aaa;
        }

        .prediction-metric .value {
            color: #fff;
            font-weight: bold;
        }

        .prediction-metric .value.positive {
            color: #4CAF50;
        }

        .prediction-metric .value.negative {
            color: #f44336;
        }

        .prediction-metric .value.neutral {
            color: #ff9800;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .loading i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .error {
            text-align: center;
            padding: 40px;
            color: var(--danger);
        }

        .refresh-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .refresh-btn:hover {
            background: var(--accent);
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            
            .teams-matchup {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .betting-analysis {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-basketball-ball"></i> NBA Betting Analysis</h1>
            <p>Análise inteligente de apostas com métricas consolidadas e previsões baseadas em dados</p>
        </div>

        <div id="games-container" class="games-grid">
            <div class="loading">
                <i class="fas fa-spinner"></i>
                <p>Carregando jogos e análises...</p>
            </div>
        </div>

        <button class="refresh-btn" onclick="loadGames()">
            <i class="fas fa-sync-alt"></i> Atualizar Dados
        </button>
        
        <!-- Seção de Ferramentas de Previsão -->
        <div class="prediction-tools">
            <h3><i class="fas fa-crystal-ball"></i> Ferramentas de Previsão</h3>
            <div class="prediction-grid">
                <div class="prediction-card">
                    <h4>Simulação Monte Carlo</h4>
                    <div id="monte-carlo-results" class="prediction-results">
                        <!-- Resultados da simulação serão inseridos aqui -->
                    </div>
                </div>
                <div class="prediction-card">
                    <h4>Análise de Correlação</h4>
                    <div id="correlation-analysis" class="prediction-results">
                        <!-- Análise de correlação será inserida aqui -->
                    </div>
                </div>
                <div class="prediction-card">
                    <h4>Gestão de Banca</h4>
                    <div id="bankroll-management" class="prediction-results">
                        <!-- Gestão de banca será inserida aqui -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="betting-calculator.js"></script>
    <script>
        // Configuração da API
        const API_BASE = 'https://api.sportsdata.io/v3/nba';
        const API_KEY = 'your-api-key'; // Substitua pela sua chave da API

        // Cache para otimizar requisições
        const cache = new Map();
        const CACHE_DURATION = 5 * 60 * 1000; // 5 minutos

        // Inicializar calculadoras
        const bettingCalc = new BettingCalculator();
        const trendAnalyzer = new TrendAnalyzer();

        // Função para fazer requisições com cache
        async function fetchWithCache(url) {
            const now = Date.now();
            const cached = cache.get(url);
            
            if (cached && (now - cached.timestamp) < CACHE_DURATION) {
                return cached.data;
            }

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                cache.set(url, { data, timestamp: now });
                return data;
            } catch (error) {
                console.error('Fetch error:', error);
                // Retorna dados mock em caso de erro
                return getMockData(url);
            }
        }

        // Dados mock para demonstração
        function getMockData(url) {
            if (url.includes('games')) {
                return [
                    {
                        GameID: 1,
                        DateTime: new Date().toISOString(),
                        HomeTeam: 'LAL',
                        AwayTeam: 'GSW',
                        HomeTeamName: 'Los Angeles Lakers',
                        AwayTeamName: 'Golden State Warriors',
                        Status: 'Scheduled',
                        PointSpread: -3.5,
                        OverUnder: 225.5
                    },
                    {
                        GameID: 2,
                        DateTime: new Date(Date.now() + 3600000).toISOString(),
                        HomeTeam: 'BOS',
                        AwayTeam: 'MIA',
                        HomeTeamName: 'Boston Celtics',
                        AwayTeamName: 'Miami Heat',
                        Status: 'Scheduled',
                        PointSpread: -7,
                        OverUnder: 218
                    }
                ];
            }
            return {};
        }

        // Função principal para carregar jogos
        async function loadGames() {
            const container = document.getElementById('games-container');
            
            try {
                container.innerHTML = `
                    <div class="loading">
                        <i class="fas fa-spinner"></i>
                        <p>Carregando jogos e análises...</p>
                    </div>
                `;

                // Buscar jogos de hoje
                const today = new Date().toISOString().split('T')[0];
                const games = await fetchWithCache(`${API_BASE}/scores/json/GamesByDate/${today}?key=${API_KEY}`);
                
                if (!games || games.length === 0) {
                    container.innerHTML = `
                        <div class="error">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>Nenhum jogo encontrado para hoje</p>
                        </div>
                    `;
                    return;
                }

                // Renderizar jogos
                container.innerHTML = '';
                for (const game of games) {
                    const gameCard = await createGameCard(game);
                    container.appendChild(gameCard);
                }

            } catch (error) {
                console.error('Error loading games:', error);
                container.innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Erro ao carregar dados. Tentando novamente...</p>
                    </div>
                `;
            }
        }

        // Criar card do jogo com análise completa
        async function createGameCard(game) {
            const card = document.createElement('div');
            card.className = 'game-card';

            // Calcular análises
            const analysis = await calculateBettingAnalysis(game);
            const predictions = generatePredictions(game, analysis);
            const keyFactors = getKeyFactors(game, analysis);

            card.innerHTML = `
                <div class="game-header">
                    <div class="game-time">
                        ${formatGameTime(game.DateTime)}
                    </div>
                    ${game.Status === 'InProgress' ? '<div class="live-indicator">AO VIVO</div>' : ''}
                </div>

                <div class="teams-matchup">
                    <div class="team">
                        <div class="team-logo">
                            ${getTeamEmoji(game.AwayTeam)}
                        </div>
                        <div class="team-name">${game.AwayTeamName}</div>
                        <div class="team-record">${analysis.awayRecord || '0-0'}</div>
                    </div>
                    
                    <div class="vs-section">
                        <div class="vs-text">VS</div>
                        <div class="spread">
                            ${game.PointSpread ? `Spread: ${game.PointSpread > 0 ? '+' : ''}${game.PointSpread}` : 'Sem linha'}
                        </div>
                    </div>
                    
                    <div class="team">
                        <div class="team-logo">
                            ${getTeamEmoji(game.HomeTeam)}
                        </div>
                        <div class="team-name">${game.HomeTeamName}</div>
                        <div class="team-record">${analysis.homeRecord || '0-0'}</div>
                    </div>
                </div>

                <div class="betting-analysis">
                    <div class="analysis-section">
                        <div class="section-title">
                            <i class="fas fa-chart-line"></i>
                            Linhas Principais
                        </div>
                        <div class="betting-lines">
                            <div class="betting-line">
                                <span class="line-type">Spread</span>
                                <span class="line-value">${game.PointSpread || 'N/A'}</span>
                            </div>
                            <div class="betting-line">
                                <span class="line-type">Total (O/U)</span>
                                <span class="line-value">${game.OverUnder || 'N/A'}</span>
                            </div>
                            <div class="betting-line">
                                <span class="line-type">Moneyline</span>
                                <span class="line-value">${analysis.moneyline || 'N/A'}</span>
                            </div>
                        </div>
                    </div>

                    <div class="analysis-section">
                        <div class="section-title">
                            <i class="fas fa-target"></i>
                            Previsões
                        </div>
                        <div class="predictions-grid">
                            ${predictions.map(pred => `
                                <div class="prediction">
                                    <span class="prediction-market">${pred.market}</span>
                                    <div class="prediction-pick">
                                        <span>${pred.pick}</span>
                                        <span class="pick-confidence ${pred.confidence.toLowerCase()}">${pred.confidence}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="analysis-section">
                        <div class="section-title">
                            <i class="fas fa-exclamation-circle"></i>
                            Fatores Chave
                        </div>
                        <div class="key-factors">
                            ${keyFactors.map(factor => `
                                <div class="factor ${factor.type}">
                                    <i class="factor-icon ${factor.icon}"></i>
                                    <span>${factor.text}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="analysis-section">
                        <div class="section-title">
                            <i class="fas fa-balance-scale"></i>
                            Comparação
                        </div>
                        <div class="stats-comparison">
                            ${generateStatsComparison(analysis)}
                        </div>
                    </div>

                    <div class="analysis-section">
                        <div class="section-title">
                            <i class="fas fa-calculator"></i>
                            Análise de Valor
                        </div>
                        <div class="value-analysis">
                            ${generateValueAnalysis(game, analysis)}
                        </div>
                    </div>

                    <div class="analysis-section">
                        <div class="section-title">
                            <i class="fas fa-chart-area"></i>
                            Tendências
                        </div>
                        <div class="trends-analysis">
                            ${generateTrendsAnalysis(game, analysis)}
                        </div>
                    </div>
                </div>
            `;

            return card;
        }

        // Calcular análise de apostas
        async function calculateBettingAnalysis(game) {
            // Simulação de análise baseada em dados reais
            const homeAdvantage = 3; // Vantagem de jogar em casa
            const analysis = {
                homeRecord: `${Math.floor(Math.random() * 30) + 20}-${Math.floor(Math.random() * 20) + 10}`,
                awayRecord: `${Math.floor(Math.random() * 30) + 15}-${Math.floor(Math.random() * 25) + 15}`,
                homeAvgPoints: Math.floor(Math.random() * 30) + 100,
                awayAvgPoints: Math.floor(Math.random() * 30) + 95,
                homeDefRating: Math.floor(Math.random() * 20) + 100,
                awayDefRating: Math.floor(Math.random() * 20) + 105,
                pace: Math.floor(Math.random() * 10) + 95,
                moneyline: `${game.HomeTeam} -150 / ${game.AwayTeam} +130`
            };

            return analysis;
        }

        // Gerar previsões baseadas na análise
        function generatePredictions(game, analysis) {
            const predictions = [];

            // Spread
            if (game.PointSpread) {
                const confidence = Math.abs(game.PointSpread) > 7 ? 'HIGH' : 
                                 Math.abs(game.PointSpread) > 3 ? 'MEDIUM' : 'LOW';
                predictions.push({
                    market: 'Spread',
                    pick: game.PointSpread > 0 ? `${game.AwayTeam} +${Math.abs(game.PointSpread)}` : `${game.HomeTeam} ${game.PointSpread}`,
                    confidence
                });
            }

            // Total
            if (game.OverUnder) {
                const totalPrediction = (analysis.homeAvgPoints + analysis.awayAvgPoints) / 2;
                const pick = totalPrediction > game.OverUnder ? 'OVER' : 'UNDER';
                const confidence = Math.abs(totalPrediction - game.OverUnder) > 10 ? 'HIGH' : 
                                 Math.abs(totalPrediction - game.OverUnder) > 5 ? 'MEDIUM' : 'LOW';
                predictions.push({
                    market: 'Total',
                    pick: `${pick} ${game.OverUnder}`,
                    confidence
                });
            }

            // Player Props (simulado)
            predictions.push({
                market: 'Pontos Jogador',
                pick: 'LeBron James Over 25.5',
                confidence: 'MEDIUM'
            });

            return predictions;
        }

        // Obter fatores chave que influenciam o jogo
        function getKeyFactors(game, analysis) {
            const factors = [];

            // Vantagem de casa
            factors.push({
                type: 'positive',
                icon: 'fas fa-home',
                text: `${game.HomeTeamName} joga em casa`
            });

            // Forma recente (simulado)
            if (Math.random() > 0.5) {
                factors.push({
                    type: 'positive',
                    icon: 'fas fa-fire',
                    text: `${game.HomeTeamName} venceu 4 dos últimos 5 jogos`
                });
            } else {
                factors.push({
                    type: 'negative',
                    icon: 'fas fa-arrow-down',
                    text: `${game.AwayTeamName} perdeu 3 dos últimos 5 jogos`
                });
            }

            // Lesões (simulado)
            if (Math.random() > 0.7) {
                factors.push({
                    type: 'negative',
                    icon: 'fas fa-user-injured',
                    text: 'Jogador estrela questionável por lesão'
                });
            }

            // Back-to-back (simulado)
            if (Math.random() > 0.8) {
                factors.push({
                    type: 'negative',
                    icon: 'fas fa-clock',
                    text: 'Time visitante em back-to-back'
                });
            }

            return factors;
        }

        // Gerar comparação de estatísticas
        function generateStatsComparison(analysis) {
            const stats = [
                { label: 'Pontos/Jogo', home: analysis.homeAvgPoints, away: analysis.awayAvgPoints },
                { label: 'Def. Rating', home: analysis.homeDefRating, away: analysis.awayDefRating },
                { label: 'Pace', home: analysis.pace, away: analysis.pace + Math.floor(Math.random() * 10) - 5 }
            ];

            return stats.map(stat => {
                const homeAdvantage = stat.home > stat.away ? 'stat-advantage' : '';
                const awayAdvantage = stat.away > stat.home ? 'stat-advantage' : '';
                
                return `
                    <div class="stat-row">
                        <div class="stat-value ${homeAdvantage}">${stat.home}</div>
                        <div class="stat-label">${stat.label}</div>
                        <div class="stat-value ${awayAdvantage}">${stat.away}</div>
                    </div>
                `;
            }).join('');
        }

        // Utilitários
        function formatGameTime(dateTime) {
            const date = new Date(dateTime);
            return date.toLocaleTimeString('pt-BR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        function getTeamEmoji(teamCode) {
            const emojis = {
                'LAL': '🏀', 'GSW': '⚡', 'BOS': '🍀', 'MIA': '🔥',
                'CHI': '🐂', 'NYK': '🗽', 'LAC': '📎', 'PHX': '☀️'
            };
            return emojis[teamCode] || '🏀';
        }

        // Gerar análise de valor
        function generateValueAnalysis(game, analysis) {
            const valueBets = [];
            
            // Análise do spread
            if (game.PointSpread) {
                const spreadAnalysis = bettingCalc.analyzeSpread(
                    { rating: analysis.homeAvgPoints }, 
                    { rating: analysis.awayAvgPoints }, 
                    game.PointSpread
                );
                
                const spreadOdds = -110; // Odds padrão
                const spreadProb = spreadAnalysis.recommendation === 'HOME TEAM' ? 0.55 : 0.52;
                const spreadEV = bettingCalc.calculateExpectedValue(spreadOdds, spreadProb);
                const kelly = bettingCalc.calculateKellyCriterion(spreadProb, spreadOdds);
                
                valueBets.push({
                    market: 'Spread',
                    pick: `${game.HomeTeamName} ${game.PointSpread}`,
                    ev: spreadEV.ev,
                    kelly: kelly.recommendedStake,
                    isValue: spreadEV.isValueBet
                });
            }
            
            // Análise do total
            if (game.OverUnder) {
                const totalAnalysis = bettingCalc.analyzeOverUnderTrends(
                    { pointsFor: analysis.homeAvgPoints, pointsAgainst: 105, pace: 100, defRating: analysis.homeDefRating },
                    { pointsFor: analysis.awayAvgPoints, pointsAgainst: 108, pace: 98, defRating: analysis.awayDefRating }
                );
                
                const totalOdds = -110;
                const totalProb = totalAnalysis.projectedTotal > game.OverUnder ? 0.58 : 0.48;
                const totalEV = bettingCalc.calculateExpectedValue(totalOdds, totalProb);
                const kelly = bettingCalc.calculateKellyCriterion(totalProb, totalOdds);
                
                valueBets.push({
                    market: 'Total',
                    pick: totalAnalysis.projectedTotal > game.OverUnder ? `OVER ${game.OverUnder}` : `UNDER ${game.OverUnder}`,
                    ev: totalEV.ev,
                    kelly: kelly.recommendedStake,
                    isValue: totalEV.isValueBet
                });
            }
            
            return valueBets.map(bet => `
                <div class="value-bet ${bet.isValue ? 'positive' : 'negative'}">
                    <div class="value-info">
                        <div class="value-market">${bet.market}</div>
                        <div class="value-details">${bet.pick}</div>
                    </div>
                    <div class="value-score">
                        <div class="ev-value ${bet.ev > 0 ? 'positive' : 'negative'}">
                            ${bet.ev > 0 ? '+' : ''}${(bet.ev * 100).toFixed(1)}%
                        </div>
                        <div class="kelly-percentage">Kelly: ${bet.kelly.toFixed(1)}%</div>
                    </div>
                </div>
            `).join('');
        }

        // Gerar análise de tendências
        function generateTrendsAnalysis(game, analysis) {
            const trends = [];
            
            // Tendência Over/Under
            const overUnderTrend = trendAnalyzer.analyzeOverUnderTrends(
                { name: game.HomeTeamName, homeOverRate: 0.55, awayOverRate: 0.48 },
                { name: game.AwayTeamName, homeOverRate: 0.52, awayOverRate: 0.51 },
                { 
                    isHome: true, 
                    dayOfWeek: new Date().toLocaleLowerCase().substring(0, 3),
                    isNationalTV: Math.random() > 0.8 
                }
            );
            
            trends.push({
                title: 'Tendência Over/Under',
                description: `${overUnderTrend.recommendation} baseado em análise histórica`,
                type: overUnderTrend.recommendation === 'OVER' ? 'bullish' : 
                      overUnderTrend.recommendation === 'UNDER' ? 'bearish' : 'neutral',
                icon: overUnderTrend.recommendation === 'OVER' ? 'fas fa-arrow-up' : 
                      overUnderTrend.recommendation === 'UNDER' ? 'fas fa-arrow-down' : 'fas fa-minus',
                stats: [
                    { label: 'Taxa Over', value: `${(overUnderTrend.consolidatedOverRate * 100).toFixed(1)}%` },
                    { label: 'Confiança', value: overUnderTrend.confidence }
                ]
            });
            
            // Tendência de forma recente
            const homeForm = Math.random() > 0.5 ? 'boa' : 'ruim';
            const awayForm = Math.random() > 0.5 ? 'boa' : 'ruim';
            
            if (homeForm === 'boa' || awayForm === 'boa') {
                trends.push({
                    title: 'Forma Recente',
                    description: `${homeForm === 'boa' ? game.HomeTeamName : game.AwayTeamName} em boa forma`,
                    type: 'bullish',
                    icon: 'fas fa-fire',
                    stats: [
                        { label: 'Últimos 5', value: '4-1' },
                        { label: 'Média Pontos', value: '+5.2' }
                    ]
                });
            }
            
            // Tendência de lesões
            if (Math.random() > 0.7) {
                trends.push({
                    title: 'Relatório de Lesões',
                    description: 'Jogador chave questionável para o jogo',
                    type: 'bearish',
                    icon: 'fas fa-user-injured',
                    stats: [
                        { label: 'Status', value: 'Questionável' },
                        { label: 'Impacto', value: 'Alto' }
                    ]
                });
            }
            
            // Tendência de motivação
            const isPlayoffs = Math.random() > 0.8;
            if (isPlayoffs) {
                trends.push({
                    title: 'Fator Motivacional',
                    description: 'Jogo importante para classificação aos playoffs',
                    type: 'bullish',
                    icon: 'fas fa-trophy',
                    stats: [
                        { label: 'Importância', value: 'Alta' },
                        { label: 'Pressão', value: 'Máxima' }
                    ]
                });
            }
            
            return trends.map(trend => `
                <div class="trend-item">
                    <div class="trend-icon ${trend.type}">
                        <i class="${trend.icon}"></i>
                    </div>
                    <div class="trend-content">
                        <div class="trend-title">${trend.title}</div>
                        <div class="trend-description">${trend.description}</div>
                        <div class="trend-stats">
                            ${trend.stats.map(stat => `
                                <div class="trend-stat">
                                    <strong>${stat.label}:</strong> ${stat.value}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Gerar ferramentas de previsão
        function generatePredictionTools(game, analysis) {
            // Simulação Monte Carlo
            const monteCarloResults = runMonteCarloSimulation(game, analysis);
            document.getElementById('monte-carlo-results').innerHTML = `
                <div class="prediction-metric">
                    <span class="label">Vitória ${game.HomeTeamName}:</span>
                    <span class="value ${monteCarloResults.homeWinProb > 0.5 ? 'positive' : 'negative'}">${(monteCarloResults.homeWinProb * 100).toFixed(1)}%</span>
                </div>
                <div class="prediction-metric">
                    <span class="label">Spread Médio:</span>
                    <span class="value neutral">${monteCarloResults.avgSpread.toFixed(1)}</span>
                </div>
                <div class="prediction-metric">
                    <span class="label">Total Médio:</span>
                    <span class="value neutral">${monteCarloResults.avgTotal.toFixed(1)}</span>
                </div>
                <div class="prediction-metric">
                    <span class="label">Simulações:</span>
                    <span class="value neutral">10,000</span>
                </div>
            `;
            
            // Análise de Correlação
            const correlationData = analyzeCorrelations(game, analysis);
            document.getElementById('correlation-analysis').innerHTML = `
                <div class="prediction-metric">
                    <span class="label">Pace vs Total:</span>
                    <span class="value ${correlationData.paceTotal > 0.7 ? 'positive' : 'neutral'}">${correlationData.paceTotal.toFixed(3)}</span>
                </div>
                <div class="prediction-metric">
                    <span class="label">Defesa vs Under:</span>
                    <span class="value ${correlationData.defenseUnder > 0.6 ? 'positive' : 'neutral'}">${correlationData.defenseUnder.toFixed(3)}</span>
                </div>
                <div class="prediction-metric">
                    <span class="label">Home vs Spread:</span>
                    <span class="value ${correlationData.homeSpread > 0.5 ? 'positive' : 'neutral'}">${correlationData.homeSpread.toFixed(3)}</span>
                </div>
                <div class="prediction-metric">
                    <span class="label">Força da Correlação:</span>
                    <span class="value ${correlationData.strength === 'Alta' ? 'positive' : correlationData.strength === 'Média' ? 'neutral' : 'negative'}">${correlationData.strength}</span>
                </div>
            `;
            
            // Gestão de Banca
            const bankrollData = calculateBankrollManagement(game, analysis);
            document.getElementById('bankroll-management').innerHTML = `
                <div class="prediction-metric">
                    <span class="label">Kelly Criterion:</span>
                    <span class="value ${bankrollData.kelly > 0 ? 'positive' : 'negative'}">${bankrollData.kelly.toFixed(2)}%</span>
                </div>
                <div class="prediction-metric">
                    <span class="label">Stake Recomendado:</span>
                    <span class="value neutral">${bankrollData.recommendedStake.toFixed(1)}%</span>
                </div>
                <div class="prediction-metric">
                    <span class="label">Risco/Retorno:</span>
                    <span class="value ${bankrollData.riskLevel === 'Baixo' ? 'positive' : bankrollData.riskLevel === 'Médio' ? 'neutral' : 'negative'}">${bankrollData.riskLevel}</span>
                </div>
                <div class="prediction-metric">
                    <span class="label">ROI Esperado:</span>
                    <span class="value ${bankrollData.expectedROI > 0 ? 'positive' : 'negative'}">${bankrollData.expectedROI > 0 ? '+' : ''}${bankrollData.expectedROI.toFixed(1)}%</span>
                </div>
            `;
        }
        
        // Simulação Monte Carlo
        function runMonteCarloSimulation(game, analysis) {
            let homeWins = 0;
            let totalSpread = 0;
            let totalPoints = 0;
            const simulations = 10000;
            
            for (let i = 0; i < simulations; i++) {
                // Simular pontuação com variação aleatória
                const homeScore = analysis.homeAvgPoints + (Math.random() - 0.5) * 20;
                const awayScore = analysis.awayAvgPoints + (Math.random() - 0.5) * 20;
                
                if (homeScore > awayScore) homeWins++;
                totalSpread += homeScore - awayScore;
                totalPoints += homeScore + awayScore;
            }
            
            return {
                homeWinProb: homeWins / simulations,
                avgSpread: totalSpread / simulations,
                avgTotal: totalPoints / simulations
            };
        }
        
        // Análise de Correlações
        function analyzeCorrelations(game, analysis) {
            // Correlações simuladas baseadas em dados históricos típicos
            const paceTotal = 0.75 + (Math.random() - 0.5) * 0.2; // Pace geralmente correlaciona com total
            const defenseUnder = 0.65 + (Math.random() - 0.5) * 0.15; // Defesa forte correlaciona com under
            const homeSpread = 0.55 + (Math.random() - 0.5) * 0.1; // Vantagem de casa
            
            const avgCorrelation = (paceTotal + defenseUnder + homeSpread) / 3;
            let strength = 'Baixa';
            if (avgCorrelation > 0.7) strength = 'Alta';
            else if (avgCorrelation > 0.5) strength = 'Média';
            
            return {
                paceTotal,
                defenseUnder,
                homeSpread,
                strength
            };
        }
        
        // Gestão de Banca
        function calculateBankrollManagement(game, analysis) {
            // Calcular probabilidade implícita e Kelly
            const impliedProb = 0.52 + (Math.random() - 0.5) * 0.1; // Probabilidade estimada
            const bookmakerProb = 0.5238; // Probabilidade implícita de odds -110
            const edge = impliedProb - bookmakerProb;
            
            // Kelly Criterion: (bp - q) / b, onde b = odds decimais - 1, p = prob de ganhar, q = prob de perder
            const decimalOdds = 1.909; // Equivalente a -110
            const kelly = ((decimalOdds * impliedProb) - 1) / (decimalOdds - 1) * 100;
            
            // Stake recomendado (mais conservador que Kelly puro)
            const recommendedStake = Math.max(0, Math.min(kelly * 0.5, 5)); // Máximo 5% da banca
            
            // Nível de risco
            let riskLevel = 'Baixo';
            if (recommendedStake > 3) riskLevel = 'Alto';
            else if (recommendedStake > 1.5) riskLevel = 'Médio';
            
            // ROI esperado
            const expectedROI = edge * 100;
            
            return {
                kelly,
                recommendedStake,
                riskLevel,
                expectedROI
            };
        }

        // Inicializar aplicação
        document.addEventListener('DOMContentLoaded', function() {
            loadGames();
            
            // Gerar ferramentas de previsão com dados mock iniciais
            const mockGame = {
                HomeTeamName: 'Lakers',
                AwayTeamName: 'Warriors'
            };
            const mockAnalysis = {
                homeAvgPoints: 115,
                awayAvgPoints: 112
            };
            generatePredictionTools(mockGame, mockAnalysis);
        });
    </script>
</body>
</html>