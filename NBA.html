<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Oxanium', sans-serif;
            background: #000000;
            color: #ffffff;
            min-height: 100vh;
            padding-left: 70px;
        }

        /* SIDEBAR */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 70px;
            background: rgba(26, 26, 35, 0.95);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            transition: width 0.3s ease;
            z-index: 1000;
            overflow: hidden;
        }

        .sidebar:hover {
            width: 260px;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            padding: 20px 15px;
            gap: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            white-space: nowrap;
        }

        .sidebar-logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 700;
            background: linear-gradient(45deg, #00ff88, #00ffaa);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar:hover .sidebar-title {
            opacity: 1;
        }

        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }

        .sidebar-menu li {
            margin: 5px 0;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: #a0a0a0;
            text-decoration: none;
            transition: all 0.3s ease;
            gap: 15px;
            white-space: nowrap;
        }

        .sidebar-menu a:hover {
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
            transform: translateX(5px);
        }

        .sidebar-menu li.active a {
            background: linear-gradient(90deg, rgba(0, 255, 136, 0.2), transparent);
            color: #00ff88;
            border-left: 4px solid #00ff88;
        }

        .sidebar-menu .icon {
            font-size: 1.3rem;
            width: 30px;
            text-align: center;
            flex-shrink: 0;
        }

        .sidebar-menu .label {
            opacity: 0;
            transition: opacity 0.3s ease;
            font-weight: 500;
        }

        .sidebar:hover .sidebar-menu .label {
            opacity: 1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #00ff88;
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .logo {
            height: 50px;
            width: auto;
            filter: drop-shadow(0 0 10px #00ff88);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(90deg, #00ff88, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-top: 5px;
            font-size: 0.9rem;
        }

        /* Controls */
        .controls {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 30px 0;
        }

        .tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 12px 24px;
            border: 2px solid #00ff88;
            background: transparent;
            color: #00ff88;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .tab-btn:hover {
            background: rgba(0, 255, 136, 0.1);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: #00ff88;
            color: #000;
        }

        .filters-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .filters-row {
                grid-template-columns: 1fr;
            }
        }

        .date-selector,
        .team-selector {
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .date-selector label,
        .team-selector label {
            display: block;
            color: #00ff88;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .date-selector select,
        .team-selector select {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            cursor: pointer;
        }

        .date-selector select:focus,
        .team-selector select:focus {
            outline: none;
            border-color: #00ff88;
        }

        /* Team Stats */
        #teamStats {
            margin-bottom: 25px;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 80px 20px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(0, 255, 136, 0.2);
            border-top: 4px solid #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading p {
            font-size: 1.2rem;
            color: #00ff88;
            font-weight: 600;
        }

        /* Error & No Games */
        .message-box {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 68, 68, 0.5);
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
        }

        .message-box h2 {
            font-size: 2rem;
            margin-bottom: 15px;
            color: #ff4444;
        }

        .message-box p {
            color: #888;
            margin-bottom: 25px;
        }

        .retry-btn {
            padding: 15px 30px;
            background: rgba(255, 68, 68, 0.2);
            border: 2px solid #ff4444;
            color: #ff4444;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .retry-btn:hover {
            background: rgba(255, 68, 68, 0.3);
            transform: translateY(-2px);
        }

        /* Games Grid */
        .section-title {
            background: linear-gradient(90deg, #00ff88, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }

        /* Game Card */
        .game-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .game-card:hover {
            transform: translateY(-5px);
            border-color: #00ff88;
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.2);
        }

        .game-header {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .game-time {
            color: #00ff88;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .game-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .status-scheduled {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .status-live {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
            border: 1px solid rgba(34, 197, 94, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .status-ended {
            background: rgba(156, 163, 175, 0.2);
            color: #9ca3af;
            border: 1px solid rgba(156, 163, 175, 0.3);
        }

        .game-body {
            padding: 25px;
        }

        .team-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.2s ease;
        }

        .team-row:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .team-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .team-logo {
            width: 45px;
            height: 45px;
            object-fit: contain;
        }

        .team-details h3 {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 3px;
        }

        .team-details p {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .team-score {
            font-size: 2.5rem;
            font-weight: 900;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        /* Odds */
        .odds-section {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 255, 136, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 10px;
        }

        .odds-title {
            color: #00ff88;
            font-weight: 700;
            font-size: 0.85rem;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .odds-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            position: relative;
        }

        .odd-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .odd-item.hit {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            border: 1px solid #059669 !important;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.6);
            color: #fff;
        }
        .odd-item.miss {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
            border: 1px solid #dc2626 !important;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.6);
            color: #fff;
        }
        .odd-item.hit .odd-label,
        .odd-item.miss .odd-label {
            color: rgba(255, 255, 255, 0.9);
        }

        .odd-item.hit .odd-value,
        .odd-item.miss .odd-value {
            font-weight: 900;
        }

        .result-indicator {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 900;
            border: 2px solid #000;
            z-index: 10;
        }

        .result-hit {
            background: #10b981;
            color: white;
            animation: hitPulse 1.5s ease-in-out infinite;
            box-shadow: 0 0 12px rgba(16, 185, 129, 0.6);
        }

        .result-miss {
            background: #ef4444;
            color: white;
            animation: missShake 0.8s ease-in-out infinite;
            box-shadow: 0 0 12px rgba(239, 68, 68, 0.6);
        }

        @keyframes hitPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        @keyframes missShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        .odd-label {
            font-size: 0.7rem;
            color: #888;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .odd-value {
            font-size: 1rem;
            font-weight: 700;
            color: #fff;
            font-family: 'Oxanium', sans-serif;
        }

        /* H2H Button */
        .game-footer {
            padding: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .h2h-btn {
            display: inline-block;
            padding: 12px 24px;
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid #00ff88;
            color: #00ff88;
            border-radius: 10px;
            font-weight: 700;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .h2h-btn:hover {
            background: #00ff88;
            color: #000;
            transform: translateY(-2px);
        }

        /* Footer */
        footer {
            background: rgba(0, 0, 0, 0.6);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 30px 20px;
            text-align: center;
            margin-top: 60px;
        }

        footer p {
            color: #666;
            font-size: 0.9rem;
        }

        .footer-brand {
            color: #00ff88;
            font-weight: 700;
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding-left: 60px;
            }

            .sidebar {
                width: 60px;
            }

            .sidebar:hover {
                width: 220px;
            }

            h1 {
                font-size: 1.8rem;
            }

            .games-grid {
                grid-template-columns: 1fr;
            }

            .team-score {
                font-size: 2rem;
            }
        }
    </style>
</head>

<body>
    <!-- SIDEBAR -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <img src="https://i.ibb.co/G4Y8sHM/Chat-GPT-Image-21-de-abr-de-2025-16-14-34-1.png" alt="RW Tips"
                class="sidebar-logo">
            <span class="sidebar-title">RW TIPS</span>
        </div>
        <ul class="sidebar-menu">
            <li><a href="visualization.html"><span class="icon">‚öΩ</span><span class="label">Pr√≥ximos Jogos</span></a>
            </li>
            <li><a href="results.html"><span class="icon">üìä</span><span class="label">√öltimos Resultados</span></a>
            </li>
            <li><a href="live_v2.html"><span class="icon">üî¥</span><span class="label">AO VIVO</span></a></li>
            <li><a href="statistics.html"><span class="icon">üìà</span><span class="label">Estat√≠sticas das
                        Ligas</span></a></li>
            <li><a href="formularioApostas.html"><span class="icon">üí∞</span><span class="label">Registrar
                        Apostas</span></a></li>
            <li><a href="players.html"><span class="icon">üéÆ</span><span class="label">An√°lise de Jogadores</span></a>
            </li>
            <li><a href="dashboard.html"><span class="icon">üìã</span><span class="label">Dashboard</span></a></li>
            <li class="active"><a href="nba.html"><span class="icon">üèÄ</span><span class="label">NBA Stats</span></a>
            </li>
            <li><a href="radar.html"><span class="icon">üéØ</span><span class="label">Radar</span></a></li>
            <li><a href="over.html"><span class="icon">üìç</span><span class="label">Over Analysis</span></a></li>
        </ul>
    </nav>

    <header>
        <div class="container">
            <div class="header-content">
                <img src="https://i.ibb.co/G4Y8sHM/Chat-GPT-Image-21-de-abr-de-2025-16-14-34-1.png" alt="RW Tips"
                    class="logo">
                <div>
                    <h1>NBA Games</h1>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="controls">
            <div class="tabs">
                <button class="tab-btn active" id="fixturesTab">üìÖ Fixtures</button>
                <button class="tab-btn" id="liveTab">üî¥ Live Games</button>
                <button class="tab-btn" id="resultsTab">‚úÖ Results</button>
                <button class="tab-btn hidden" id="refreshBtn">üîÑ Refresh</button>
            </div>

            <div class="filters-row">
                <div class="date-selector" id="dateSelector">
                    <label>üìÜ Selecionar Data</label>
                    <select id="dateSelect">
                        <option value="">üóìÔ∏è Todas as datas</option>
                    </select>
                </div>

                <div class="team-selector" id="teamSelector">
                    <label>üèÄ Filtrar por Time</label>
                    <select id="teamSelect">
                        <option value="">üèÄ Todos os times</option>
                    </select>
                </div>
            </div>
        </div>

        <div id="teamStats" class="hidden"></div>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Carregando jogos...</p>
        </div>

        <!-- Mensagens e container -->
        <div id="error" class="message-box hidden">
            <h2>‚ö†Ô∏è Erro ao carregar jogos</h2>
            <p>Verifique sua conex√£o e tente novamente</p>
            <button class="retry-btn" id="retryBtn">üîÑ Tentar Novamente</button>
        </div>

        <div id="noGames" class="message-box hidden">
            <h2>üèÄ Nenhum jogo dispon√≠vel</h2>
            <p>Volte mais tarde para ver os jogos! üëë</p>
        </div>

        <div id="gamesContainer"></div>

        <script>
        const BASE_URL = 'https://webws.365scores.com';
        let currentTab = 'fixtures';
        let allGames = [];
        let allResults = [];
        let selectedDate = null;
        let selectedTeam = null;

        const fixturesTab = document.getElementById('fixturesTab');
        const liveTab = document.getElementById('liveTab');
        const resultsTab = document.getElementById('resultsTab');
        const refreshBtn = document.getElementById('refreshBtn');
        const dateSelector = document.getElementById('dateSelector');
        const dateSelect = document.getElementById('dateSelect');
        const teamSelector = document.getElementById('teamSelector');
        const teamSelect = document.getElementById('teamSelect');
        const teamStats = document.getElementById('teamStats');
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const noGames = document.getElementById('noGames');
        const gamesContainer = document.getElementById('gamesContainer');
        const retryBtn = document.getElementById('retryBtn');
        // Cache e controle de carregamento para evitar chamadas duplicadas
        let isLoading = false;
        const CACHE_TTL = { results: 5 * 60 * 1000, fixtures: 60 * 1000, live: 10 * 1000 };
        const cache = {
            results: { data: [], ts: 0 },
            fixtures: { data: [], ts: 0 },
            live: { data: [], ts: 0 }
        };

        function checkElements() {
            if (!fixturesTab || !liveTab || !resultsTab || !refreshBtn || !dateSelector || !dateSelect ||
                !teamSelector || !teamSelect || !teamStats || !loading || !error || !noGames || !gamesContainer || !retryBtn) {
                console.error('Erro: Elementos HTML essenciais n√£o encontrados!');
                showError();
                return false;
            }
            return true;
        }

        function showError() {
            loading.classList.add('hidden');
            error.classList.remove('hidden');
        }

        function showLoading() {
            loading.classList.remove('hidden');
            error.classList.add('hidden');
            noGames.classList.add('hidden');
            gamesContainer.innerHTML = '';
        }

        function getTeamScore(team) {
            let score = team.score !== undefined ? team.score :
                team.homeScore !== undefined ? team.homeScore :
                    team.awayScore !== undefined ? team.awayScore :
                        '-';
            if (score === -1) return '0';
            if (score === '-') return '-';
            return score;
        }

        function hasValidScore(game) {
            const homeScore = parseInt(getTeamScore(game.homeCompetitor)) || 0;
            const awayScore = parseInt(getTeamScore(game.awayCompetitor)) || 0;
            return (homeScore > 0 || awayScore > 0);
        }

        function analyzeOddsResults(game) {
            const homeScore = parseInt(getTeamScore(game.homeCompetitor)) || 0;
            const awayScore = parseInt(getTeamScore(game.awayCompetitor)) || 0;
            const totalPoints = homeScore + awayScore;
            
            const oddsPreview = game.oddsPreview?.cells || [];
            const odds = game.odds?.options || [];
            
            const spreadText = oddsPreview[0]?.text || '';
            const overUnderText = oddsPreview[1]?.text || '';
            
            const results = {
                spread: null,
                overUnder: null,
                homeML: null,
                awayML: null
            };

            // ANALISAR SPREAD (usa pontua√ß√£o ajustada: teamScore + spreadValue)
            if (spreadText) {
                const text = spreadText.toLowerCase();
                const homeName = game.homeCompetitor.name.toLowerCase();
                const awayName = game.awayCompetitor.name.toLowerCase();
                const valMatch = text.match(/([+-]?\s*\d+\.?\d*)/);
                if (valMatch) {
                    const spreadValue = parseFloat(valMatch[1].replace(/\s+/g, ''));
                    // Detectar para qual equipe o spread se aplica
                    const mentions = (name) => {
                        const tokens = name.split(/\s+/).filter(w => w.length > 3);
                        return tokens.some(tok => text.includes(tok));
                    };
                    let teamSide = null; // 'home' ou 'away'
                    if (text.includes('home') || mentions(homeName)) teamSide = 'home';
                    else if (text.includes('away') || mentions(awayName)) teamSide = 'away';

                    // Fallback: se n√£o identificar pelo nome, usar sinal do spread
                    // Geralmente favorito tem linha negativa
                    if (!teamSide) teamSide = spreadValue < 0 ? 'home' : 'away';

                    const teamScore = teamSide === 'home' ? homeScore : awayScore;
                    const oppScore = teamSide === 'home' ? awayScore : homeScore;
                    const adjusted = teamScore + spreadValue; // ex.: Warriors -1 => 137 - 1

                    results.spread = adjusted > oppScore ? 'hit' : 'miss';
                }
            }

            // ANALISAR OVER/UNDER
            if (overUnderText) {
                const ouMatch = overUnderText.match(/(over|under)\s*(\d+\.?\d*)/i);
                if (ouMatch) {
                    const side = ouMatch[1].toLowerCase();
                    const ouLine = parseFloat(ouMatch[2]);
                    results.overUnder = side === 'over' ? (totalPoints > ouLine ? 'hit' : 'miss')
                                                         : (totalPoints < ouLine ? 'hit' : 'miss');
                }
            }

            // ANALISAR MONEYLINE
            const homeML = odds.find(o => o.num === 1)?.rate?.american || null;
            const awayML = odds.find(o => o.num === 2)?.rate?.american || null;
            
            if (homeScore > awayScore && homeML) results.homeML = 'hit';
            if (awayScore > homeScore && homeML) results.homeML = 'miss';
            if (awayScore > homeScore && awayML) results.awayML = 'hit';
            if (homeScore > awayScore && awayML) results.awayML = 'miss';

            return results;
        }

        async function fetchResults() {
            let url = `${BASE_URL}/web/games/results/?appTypeId=5&langId=1&timezoneName=America/Manaus&userCountryId=21&competitions=103&showOdds=true&includeTopBettingOpportunity=1&topBookmaker=156`;
            let games = [];
            const today = new Date();
            today.setHours(23, 59, 59, 999);

            try {
                while (url) {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    const data = await response.json();

                    const finishedGames = (data.games || []).filter(game => {
                        const gameDate = new Date(game.startTime);
                        const hasValidScoreGame = hasValidScore(game);
                        return hasValidScoreGame && gameDate < today;
                    });

                    games = [...games, ...finishedGames];

                    const nextPage = data.paging?.nextPage;
                    url = nextPage ? `${BASE_URL}${nextPage}` : null;

                    if (games.length >= 200) break;
                }

                games.sort((a, b) => new Date(b.startTime) - new Date(a.startTime));
                return games;
            } catch (err) {
                throw err;
            }
        }

        async function fetchFixtures() {
            let url = `${BASE_URL}/web/games/fixtures/?appTypeId=5&langId=1&timezoneName=America/Manaus&userCountryId=21&competitions=103&showOdds=true&includeTopBettingOpportunity=1&topBookmaker=156`;
            let games = [];

            try {
                const now = new Date();
                const maxDate = new Date(now.getTime() + (3 * 24 * 60 * 60 * 1000));

                while (url) {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    const data = await response.json();

                    const filteredGames = (data.games || []).filter(game => {
                        const gameDate = new Date(game.startTime);
                        return gameDate >= now && gameDate <= maxDate;
                    });

                    games = [...games, ...filteredGames];

                    const lastGameDate = data.games && data.games.length > 0
                        ? new Date(data.games[data.games.length - 1].startTime)
                        : null;

                    if (lastGameDate && lastGameDate > maxDate) break;

                    const nextPage = data.paging?.nextPage;
                    url = nextPage ? `${BASE_URL}${nextPage}` : null;
                }

                games.sort((a, b) => new Date(a.startTime) - new Date(b.startTime));
                return games;
            } catch (err) {
                throw err;
            }
        }

        async function fetchLiveGames() {
            const url = `${BASE_URL}/web/standings/?appTypeId=5&langId=1&timezoneName=America/Manaus&userCountryId=21&competitions=103&live=true&withSeasonsFilter=true`;
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();
                return data.games || [];
            } catch (err) {
                throw err;
            }
        }

        async function loadGames(force = false) {
            if (!checkElements()) return;

            // Evitar m√∫ltiplas execu√ß√µes concorrentes
            if (isLoading) return;
            isLoading = true;

            try {
                showLoading();

                const now = Date.now();
                if (currentTab === 'live') {
                    if (!force && cache.live.data.length && (now - cache.live.ts) < CACHE_TTL.live) {
                        allGames = cache.live.data;
                    } else {
                        const data = await fetchLiveGames();
                        cache.live = { data, ts: Date.now() };
                        allGames = data;
                    }
                } else if (currentTab === 'results') {
                    if (!force && cache.results.data.length && (now - cache.results.ts) < CACHE_TTL.results) {
                        allResults = cache.results.data;
                        allGames = allResults;
                    } else {
                        allResults = await fetchResults();
                        cache.results = { data: allResults, ts: Date.now() };
                        allGames = allResults;
                    }
                } else {
                    if (!force && cache.fixtures.data.length && (now - cache.fixtures.ts) < CACHE_TTL.fixtures) {
                        allGames = cache.fixtures.data;
                    } else {
                        const data = await fetchFixtures();
                        cache.fixtures = { data, ts: Date.now() };
                        allGames = data;
                    }
                }

                loading.classList.add('hidden');

                if (allGames.length === 0) {
                    noGames.classList.remove('hidden');
                    return;
                }
                renderGames();
            } catch (err) {
                console.error('Erro ao carregar jogos:', err);
                loading.classList.add('hidden');
                error.classList.remove('hidden');
            } finally {
                isLoading = false;
            }
        }

        function renderGames() {
            if (!checkElements()) return;

            const grouped = groupGamesByDate();
            const dates = Object.keys(grouped).sort((a, b) => {
                const dateA = new Date(grouped[a][0].startTime);
                const dateB = new Date(grouped[b][0].startTime);
                return currentTab === 'results' ? dateB - dateA : dateA - dateB;
            });

            if (currentTab === 'fixtures' || currentTab === 'results') {
                dateSelect.innerHTML = '<option value="">üóìÔ∏è Todas as datas</option>';
                dates.forEach(date => {
                    const option = document.createElement('option');
                    option.value = date;
                    option.textContent = date;
                    if (date === selectedDate) option.selected = true;
                    dateSelect.appendChild(option);
                });
            }

            if (currentTab === 'results') {
                const teams = new Set();
                allResults.forEach(game => {
                    teams.add(game.homeCompetitor.name);
                    teams.add(game.awayCompetitor.name);
                });

                teamSelect.innerHTML = '<option value="">üèÄ Todos os times</option>';
                [...teams].sort().forEach(team => {
                    const option = document.createElement('option');
                    option.value = team;
                    option.textContent = team;
                    if (team === selectedTeam) option.selected = true;
                    teamSelect.appendChild(option);
                });
            }

            let filteredGames = allGames;

            // Atualizar estat√≠sticas do time se selecionado
            if (currentTab === 'results' && selectedTeam) {
                const teamGames = allGames.filter(game =>
                    game.homeCompetitor.name === selectedTeam ||
                    game.awayCompetitor.name === selectedTeam
                );
                updateTeamStats(teamGames, selectedTeam);
            } else if (teamStats) {
                teamStats.classList.add('hidden');
            }

            if (currentTab === 'results' && selectedTeam && filteredGames.length === 0) {
                gamesContainer.innerHTML = `
                    <div class="message-box" style="border-color: rgba(0,255,136,0.5); background: rgba(0,255,136,0.1);">
                        <h2>üîç Nenhum jogo encontrado</h2>
                        <p>Para <strong>${selectedTeam}</strong></p>
                        <p>Tente outra data ou limpe o filtro üëë</p>
                    </div>
                `;
                return;
            }

            const displayDates = currentTab === 'live'
                ? ['üî¥ JOGOS AO VIVO']
                : (selectedDate ? [selectedDate] : dates);

            gamesContainer.innerHTML = '';

            displayDates.forEach(date => {
                let games = currentTab === 'live'
                    ? filteredGames
                    : (selectedDate ? grouped[selectedDate] || [] : grouped[date] || []);

                // No Live: mostrar apenas partidas em andamento
                if (currentTab === 'live' && games) {
                    games = games.filter(g => {
                        const s = (g.statusText || '').toLowerCase();
                        return s.includes('q') || s.includes('half') || s.includes('live') || s.includes('progress');
                    });
                }

                // Aplicar filtro de time se estiver na aba results e um time estiver selecionado
                if (currentTab === 'results' && selectedTeam && games) {
                    games = games.filter(game =>
                        game.homeCompetitor.name === selectedTeam ||
                        game.awayCompetitor.name === selectedTeam
                    );
                }

                if (!games || games.length === 0) return;

                const section = document.createElement('div');
                section.innerHTML = `
                    <h2 class="section-title">${date}</h2>
                    <div class="games-grid">
                        ${games.map(game => createGameCard(game)).join('')}
                    </div>
                `;
                gamesContainer.appendChild(section);
            });
        }

        function updateTeamStats(games, teamName) {
            let totalPoints = 0;
            let gamesPlayed = games.length;
            let wins = 0;
            let losses = 0;

            games.forEach(game => {
                const homeScore = parseInt(getTeamScore(game.homeCompetitor)) || 0;
                const awayScore = parseInt(getTeamScore(game.awayCompetitor)) || 0;

                if (game.homeCompetitor.name === teamName) {
                    totalPoints += homeScore;
                    if (homeScore > awayScore) wins++;
                    else if (homeScore < awayScore) losses++;
                } else if (game.awayCompetitor.name === teamName) {
                    totalPoints += awayScore;
                    if (awayScore > homeScore) wins++;
                    else if (awayScore < homeScore) losses++;
                }
            });

            const avgPoints = gamesPlayed > 0 ? (totalPoints / gamesPlayed).toFixed(1) : 0;
            const winRate = gamesPlayed > 0 ? ((wins / gamesPlayed) * 100).toFixed(1) : 0;

            teamStats.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; padding: 20px; background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 212, 255, 0.1)); border: 2px solid rgba(0, 255, 136, 0.4); border-radius: 15px; margin-bottom: 25px;">
                    <div style="text-align: center;">
                        <div style="font-size: 0.8rem; color: #888; margin-bottom: 5px;">üèÄ Time</div>
                        <div style="font-size: 1.2rem; font-weight: 800; color: #00ff88; text-shadow: 0 0 8px rgba(0,255,136,0.5);">${teamName}</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 0.8rem; color: #888; margin-bottom: 5px;">üìä Jogos</div>
                        <div style="font-size: 1.6rem; font-weight: 900; color: #fff;">${gamesPlayed}</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 0.8rem; color: #888; margin-bottom: 5px;">üìà M√©dia Pontos</div>
                        <div style="font-size: 1.8rem; font-weight: 900; color: #00ff88; text-shadow: 0 0 10px rgba(0,255,136,0.6);">${avgPoints}</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 0.8rem; color: #888; margin-bottom: 5px;">üéØ Total Pontos</div>
                        <div style="font-size: 1.6rem; font-weight: 900; color: #fff;">${totalPoints}</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 0.8rem; color: #888; margin-bottom: 5px;">üèÜ Vit√≥rias</div>
                        <div style="font-size: 1.6rem; font-weight: 900; color: #ffd700;">${wins}</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 0.8rem; color: #888; margin-bottom: 5px;">üìâ Derrotas</div>
                        <div style="font-size: 1.6rem; font-weight: 900; color: #ff6b6b;">${losses}</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 0.8rem; color: #888; margin-bottom: 5px;">üìä % Vit√≥rias</div>
                        <div style="font-size: 1.6rem; font-weight: 900; color: #00d4ff;">${winRate}%</div>
                    </div>
                </div>
            `;
            teamStats.classList.remove('hidden');
        }

        function groupGamesByDate() {
            return allGames.reduce((acc, game) => {
                const gameDate = new Date(game.startTime);
                const dateKey = gameDate.toLocaleDateString('pt-BR', {
                    timeZone: 'America/Manaus',
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                }).toUpperCase();
                if (!acc[dateKey]) acc[dateKey] = [];
                acc[dateKey].push(game);
                return acc;
            }, {});
        }

        function createGameCard(game) {
            const homeTeam = game.homeCompetitor;
            const awayTeam = game.awayCompetitor;
            const status = game.statusText || 'Finalizado';
            const oddsPreview = game.oddsPreview?.cells || [];
            const odds = game.odds?.options || [];

            const localTime = new Date(game.startTime).toLocaleTimeString('pt-BR', {
                timeZone: 'America/Manaus',
                hour: '2-digit',
                minute: '2-digit'
            });

            const isLive = status.includes('Q') || status.includes('Half') || status.includes('Live');
            const statusClass = status === 'Scheduled' || !status ? 'status-scheduled' :
                isLive ? 'status-live' : 'status-ended';

            const oddsResults = currentTab === 'results' ? analyzeOddsResults(game) : {};

            const homeML = odds.find(o => o.num === 1)?.rate?.american || '-';
            const awayML = odds.find(o => o.num === 2)?.rate?.american || '-';
            const spread = oddsPreview[0]?.text || '-';
            const overUnder = oddsPreview[1]?.text || '-';

            const homeScore = getTeamScore(homeTeam);
            const awayScore = getTeamScore(awayTeam);
            const timeLeft = game.gameTimeDisplay ? `${game.statusText} ‚Ä¢ ${game.gameTimeDisplay}` : '';

            // Construir o matchupId: homeId-awayId-competitionId
            const matchupId = `${homeTeam.id}-${awayTeam.id}-${game.competitionId}`;

            // Link para a p√°gina de H2H com par√¢metros na query string
            const h2hLink = `h2h_nba.html?gameId=${game.id}&matchupId=${matchupId}`;

            return `
                <div class="game-card">
                    <div class="game-header">
                        <div class="game-time">üïê ${localTime} ${timeLeft}</div>
                        <div class="game-status ${statusClass}">${isLive ? 'üî¥ ' : ''}${status}</div>
                    </div>

                    <div class="game-body">
                        <div class="team-row">
                            <div class="team-info">
                                <img src="https://imagecache.365scores.com/image/upload/f_png,w_50,h_50,c_limit,q_auto:eco,dpr_2,d_Competitors:default1.png/Competitors/${homeTeam.id}"
                                    alt="${homeTeam.name}" class="team-logo"
                                    onerror="this.src='https://imagecache.365scores.com/image/upload/f_png,w_50,h_50,c_limit,q_auto:eco,dpr_2,d_Competitors:default1.png/Competitors/default1'">
                                <div class="team-details">
                                    <h3>${homeTeam.name}</h3>
                                    <p>${homeTeam.symbolicName}</p>
                                </div>
                            </div>
                            <div class="team-score">${homeScore}</div>
                        </div>

                        <div class="team-row">
                            <div class="team-info">
                                <img src="https://imagecache.365scores.com/image/upload/f_png,w_50,h_50,c_limit,q_auto:eco,dpr_2,d_Competitors:default1.png/Competitors/${awayTeam.id}"
                                    alt="${awayTeam.name}" class="team-logo"
                                    onerror="this.src='https://imagecache.365scores.com/image/upload/f_png,w_50,h_50,c_limit,q_auto:eco,dpr_2,d_Competitors:default1.png/Competitors/default1'">
                                <div class="team-details">
                                    <h3>${awayTeam.name}</h3>
                                    <p>${awayTeam.symbolicName}</p>
                                </div>
                            </div>
                            <div class="team-score">${awayScore}</div>
                        </div>

                        ${(spread !== '-' || overUnder !== '-' || homeML !== '-' || awayML !== '-') ? `
                            <div class="odds-section">
                                <div class="odds-title">üí∞ ODDS</div>
                                <div class="odds-grid">
                                    <div class="odd-item ${oddsResults.spread || ''}">
                                        <div class="odd-label">Spread</div>
                                        <div class="odd-value">${spread}</div>
                                    </div>
                                    <div class="odd-item ${oddsResults.overUnder || ''}">
                                        <div class="odd-label">Over/Under</div>
                                        <div class="odd-value">${overUnder}</div>
                                    </div>
                                    <div class="odd-item ${oddsResults.homeML || ''}">
                                        <div class="odd-label">ML Home</div>
                                        <div class="odd-value">${homeML}</div>
                                    </div>
                                    <div class="odd-item ${oddsResults.awayML || ''}">
                                        <div class="odd-label">ML Away</div>
                                        <div class="odd-value">${awayML}</div>
                                    </div>
                                </div>
                            </div>
                        ` : ''}

                        <div class="game-footer">
                            <a href="${h2hLink}" class="h2h-btn">H2H Analysis</a>
                        </div>
                    </div>
                </div>
            `;
        }

        function switchTab(newTab) {
            currentTab = newTab;
            
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(newTab === 'fixtures' ? 'fixturesTab' : 
                                    newTab === 'live' ? 'liveTab' : 'resultsTab')
                    .classList.add('active');
            
            // Controlar visibilidade dos filtros baseado na aba
            dateSelector.classList.toggle('hidden', newTab === 'live');
            teamSelector.classList.toggle('hidden', newTab !== 'results'); // Mostrar apenas na aba Results
            refreshBtn.classList.toggle('hidden', newTab === 'fixtures');
            teamStats.classList.add('hidden');
            
            selectedDate = null;
            dateSelect.value = '';
            if (newTab !== 'results') {
                selectedTeam = null;
                teamSelect.value = '';
            }
            
            startAutoRefresh();
            loadGames();
        }

        if (dateSelect) {
            dateSelect.addEventListener('change', (e) => {
                selectedDate = e.target.value || null;
                renderGames();
            });
        }

        if (teamSelect) {
            teamSelect.addEventListener('change', (e) => {
                selectedTeam = e.target.value || null;
                if (selectedTeam) {
                    // Ir para resultados sem resetar sele√ß√£o
                    currentTab = 'results';
                    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                    resultsTab.classList.add('active');
                    dateSelector.classList.toggle('hidden', false);
                    refreshBtn.classList.toggle('hidden', false);

                    if (allResults.length === 0) {
                        loadGames();
                    } else {
                        allGames = allResults;
                        renderGames();
                    }
                } else {
                    renderGames();
                }
            });
        }

        if (refreshBtn) refreshBtn.addEventListener('click', () => loadGames(true));
        if (retryBtn) retryBtn.addEventListener('click', () => loadGames(true));

        let autoRefreshInterval = null;

        function startAutoRefresh() {
            if (autoRefreshInterval) clearInterval(autoRefreshInterval);

            if (currentTab === 'results') return;

            const interval = currentTab === 'live' ? 10 * 1000 : 2 * 60 * 1000;

            autoRefreshInterval = setInterval(() => {
                loadGames(true);
            }, interval);
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (checkElements()) {
                fixturesTab.addEventListener('click', () => switchTab('fixtures'));
                liveTab.addEventListener('click', () => switchTab('live'));
                resultsTab.addEventListener('click', () => switchTab('results'));
                
                // Aplicar estado inicial corretamente conforme a aba padr√£o
                switchTab(currentTab);
            }
        });
    </script>
</body>
</html>