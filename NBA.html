<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Stats - An√°lise Preditiva</title>
    <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --color-primary: #6B21A8;
            --color-accent: #9333EA;
            --color-bg-dark: #0A0A0A;
            --color-bg-medium: #141414;
            --color-text-primary: #E5E7EB;
            --color-text-secondary: #A1A1AA;
        }

        body {
            font-family: 'Oxanium', sans-serif;
            background: var(--color-bg-dark);
            color: var(--color-text-primary);
            padding: 24px 24px 24px 70px;
            min-height: 100vh;
        }

        .particles {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -1;
            top: 0;
            left: 0;
            opacity: 0.15;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(107, 33, 168, 0.5);
            border-radius: 50%;
            animation: particleFloat 40s infinite linear;
        }

        @keyframes particleFloat {
            0% { transform: translateY(0) translateX(0); opacity: 0; }
            10% { opacity: 0.8; }
            90% { opacity: 0.8; }
            100% { transform: translateY(-100vh) translateX(30px); opacity: 0; }
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 70px;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            transition: width 0.3s ease;
            z-index: 1000;
            overflow: hidden;
        }

        .sidebar:hover {
            width: 260px;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            padding: 20px 15px;
            gap: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .sidebar-logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--color-accent), #A855F7);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar:hover .sidebar-title {
            opacity: 1;
        }

        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: var(--color-text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
            gap: 15px;
        }

        .sidebar-menu a:hover {
            background: rgba(107, 33, 168, 0.1);
            color: var(--color-accent);
            transform: translateX(5px);
        }

        .sidebar-menu li.active a {
            background: linear-gradient(90deg, rgba(0, 255, 136, 0.2), transparent);
            color: var(--color-accent);
            border-left: 3px solid var(--color-accent);
        }

        .sidebar-menu .icon {
            font-size: 1.3rem;
            width: 30px;
            text-align: center;
            flex-shrink: 0;
        }

        .sidebar-menu .label {
            opacity: 0;
            transition: opacity 0.3s ease;
            font-weight: 600;
        }

        .sidebar:hover .sidebar-menu .label {
            opacity: 1;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            background: var(--color-bg-medium);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
            padding: 24px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 28px;
            color: #FFFFFF;
            letter-spacing: 1.5px;
            text-transform: uppercase;
        }

        .nav-buttons {
            display: flex;
            gap: 12px;
        }

        .nav-button {
            background: linear-gradient(45deg, var(--color-primary), var(--color-accent));
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            color: #FFFFFF;
            font-family: 'Oxanium', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-button:hover {
            background: linear-gradient(45deg, var(--color-accent), var(--color-primary));
            transform: translateY(-2px);
        }

        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .tab {
            background: #1F1F1F;
            padding: 10px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            white-space: nowrap;
        }

        .tab:hover {
            background: #2A2A2A;
            color: #FFFFFF;
            border-color: var(--color-primary);
        }

        .tab.active {
            background: linear-gradient(45deg, var(--color-primary), var(--color-accent));
            color: #FFFFFF;
        }

        .schedule {
            background: #1A1A1A;
            border-radius: 12px;
            overflow: hidden;
        }

        .day-header {
            background: #222222;
            padding: 12px;
            font-size: 16px;
            text-transform: uppercase;
            color: #FFFFFF;
            text-align: center;
            letter-spacing: 1px;
        }

        .match {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            background: #1F1F1F;
            position: relative;
        }

        .match:hover {
            background: linear-gradient(45deg, #2A2A2A, #333333);
        }

        .match:last-child {
            border-bottom: none;
        }

        .match.live-game {
            border-left: 4px solid #EF4444;
            background: rgba(239, 68, 68, 0.05);
        }

        .live-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #EF4444;
            color: #FFFFFF;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .opportunity-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: linear-gradient(135deg, #22C55E, #16A34A);
            color: #FFFFFF;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
        }

        .opportunity-badge.medium {
            background: linear-gradient(135deg, #F59E0B, #D97706);
        }

        .opportunity-badge.low {
            background: linear-gradient(135deg, #6B7280, #4B5563);
        }

        .match-header {
            font-size: 14px;
            color: #06B6D4;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .teams {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            width: 100%;
            margin-bottom: 12px;
        }

        .team {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            flex: 1;
            text-align: center;
        }

        .team img {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 2px solid #06B6D4;
        }

        .team-name {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .team-city {
            font-size: 16px;
            font-weight: 600;
            color: #FFFFFF;
        }

        .team-nickname {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        .team-record {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        .wins {
            color: #22C55E;
        }

        .losses {
            color: #EF4444;
        }

        .versus {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .score {
            font-size: 32px;
            color: #FFFFFF;
        }

        .time {
            font-size: 24px;
            color: #06B6D4;
        }

        .details button {
            background: linear-gradient(45deg, var(--color-primary), var(--color-accent));
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            color: #FFFFFF;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .details button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(107, 33, 168, 0.5);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.show {
            opacity: 1;
        }

        .modal-content {
            background: var(--color-bg-medium);
            border-radius: 16px;
            padding: 24px;
            max-width: 1100px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header h2 {
            font-size: 24px;
            color: #FFFFFF;
        }

        .close-btn {
            background: none;
            border: none;
            color: #EF4444;
            font-size: 24px;
            cursor: pointer;
        }

        .close-btn:hover {
            color: #06B6D4;
        }

        .predicted-score {
            background: linear-gradient(135deg, #1A1A1A, #2A2A2A);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .predicted-score-title {
            font-size: 14px;
            color: var(--color-text-secondary);
            margin-bottom: 12px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .predicted-score-value {
            font-size: 36px;
            font-weight: 700;
            color: #06B6D4;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .predicted-team {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .predicted-points {
            font-size: 48px;
        }

        .predicted-team-name {
            font-size: 14px;
            color: var(--color-text-secondary);
        }

        .smart-bets-container {
            background: #1A1A1A;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .confidence-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(107, 33, 168, 0.3);
        }

        .confidence-score {
            font-size: 28px;
            font-weight: 700;
            color: #22C55E;
        }

        .bet-tier {
            margin-bottom: 24px;
        }

        .tier-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .tier-header.premium { color: #22C55E; }
        .tier-header.solid { color: #06B6D4; }
        .tier-header.risky { color: #F59E0B; }

        .bet-card {
            background: #222222;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .bet-card:hover {
            background: #2A2A2A;
            transform: translateX(4px);
        }

        .bet-card.premium { border-color: #22C55E; }
        .bet-card.solid { border-color: #06B6D4; }
        .bet-card.risky { border-color: #F59E0B; }

        .bet-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .bet-title {
            font-size: 16px;
            font-weight: 600;
            color: #FFFFFF;
        }

        .bet-confidence {
            font-size: 20px;
            font-weight: 700;
        }

        .bet-card.premium .bet-confidence { color: #22C55E; }
        .bet-card.solid .bet-confidence { color: #06B6D4; }
        .bet-card.risky .bet-confidence { color: #F59E0B; }

        .bet-reasoning {
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-size: 13px;
            color: var(--color-text-secondary);
        }

        .reason-item::before {
            content: '‚ñ∏ ';
            color: var(--color-accent);
        }

        .context-section {
            background: rgba(107, 33, 168, 0.1);
            border: 1px solid rgba(107, 33, 168, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .context-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--color-accent);
            text-transform: uppercase;
            margin-bottom: 12px;
        }

        .context-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .context-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .error {
            color: #EF4444;
            padding: 16px;
            text-align: center;
        }

        @media (max-width: 768px) {
            body {
                padding-left: 60px;
            }
            .sidebar {
                width: 60px;
            }
            .sidebar:hover {
                width: 220px;
            }
        }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>

    <nav class="sidebar">
        <div class="sidebar-header">
            <img src="https://i.ibb.co/G4Y8sHMk/Chat-GPT-Image-21-de-abr-de-2025-16-14-34-1.png" alt="RW Tips" class="sidebar-logo">
            <span class="sidebar-title">RW Tips</span>
        </div>
        <ul class="sidebar-menu">
            <li><a href="visualization.html"><span class="icon">‚öΩ</span><span class="label">Pr√≥ximos Jogos</span></a></li>
            <li><a href="results.html"><span class="icon">üìä</span><span class="label">√öltimos Resultados</span></a></li>
            <li><a href="live_v2.html"><span class="icon">üî¥</span><span class="label">AO VIVO</span></a></li>
            <li><a href="statistics.html"><span class="icon">üìà</span><span class="label">Estat√≠sticas das Ligas</span></a></li>
            <li><a href="formularioApostas.html"><span class="icon">üí∞</span><span class="label">Registrar Apostas</span></a></li>
            <li><a href="players.html"><span class="icon">üéÆ</span><span class="label">An√°lise de Jogadores</span></a></li>
            <li><a href="dashboard.html"><span class="icon">üìã</span><span class="label">Dashboard</span></a></li>
            <li class="active"><a href="nba.html"><span class="icon">üèÄ</span><span class="label">NBA Stats</span></a></li>
            <li><a href="radar.html"><span class="icon">üéØ</span><span class="label">Radar</span></a></li>
            <li><a href="over.html"><span class="icon">üìç</span><span class="label">Over Analysis</span></a></li>
        </ul>
    </nav>

    <div class="container">
        <div class="header">
            <h1>üèÄ AN√ÅLISE PREDITIVA NBA</h1>
            <div class="nav-buttons">
                <button id="visualizationBtn" class="nav-button">üéÆ</button>
                <button id="logoutBtn" class="nav-button">Sair</button>
            </div>
        </div>
        <div class="tabs" id="tabs"></div>
        <div class="schedule" id="schedule"></div>
    </div>

    <div class="modal" id="gameStatsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle"></h2>
                <button class="close-btn" id="closeModal">√ó</button>
            </div>
            <div class="predicted-score" id="predictedScoreSection"></div>
            <div class="smart-bets-container" id="smartBetsContainer"></div>
            <div class="context-section" id="contextSection"></div>
        </div>
    </div>

    <script>
        function checkUserLogin() {
            if (!sessionStorage.getItem('loggedIn')) {
                window.location.replace('index.html');
                return false;
            }
            return true;
        }

        function logout() {
            sessionStorage.removeItem('loggedIn');
            window.location.replace('index.html');
        }

        const tabsDiv = document.querySelector('#tabs');
        const scheduleDiv = document.querySelector('#schedule');
        const modal = document.querySelector('#gameStatsModal');
        const modalTitle = document.querySelector('#modalTitle');
        const smartBetsContainer = document.querySelector('#smartBetsContainer');
        const contextSection = document.querySelector('#contextSection');
        const predictedScoreSection = document.querySelector('#predictedScoreSection');
        const closeModalBtn = document.querySelector('#closeModal');
        let currentDate = null;
        let autoUpdateInterval = null;
        let previousScores = {};

        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 10; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100 + 100}%`;
                particle.style.animationDuration = `${Math.random() * 20 + 20}s`;
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particlesContainer.appendChild(particle);
            }
        }

        function calculateOpportunityScore(statsData, playerData, injuriesData, homeSeo, awaySeo) {
            let score = 50;
            
            const homePointsAvg = parseFloat(statsData?.home?.stats?.pointsForPerGame) || 0;
            const awayPointsAvg = parseFloat(statsData?.away?.stats?.pointsForPerGame) || 0;
            const totalAvg = homePointsAvg + awayPointsAvg;
            
            if (totalAvg > 220 && totalAvg < 240) score += 15;
            else if (totalAvg > 210 && totalAvg < 250) score += 10;
            else if (totalAvg > 200 && totalAvg < 260) score += 5;
            
            const homeInjuries = injuriesData?.find(team => team.competitor.seoIdentifier === homeSeo)?.playerInjuries || [];
            const awayInjuries = injuriesData?.find(team => team.competitor.seoIdentifier === awaySeo)?.playerInjuries || [];
            
            const criticalInjuries = [...homeInjuries, ...awayInjuries].filter(inj => 
                inj.description.toLowerCase().includes('out') || 
                inj.description.toLowerCase().includes('doubtful')
            );
            
            score -= criticalInjuries.length * 5;
            
            const homeLeaders = playerData?.home?.playerStatsByCategory?.pointsAverage || [];
            const awayLeaders = playerData?.away?.playerStatsByCategory?.pointsAverage || [];
            
            if (homeLeaders.length > 0 && awayLeaders.length > 0) {
                const homeTopScorer = parseFloat(homeLeaders[0]?.stats?.pointsAverage) || 0;
                const awayTopScorer = parseFloat(awayLeaders[0]?.stats?.pointsAverage) || 0;
                
                if (homeTopScorer > 25 || awayTopScorer > 25) score += 15;
                else if (homeTopScorer > 20 || awayTopScorer > 20) score += 10;
            }
            
            return Math.max(0, Math.min(100, Math.round(score)));
        }

        function calculateBetConfidence(betType, statsData, playerData) {
            let confidence = 50;
            
            if (betType === 'over_total') {
                const homeOff = parseFloat(statsData?.home?.stats?.pointsForPerGame) || 0;
                const awayOff = parseFloat(statsData?.away?.stats?.pointsForPerGame) || 0;
                const homeDef = parseFloat(statsData?.home?.stats?.pointsAgainstPerGame) || 0;
                const awayDef = parseFloat(statsData?.away?.stats?.pointsAgainstPerGame) || 0;
                
                const avgTotal = (homeOff + awayOff + homeDef + awayDef) / 4;
                
                if (avgTotal > 115) confidence += 30;
                else if (avgTotal > 110) confidence += 20;
                else if (avgTotal > 105) confidence += 10;
                
                const homePace = parseFloat(statsData?.home?.stats?.possessionsPerGame) || 0;
                const awayPace = parseFloat(statsData?.away?.stats?.possessionsPerGame) || 0;
                if (homePace > 100 && awayPace > 100) confidence += 10;
            } else if (betType === 'player_points') {
                confidence += 20;
            } else if (betType === 'player_assists') {
                confidence += 15;
            } else if (betType === 'player_rebounds') {
                confidence += 15;
            }
            
            return Math.max(0, Math.min(100, Math.round(confidence)));
        }

        async function fetchPlayerSeasonStats(eventId) {
            const apiUrl = `https://stats.sports.bellmedia.ca/sports/basketball/leagues/nba/event/${eventId}/playerSeasonStats?nbPlayersToShow=5&brand=tsn&qualifiedOnly=true&type=json&seasonType=regular_season`;
            const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(apiUrl)}`;
            const response = await fetch(proxyUrl);
            return await response.json();
        }

        async function fetchInjuries() {
            const apiUrl = `https://stats.sports.bellmedia.ca/sports/basketball/leagues/nba/playerInjuries?brand=tsn&type=json`;
            const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(apiUrl)}`;
            const response = await fetch(proxyUrl);
            return await response.json();
        }

        function formatarDataBrasil(dataStr) {
            const data = new Date(dataStr + 'T12:00:00');
            const options = { weekday: 'short', month: 'short', day: 'numeric', timeZone: 'America/Sao_Paulo' };
            return data.toLocaleDateString('pt-BR', options).replace('.', '').toUpperCase();
        }

        function getDataAtualSP() {
            const now = new Date();
            const spTime = new Date(now.toLocaleString('en-US', { timeZone: 'America/Sao_Paulo' }));
            return spTime.toISOString().split('T')[0];
        }

        async function fetchDates() {
            const apiUrl = `https://stats.sports.bellmedia.ca/sports/basketball/leagues/nba/scheduleV2/subset/dates?brand=tsn&type=json`;
            const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(apiUrl)}`;
            const response = await fetch(proxyUrl);
            const data = await response.json();
            return Object.keys(data).sort();
        }

        async function fetchSchedule(date) {
            const apiUrl = `https://stats.sports.bellmedia.ca/sports/basketball/leagues/nba/scheduleV2/subset/dates?brand=tsn&type=json&dateOrId=${date}`;
            const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(apiUrl)}`;
            const response = await fetch(proxyUrl);
            const data = await response.json();
            return data[date];
        }

        async function renderTabs() {
            if (!checkUserLogin()) return;
            try {
                const dates = await fetchDates();
                const hoje = getDataAtualSP();
                let dataAtiva = dates.includes(hoje) ? hoje : dates[0];

                let html = dates.map(date => {
                    const ativa = date === dataAtiva;
                    const textoAba = formatarDataBrasil(date);
                    return `<div class="tab${ativa ? ' active' : ''}" data-date="${date}">${textoAba}</div>`;
                }).join('');

                tabsDiv.innerHTML = html;
                currentDate = dataAtiva;

                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        currentDate = tab.dataset.date;
                        previousScores = {};
                        startAutoUpdate();
                    });
                });

                document.getElementById('visualizationBtn').addEventListener('click', () => {
                    window.location.href = 'visualization.html';
                });

                document.getElementById('logoutBtn').addEventListener('click', logout);

                createParticles();
                startAutoUpdate();
            } catch (error) {
                console.error('Erro ao renderizar abas:', error);
                tabsDiv.innerHTML = '<div class="error">Erro ao carregar datas</div>';
            }
        }

        function splitTeamName(fullName) {
            const specialCases = {
                'Trail Blazers': 'Portland', 'Timberwolves': 'Minnesota', 'Thunder': 'Oklahoma City', 'Jazz': 'Utah',
                'Heat': 'Miami', 'Magic': 'Orlando', 'Wizards': 'Washington', 'Pacers': 'Indiana', 'Knicks': 'New York',
                'Nets': 'Brooklyn', 'Celtics': 'Boston', '76ers': 'Philadelphia', 'Raptors': 'Toronto', 'Bulls': 'Chicago',
                'Cavaliers': 'Cleveland', 'Pistons': 'Detroit', 'Bucks': 'Milwaukee', 'Hawks': 'Atlanta', 'Hornets': 'Charlotte',
                'Mavericks': 'Dallas', 'Rockets': 'Houston', 'Grizzlies': 'Memphis', 'Pelicans': 'New Orleans', 'Spurs': 'San Antonio',
                'Nuggets': 'Denver', 'Warriors': 'Golden State', 'Clippers': 'LA Clippers', 'Lakers': 'Los Angeles', 'Suns': 'Phoenix',
                'Kings': 'Sacramento'
            };
            for (const [nickname, city] of Object.entries(specialCases)) {
                if (fullName.includes(nickname)) return { city, nickname };
            }
            const parts = fullName.split(' ');
            if (parts.length === 1) return { city: fullName, nickname: '' };
            const nickname = parts.pop();
            const city = parts.join(' ');
            return { city, nickname };
        }

        function formatRecord(record) {
            if (!record) return '';
            const [wins, losses] = record.split('-');
            return `<span class="wins">${wins}</span>-<span class="losses">${losses}</span>`;
        }

        function getTeamLogoUrl(seoIdentifier) {
            return `https://tsnimages.tsn.ca/ImageProvider/TeamLogo?seoId=${seoIdentifier}&width=50&height=50`;
        }

        function formatTime(dateET) {
            const date = new Date(dateET);
            return date.toLocaleTimeString('pt-BR', { timeZone: 'America/Sao_Paulo', hour: 'numeric', minute: 'numeric', hour12: true }).replace(':', 'h');
        }

        async function renderSchedule(date) {
            try {
                const data = await fetchSchedule(date);
                if (!data || !data.events) {
                    scheduleDiv.innerHTML = `<div class="day-header">${formatarDataBrasil(date)}</div><div class="match">Nenhum jogo agendado</div>`;
                    return;
                }

                let html = `<div class="day-header">${formatarDataBrasil(date)}</div>`;
                
                for (const event of data.events) {
                    const eventData = event.event;
                    const { top, bottom: away, status, dateET } = eventData;
                    const eventId = event.eventId;

                    const isLiveGame = status.includes('Progress') || status.includes('Em Andamento');
                    const isFinalGame = status.includes('Final') || status.includes('Terminado');

                    const topTeam = splitTeamName(top.name);
                    const awayTeam = splitTeamName(away.name);

                    const scoreDisplay = (top.score != null && away.score != null) ? `${away.score} - ${top.score}` : '';
                    const timeDisplay = formatTime(dateET);
                    const topLogo = getTeamLogoUrl(top.seoIdentifier);
                    const awayLogo = getTeamLogoUrl(away.seoIdentifier);

                    const hasScore = top.score != null && away.score != null;

                    let opportunityBadge = '';
                    if (!isFinalGame && !isLiveGame) {
                        try {
                            const seasonStatsUrl = `https://stats.sports.bellmedia.ca/sports/basketball/leagues/nba/event/${eventId}/competitorSeasonStats?brand=tsn&type=json`;
                            const statsResponse = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(seasonStatsUrl)}`);
                            const statsData = await statsResponse.json();
                            
                            const playerData = await fetchPlayerSeasonStats(eventId);
                            const injuriesData = await fetchInjuries();
                            
                            const oppScore = calculateOpportunityScore(statsData, playerData, injuriesData, top.seoIdentifier, away.seoIdentifier);
                            
                            let badgeClass = 'opportunity-badge';
                            let badgeText = '';
                            
                            if (oppScore >= 75) {
                                badgeClass += ' high';
                                badgeText = `üî• ${oppScore}%`;
                            } else if (oppScore >= 60) {
                                badgeClass += ' medium';
                                badgeText = `‚ö° ${oppScore}%`;
                            } else {
                                badgeClass += ' low';
                                badgeText = `‚ö†Ô∏è ${oppScore}%`;
                            }
                            
                            opportunityBadge = `<div class="${badgeClass}">${badgeText}</div>`;
                        } catch (e) {
                            console.log('Could not calculate opportunity score:', e);
                        }
                    }

                    if (hasScore || isFinalGame) {
                        html += `
                            <div class="match ${isLiveGame ? 'live-game' : ''} ${isFinalGame ? 'final-game' : ''}">
                                ${isLiveGame ? '<div class="live-badge">üî¥ AO VIVO</div>' : ''}
                                ${opportunityBadge}
                                <div class="match-header">${away.name} vs ${top.name}</div>
                                <div class="teams">
                                    <div class="team">
                                        <img src="${awayLogo}" alt="${away.name}">
                                        <span class="team-name">
                                            <span class="team-city">${awayTeam.city}</span>
                                            <span class="team-nickname">${awayTeam.nickname}</span>
                                        </span>
                                        <span class="team-record">${formatRecord(away.record)}</span>
                                    </div>
                                    <div class="versus">
                                        <div class="score">${scoreDisplay}</div>
                                    </div>
                                    <div class="team">
                                        <img src="${topLogo}" alt="${top.name}">
                                        <span class="team-name">
                                            <span class="team-city">${topTeam.city}</span>
                                            <span class="team-nickname">${topTeam.nickname}</span>
                                        </span>
                                        <span class="team-record">${formatRecord(top.record)}</span>
                                    </div>
                                </div>
                                <div class="details">
                                    <button onclick="showGameStats('${eventId}', '${top.name}', '${away.name}', '${top.seoIdentifier}', '${away.seoIdentifier}')">üìä An√°lise Completa</button>
                                </div>
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="match">
                                ${opportunityBadge}
                                <div class="match-header">${away.name} vs ${top.name}</div>
                                <div class="teams">
                                    <div class="team">
                                        <img src="${awayLogo}" alt="${away.name}">
                                        <span class="team-name">
                                            <span class="team-city">${awayTeam.city}</span>
                                            <span class="team-nickname">${awayTeam.nickname}</span>
                                        </span>
                                        <span class="team-record">${formatRecord(away.record)}</span>
                                    </div>
                                    <div class="versus">
                                        <div class="time">${timeDisplay}</div>
                                    </div>
                                    <div class="team">
                                        <img src="${topLogo}" alt="${top.name}">
                                        <span class="team-name">
                                            <span class="team-city">${topTeam.city}</span>
                                            <span class="team-nickname">${topTeam.nickname}</span>
                                        </span>
                                        <span class="team-record">${formatRecord(top.record)}</span>
                                    </div>
                                </div>
                                <div class="details">
                                    <button onclick="showGameStats('${eventId}', '${top.name}', '${away.name}', '${top.seoIdentifier}', '${away.seoIdentifier}')">üéØ Ver Apostas Recomendadas</button>
                                </div>
                            </div>
                        `;
                    }
                }
                scheduleDiv.innerHTML = html;
            } catch (error) {
                scheduleDiv.innerHTML = `<div class="day-header">${formatarDataBrasil(date)}</div><div class="error">Erro ao carregar o calend√°rio: ${error.message}</div>`;
            }
        }

        function startAutoUpdate() {
            if (autoUpdateInterval) clearInterval(autoUpdateInterval);
            if (currentDate) renderSchedule(currentDate);
            autoUpdateInterval = setInterval(async () => {
                if (currentDate) await renderSchedule(currentDate);
            }, 30000);
        }

        async function showGameStats(eventId, homeName, awayName, homeSeoIdentifier, awaySeoIdentifier) {
            try {
                const scheduleData = await fetchSchedule(currentDate);
                const game = scheduleData?.events.find(e => e.eventId === eventId)?.event;
                const gameStatus = game?.status || 'Pre-Game';
                const hasScores = game?.top.score != null && game?.bottom.score != null;
                const isLiveOrFinished = hasScores || gameStatus === 'In Progress' || gameStatus === 'Final';

                let statsData, playerData, injuriesData;
                if (isLiveOrFinished) {
                    const gameStatsUrl = `https://stats.sports.bellmedia.ca/sports/basketball/leagues/nba/event/${eventId}/stats?brand=tsn&type=json`;
                    const response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(gameStatsUrl)}`);
                    statsData = await response.json();
                } else {
                    const seasonStatsUrl = `https://stats.sports.bellmedia.ca/sports/basketball/leagues/nba/event/${eventId}/competitorSeasonStats?brand=tsn&type=json`;
                    const response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(seasonStatsUrl)}`);
                    statsData = await response.json();
                }

                playerData = await fetchPlayerSeasonStats(eventId);
                injuriesData = await fetchInjuries();

                modalTitle.textContent = `${awayName} vs ${homeName}`;

                const homePointsFor = parseFloat(statsData?.home?.stats?.pointsForPerGame) || 0;
                const awayPointsFor = parseFloat(statsData?.away?.stats?.pointsForPerGame) || 0;
                const homePointsAgainst = parseFloat(statsData?.home?.stats?.pointsAgainstPerGame) || 0;
                const awayPointsAgainst = parseFloat(statsData?.away?.stats?.pointsAgainstPerGame) || 0;

                const predictedHome = Math.round((homePointsFor + awayPointsAgainst) / 2);
                const predictedAway = Math.round((awayPointsFor + homePointsAgainst) / 2);
                const predictedTotal = predictedHome + predictedAway;

                predictedScoreSection.innerHTML = `
                    <div class="predicted-score-title">üìä Placar Projetado</div>
                    <div class="predicted-score-value">
                        <div class="predicted-team">
                            <div class="predicted-team-name">${awayName}</div>
                            <div class="predicted-points">${predictedAway}</div>
                        </div>
                        <div style="font-size: 24px; color: var(--color-text-secondary);">vs</div>
                        <div class="predicted-team">
                            <div class="predicted-team-name">${homeName}</div>
                            <div class="predicted-points">${predictedHome}</div>
                        </div>
                    </div>
                    <div style="margin-top: 12px; font-size: 14px; color: var(--color-text-secondary);">
                        Total Projetado: ${predictedTotal} pontos
                    </div>
                `;

                const bets = [];

                const overLine = Math.ceil(predictedTotal / 5) * 5;
                const overConfidence = calculateBetConfidence('over_total', statsData, playerData);
                bets.push({
                    title: `Over ${overLine} Pontos (Total)`,
                    confidence: overConfidence,
                    reasons: [
                        `M√©dia combinada: ${predictedTotal.toFixed(1)} pontos`,
                        `${homeName}: ${homePointsFor.toFixed(1)} pts/jogo`,
                        `${awayName}: ${awayPointsFor.toFixed(1)} pts/jogo`
                    ],
                    tier: overConfidence >= 75 ? 'premium' : overConfidence >= 60 ? 'solid' : 'risky'
                });

                const homePointsLeader = playerData?.home?.playerStatsByCategory?.pointsAverage?.[0];
                const awayPointsLeader = playerData?.away?.playerStatsByCategory?.pointsAverage?.[0];

                if (homePointsLeader) {
                    const playerAvg = parseFloat(homePointsLeader.stats.pointsAverage) || 0;
                    const line = Math.floor(playerAvg) - 0.5;
                    const confidence = calculateBetConfidence('player_points', statsData, playerData) + 5;
                    
                    bets.push({
                        title: `${homePointsLeader.player.displayName} Over ${line} Pontos`,
                        confidence: confidence,
                        reasons: [
                            `M√©dia da temporada: ${playerAvg.toFixed(1)} pts`,
                            `Posi√ß√£o: ${homePointsLeader.player.positionShort || 'N/A'}`,
                            `L√≠der de pontos do ${homeName}`
                        ],
                        tier: confidence >= 75 ? 'premium' : confidence >= 60 ? 'solid' : 'risky'
                    });
                }

                if (awayPointsLeader) {
                    const playerAvg = parseFloat(awayPointsLeader.stats.pointsAverage) || 0;
                    const line = Math.floor(playerAvg) - 0.5;
                    const confidence = calculateBetConfidence('player_points', statsData, playerData) + 5;
                    
                    bets.push({
                        title: `${awayPointsLeader.player.displayName} Over ${line} Pontos`,
                        confidence: confidence,
                        reasons: [
                            `M√©dia da temporada: ${playerAvg.toFixed(1)} pts`,
                            `Posi√ß√£o: ${awayPointsLeader.player.positionShort || 'N/A'}`,
                            `L√≠der de pontos do ${awayName}`
                        ],
                        tier: confidence >= 75 ? 'premium' : confidence >= 60 ? 'solid' : 'risky'
                    });
                }

                const homeAssistsLeader = playerData?.home?.playerStatsByCategory?.assistsPerGame?.[0];
                const awayAssistsLeader = playerData?.away?.playerStatsByCategory?.assistsPerGame?.[0];

                if (homeAssistsLeader) {
                    const playerAvg = parseFloat(homeAssistsLeader.stats.assistsPerGame) || 0;
                    if (playerAvg >= 5) {
                        const line = Math.floor(playerAvg) - 0.5;
                        const confidence = calculateBetConfidence('player_assists', statsData, playerData) + 3;
                        
                        bets.push({
                            title: `${homeAssistsLeader.player.displayName} Over ${line} Assist√™ncias`,
                            confidence: confidence,
                            reasons: [
                                `M√©dia: ${playerAvg.toFixed(1)} ast/jogo`,
                                `Armador principal do time`
                            ],
                            tier: confidence >= 75 ? 'premium' : confidence >= 60 ? 'solid' : 'risky'
                        });
                    }
                }

                if (awayAssistsLeader) {
                    const playerAvg = parseFloat(awayAssistsLeader.stats.assistsPerGame) || 0;
                    if (playerAvg >= 5) {
                        const line = Math.floor(playerAvg) - 0.5;
                        const confidence = calculateBetConfidence('player_assists', statsData, playerData) + 3;
                        
                        bets.push({
                            title: `${awayAssistsLeader.player.displayName} Over ${line} Assist√™ncias`,
                            confidence: confidence,
                            reasons: [
                                `M√©dia: ${playerAvg.toFixed(1)} ast/jogo`,
                                `Armador principal do time`
                            ],
                            tier: confidence >= 75 ? 'premium' : confidence >= 60 ? 'solid' : 'risky'
                        });
                    }
                }

                const homeReboundsLeader = playerData?.home?.playerStatsByCategory?.reboundsPerGame?.[0];
                const awayReboundsLeader = playerData?.away?.playerStatsByCategory?.reboundsPerGame?.[0];

                if (homeReboundsLeader) {
                    const playerAvg = parseFloat(homeReboundsLeader.stats.reboundsPerGame) || 0;
                    if (playerAvg >= 8) {
                        const line = Math.floor(playerAvg) - 0.5;
                        const confidence = calculateBetConfidence('player_rebounds', statsData, playerData) + 2;
                        
                        bets.push({
                            title: `${homeReboundsLeader.player.displayName} Over ${line} Rebotes`,
                            confidence: confidence,
                            reasons: [
                                `M√©dia: ${playerAvg.toFixed(1)} reb/jogo`,
                                `L√≠der de rebotes do time`
                            ],
                            tier: confidence >= 75 ? 'premium' : confidence >= 60 ? 'solid' : 'risky'
                        });
                    }
                }

                if (awayReboundsLeader) {
                    const playerAvg = parseFloat(awayReboundsLeader.stats.reboundsPerGame) || 0;
                    if (playerAvg >= 8) {
                        const line = Math.floor(playerAvg) - 0.5;
                        const confidence = calculateBetConfidence('player_rebounds', statsData, playerData) + 2;
                        
                        bets.push({
                            title: `${awayReboundsLeader.player.displayName} Over ${line} Rebotes`,
                            confidence: confidence,
                            reasons: [
                                `M√©dia: ${playerAvg.toFixed(1)} reb/jogo`,
                                `L√≠der de rebotes do time`
                            ],
                            tier: confidence >= 75 ? 'premium' : confidence >= 60 ? 'solid' : 'risky'
                        });
                    }
                }

                bets.sort((a, b) => b.confidence - a.confidence);

                const avgConfidence = Math.round(bets.reduce((sum, bet) => sum + bet.confidence, 0) / bets.length);

                const premiumBets = bets.filter(b => b.tier === 'premium');
                const solidBets = bets.filter(b => b.tier === 'solid');
                const riskyBets = bets.filter(b => b.tier === 'risky');

                let smartBetsHtml = `
                    <div class="confidence-header">
                        <h3 style="font-size: 20px; color: #FFFFFF; margin: 0;">
                            üéØ AN√ÅLISE PREDITIVA
                        </h3>
                        <div class="confidence-score">${avgConfidence}%</div>
                    </div>
                `;

                if (premiumBets.length > 0) {
                    smartBetsHtml += `
                        <div class="bet-tier">
                            <div class="tier-header premium">
                                <span class="tier-icon">üî•</span>
                                APOSTAS PREMIUM (Confian√ßa >75%)
                            </div>
                            ${premiumBets.map(bet => `
                                <div class="bet-card premium">
                                    <div class="bet-main">
                                        <div class="bet-title">${bet.title}</div>
                                        <div class="bet-confidence">${bet.confidence}%</div>
                                    </div>
                                    <div class="bet-reasoning">
                                        ${bet.reasons.map(reason => `<div class="reason-item">${reason}</div>`).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                if (solidBets.length > 0) {
                    smartBetsHtml += `
                        <div class="bet-tier">
                            <div class="tier-header solid">
                                <span class="tier-icon">‚úÖ</span>
                                APOSTAS S√ìLIDAS (60-75%)
                            </div>
                            ${solidBets.map(bet => `
                                <div class="bet-card solid">
                                    <div class="bet-main">
                                        <div class="bet-title">${bet.title}</div>
                                        <div class="bet-confidence">${bet.confidence}%</div>
                                    </div>
                                    <div class="bet-reasoning">
                                        ${bet.reasons.map(reason => `<div class="reason-item">${reason}</div>`).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                if (riskyBets.length > 0) {
                    smartBetsHtml += `
                        <div class="bet-tier">
                            <div class="tier-header risky">
                                <span class="tier-icon">‚ö†Ô∏è</span>
                                APOSTAS ARRISCADAS (<60%)
                            </div>
                            ${riskyBets.map(bet => `
                                <div class="bet-card risky">
                                    <div class="bet-main">
                                        <div class="bet-title">${bet.title}</div>
                                        <div class="bet-confidence">${bet.confidence}%</div>
                                    </div>
                                    <div class="bet-reasoning">
                                        ${bet.reasons.map(reason => `<div class="reason-item">${reason}</div>`).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                smartBetsContainer.innerHTML = smartBetsHtml;

                const homeInjuries = injuriesData?.find(team => team.competitor.seoIdentifier === homeSeoIdentifier)?.playerInjuries || [];
                const awayInjuries = injuriesData?.find(team => team.competitor.seoIdentifier === awaySeoIdentifier)?.playerInjuries || [];

                const criticalHomeInjuries = homeInjuries.filter(inj => 
                    inj.description.toLowerCase().includes('out') || 
                    inj.description.toLowerCase().includes('doubtful')
                );
                const criticalAwayInjuries = awayInjuries.filter(inj => 
                    inj.description.toLowerCase().includes('out') || 
                    inj.description.toLowerCase().includes('doubtful')
                );

                let contextHtml = `
                    <div class="context-title">
                        üìä CONTEXTO IMPORTANTE
                    </div>
                    <div class="context-grid">
                `;

                if (criticalHomeInjuries.length > 0) {
                    contextHtml += `
                        <div class="context-item">
                            <span class="context-icon">üè•</span>
                            <span>${homeName}: ${criticalHomeInjuries.length} jogador(es) fora</span>
                        </div>
                    `;
                }

                if (criticalAwayInjuries.length > 0) {
                    contextHtml += `
                        <div class="context-item">
                            <span class="context-icon">üè•</span>
                            <span>${awayName}: ${criticalAwayInjuries.length} jogador(es) fora</span>
                        </div>
                    `;
                }

                const homePace = parseFloat(statsData?.home?.stats?.possessionsPerGame) || 0;
                const awayPace = parseFloat(statsData?.away?.stats?.possessionsPerGame) || 0;
                
                if (homePace > 100 || awayPace > 100) {
                    contextHtml += `
                        <div class="context-item">
                            <span class="context-icon">‚ö°</span>
                            <span>Jogo de ritmo acelerado (favorece over)</span>
                        </div>
                    `;
                }

                const homeDefEff = parseFloat(statsData?.home?.stats?.pointsAgainstPerGame) || 0;
                const awayDefEff = parseFloat(statsData?.away?.stats?.pointsAgainstPerGame) || 0;

                if (homeDefEff > 115 || awayDefEff > 115) {
                    contextHtml += `
                        <div class="context-item">
                            <span class="context-icon">üõ°Ô∏è</span>
                            <span>Defesas fracas (favorece over)</span>
                        </div>
                    `;
                }

                contextHtml += `</div>`;
                contextSection.innerHTML = contextHtml;

                modal.style.display = 'flex';
                setTimeout(() => modal.classList.add('show'), 10);
            } catch (error) {
                console.error('Failed to load game stats:', error);
                smartBetsContainer.innerHTML = `
                    <div class="error">Erro ao carregar an√°lise preditiva</div>
                    <div style="font-size: 12px; color: var(--color-text-secondary); text-align: center; margin-top: 8px;">${error.message}</div>
                `;
                modal.style.display = 'flex';
                setTimeout(() => modal.classList.add('show'), 10);
            }
        }

        closeModalBtn.addEventListener('click', () => {
            modal.classList.remove('show');
            setTimeout(() => modal.style.display = 'none', 300);
        });

        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                modal.classList.remove('show');
                setTimeout(() => modal.style.display = 'none', 300);
            }
        });

        renderTabs();
    </script>
</body>
</html>