<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Apostas</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Todo o CSS permanece o mesmo */
    :root {
      --color-primary: rgb(0, 255, 100);
      --color-primary-light: hsl(140, 100%, 60%);
      --color-primary-dark: hsl(140, 100%, 40%);
      --color-secondary: #000000;
      --color-secondary-light: #a78bfa;
      --color-accent: #10b981;
      --color-accent-light: #34d399;
      --color-danger: #ef4444;
      --color-danger-light: #f87171;
      --color-bg-dark: #0a0e17;
      --color-bg-medium: #111827;
      --color-bg-light: #1f2937;
      --color-text-primary: #f8fafc;
      --color-text-secondary: #cbd5e1;
      --color-text-tertiary: #94a3b8;
      --color-border: rgba(0, 255, 100, 0.1);
      --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.25);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.25);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 20px;
      --transition: all 0.25s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    body {
      background: linear-gradient(145deg, var(--color-bg-dark), var(--color-bg-medium));
      color: var(--color-text-primary);
      min-height: 100vh;
      font-size: 16px;
      line-height: 1.5;
    }

    /* Layout e containers */
    .app-container {
      max-width: 1400px;
      margin: 3rem auto;
      padding: 0 2rem;
    }

    .container {
      background: rgba(17, 24, 39, 0.98);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      padding: 2.5rem;
      margin-bottom: 3rem;
      border: 1px solid var(--color-border);
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease;
    }

    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--color-primary), transparent);
      box-shadow: 0 0 15px 3px rgba(0, 255, 100, 0.5);
      animation: glow 1.5s infinite alternate;
    }

    @keyframes glow {
      from {
        opacity: 0.5;
        box-shadow: 0 0 5px 1px rgba(0, 255, 100, 0.3);
      }

      to {
        opacity: 1;
        box-shadow: 0 0 20px 5px rgba(0, 255, 100, 0.6);
      }
    }

    /* Cabeçalho */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem 0;
      margin-bottom: 2rem;
      border-bottom: 1px solid var(--color-border);
    }

    .app-title {
      font-size: 1.75rem;
      font-weight: 700;
      background: linear-gradient(90deg, var(--color-primary), var(--color-primary-light));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: -0.5px;
      text-shadow: 0 0 10px rgba(0, 255, 100, 0.3);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--color-primary-dark), var(--color-primary));
      color: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      box-shadow: 0 0 10px rgba(0, 255, 100, 0.5);
    }

    /* Navegação por abas */
    .tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 2rem;
      background: rgba(10, 14, 23, 0.7);
      border-radius: var(--radius-md);
      padding: 0.5rem;
      overflow-x: auto;
      border: 1px solid rgba(0, 255, 100, 0.15);
      scrollbar-width: thin;
      scrollbar-color: var(--color-primary) transparent;
    }

    .tabs::-webkit-scrollbar {
      height: 4px;
    }

    .tabs::-webkit-scrollbar-track {
      background: transparent;
    }

    .tabs::-webkit-scrollbar-thumb {
      background-color: var(--color-primary);
      border-radius: 20px;
    }

    .tab-button {
      padding: 0.75rem 1.25rem;
      border: none;
      background: transparent;
      color: var(--color-text-tertiary);
      border-radius: var(--radius-sm);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.625rem;
      flex: 1;
      justify-content: center;
      transition: var(--transition);
      font-weight: 500;
      min-width: 140px;
      position: relative;
      white-space: nowrap;
    }

    .tab-button.active {
      background: linear-gradient(135deg, rgba(0, 255, 100, 0.15), rgba(0, 200, 100, 0.15));
      color: var(--color-text-primary);
      box-shadow: 0 0 10px rgba(0, 255, 100, 0.2);
    }

    .tab-button:hover:not(.active) {
      background: rgba(0, 255, 100, 0.08);
      color: var(--color-text-secondary);
    }

    .tab-button::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--color-primary), var(--color-primary-light));
      transition: var(--transition);
      transform: translateX(-50%);
      box-shadow: 0 0 5px rgba(0, 255, 100, 0.5);
    }

    .tab-button:hover::after,
    .tab-button.active::after {
      width: 60%;
    }

    .icon {
      width: 20px;
      height: 20px;
      opacity: 0.8;
    }

    .icon-sm {
      width: 16px;
      height: 16px;
    }

    /* Conteúdo das abas */
    .tab-content {
      display: none;
      background: rgba(15, 23, 42, 0.4);
      border-radius: var(--radius-lg);
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: var(--shadow-md);
      animation: fadeIn 0.5s ease;
      border: 1px solid rgba(0, 255, 100, 0.1);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(1rem);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .tab-content.active {
      display: block;
    }

    /* Formulário */
    .form-group {
      margin-bottom: 2rem;
      position: relative;
    }

    label {
      display: block;
      margin-bottom: 0.75rem;
      font-weight: 600;
      color: var(--color-text-secondary);
      font-size: 0.95rem;
      letter-spacing: 0.01em;
    }

    input,
    select {
      width: 100%;
      padding: 0.875rem 1.125rem;
      border: 1px solid rgba(0, 255, 100, 0.2);
      border-radius: var(--radius-md);
      background-color: rgba(10, 14, 23, 0.7);
      color: var(--color-text-primary);
      font-size: 1rem;
      transition: var(--transition);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      box-shadow: var(--shadow-sm);
    }

    input:focus,
    select:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 10px rgba(0, 255, 100, 0.2);
      outline: none;
      background-color: rgba(10, 14, 23, 0.8);
    }

    input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .submit-button,
    .back-button-link,
    .logout-button {
      width: 100%;
      padding: 0.875rem 1.75rem;
      border: none;
      border-radius: var(--radius-md);
      background: linear-gradient(135deg, var(--color-primary-dark), var(--color-primary));
      color: #000;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      letter-spacing: 0.01em;
      font-size: 0.95rem;
      box-shadow: 0 0 15px rgba(0, 255, 100, 0.3);
      text-align: center;
      text-decoration: none;
      display: inline-block;
    }

    .submit-button:hover,
    .back-button-link:hover,
    .logout-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 20px rgba(0, 255, 100, 0.5);
    }

    .submit-button::after,
    .back-button-link::after,
    .logout-button::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: 0.5s;
    }

    .submit-button:hover::after,
    .back-button-link:hover::after,
    .logout-button:hover::after {
      left: 100%;
    }

    /* Back button */
    .back-to-visualization {
      margin-bottom: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .back-button-link,
    .logout-button {
      width: auto;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Resumo */
    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2.5rem;
    }

    .summary-item {
      padding: 1.5rem;
      border-radius: var(--radius-md);
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
      background: rgba(10, 14, 23, 0.7);
      border: 1px solid rgba(0, 255, 100, 0.1);
      box-shadow: var(--shadow-sm);
      transition: var(--transition);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    .summary-item:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-md);
      border-color: rgba(0, 255, 100, 0.3);
    }

    .summary-item.gain {
      background: rgba(16, 185, 129, 0.1);
      border-color: rgba(16, 185, 129, 0.3);
      box-shadow: 0 0 15px rgba(16, 185, 129, 0.1);
    }

    .summary-item.loss {
      background: rgba(239, 68, 68, 0.1);
      border-color: rgba(239, 68, 68, 0.3);
      box-shadow: 0 0 15px rgba(239, 68, 68, 0.1);
    }

    .summary-item.balance {
      background: rgba(0, 255, 100, 0.1);
      border-color: rgba(0, 255, 100, 0.3);
      box-shadow: 0 0 15px rgba(0, 255, 100, 0.1);
    }

    .summary-item .label {
      font-size: 1rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--color-text-tertiary);
      margin-bottom: 0.5rem;
    }

    .summary-item .value {
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: 0.5px;
      line-height: 1.2;
    }

    .gain .value {
      color: var(--color-accent);
      text-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
    }

    .loss .value {
      color: var(--color-danger);
      text-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
    }

    .balance .value {
      background: linear-gradient(45deg, var(--color-primary), var(--color-primary-light));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 10px rgba(0, 255, 100, 0.3);
    }

    /* Chart */
    .chart-container {
      background: rgba(10, 14, 23, 0.9);
      border-radius: var(--radius-lg);
      padding: 2.5rem;
      margin: 2.5rem auto;
      border: 1px solid var(--color-border);
      box-shadow: var(--shadow-md);
      max-width: 1200px;
    }

    .chart-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      color: var(--color-text-primary);
      text-align: center;
      background: linear-gradient(45deg, var(--color-primary), var(--color-primary-light));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 10px rgba(0, 255, 100, 0.2);
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1.5rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .period-selector {
      display: flex;
      gap: 0.75rem;
      background: rgba(10, 14, 23, 0.7);
      padding: 0.75rem;
      border-radius: var(--radius-md);
      border: 1px solid rgba(0, 255, 100, 0.15);
      flex-wrap: nowrap;
      box-shadow: var(--shadow-sm);
    }

    .period-button {
      padding: 0.5rem 1rem;
      border: none;
      background: transparent;
      color: var(--color-text-tertiary);
      border-radius: 6px;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
      font-size: 0.875rem;
    }

    .period-button:hover,
    .period-button.active {
      background: linear-gradient(135deg, rgba(0, 255, 100, 0.15), rgba(0, 200, 100, 0.15));
      color: var(--color-text-primary);
      box-shadow: 0 0 10px rgba(0, 255, 100, 0.1);
    }

    .chart-legend {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-top: 1rem;
      padding: 0.75rem 1rem;
      background: rgba(10, 14, 23, 0.7);
      border-radius: var(--radius-sm);
      border: 1px solid rgba(0, 255, 100, 0.1);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      color: var(--color-text-secondary);
    }

    /* Date range selector */
    .date-range-selector {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(10, 14, 23, 0.7);
      padding: 0.5rem 1rem;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(0, 255, 100, 0.1);
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .date-input {
      background: rgba(15, 23, 42, 0.5);
      border: 1px solid rgba(0, 255, 100, 0.2);
      border-radius: var(--radius-sm);
      color: var(--color-text-primary);
      padding: 0.5rem;
      font-size: 0.875rem;
      width: 130px;
    }

    .clear-date-button {
      background: transparent;
      border: 1px solid rgba(0, 255, 100, 0.2);
      color: var(--color-text-tertiary);
      padding: 0.5rem 1rem;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 0.875rem;
      transition: var(--transition);
    }

    .clear-date-button:hover {
      background: rgba(0, 255, 100, 0.1);
      color: var(--color-text-primary);
    }

    /* History */
    .history-title {
      margin-top: 3rem;
      margin-bottom: 1.5rem;
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--color-text-primary);
      padding-top: 1.5rem;
      border-top: 1px solid var(--color-border);
      background: linear-gradient(45deg, var(--color-primary), var(--color-primary-light));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 10px rgba(0, 255, 100, 0.2);
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 1rem;
      max-height: 500px;
      overflow-y: auto;
      padding-right: 0.5rem;
      scrollbar-width: thin;
      scrollbar-color: var(--color-primary) transparent;
    }

    .history-list::-webkit-scrollbar {
      width: 6px;
    }

    .history-list::-webkit-scrollbar-track {
      background: transparent;
    }

    .history-list::-webkit-scrollbar-thumb {
      background-color: var(--color-primary);
      border-radius: 20px;
    }

    .aposta-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.25rem;
      background: rgba(10, 14, 23, 0.6);
      border-radius: var(--radius-md);
      border-left: 4px solid var(--color-primary);
      transition: var(--transition);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    .aposta-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 15px rgba(0, 255, 100, 0.15);
      background: rgba(10, 14, 23, 0.8);
    }

    .aposta-info {
      flex: 1;
    }

    .aposta-actions button {
      background-color: rgba(0, 255, 100, 0.1);
      color: var(--color-text-primary);
      border: 1px solid rgba(0, 255, 100, 0.2);
      padding: 0.5rem 0.75rem;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.875rem;
      font-weight: 500;
    }

    .aposta-actions button:hover {
      background-color: rgba(0, 255, 100, 0.2);
      transform: translateY(-1px);
      box-shadow: 0 0 10px rgba(0, 255, 100, 0.2);
    }

    .status-green {
      color: var(--color-primary);
      font-weight: 600;
      text-shadow: 0 0 5px rgba(0, 255, 100, 0.3);
    }

    .status-red {
      color: var(--color-danger);
      font-weight: 600;
      text-shadow: 0 0 5px rgba(239, 68, 68, 0.3);
    }
    
    .status-blue {
      color: #3b82f6;
      font-weight: 600;
      text-shadow: 0 0 5px rgba(59, 130, 246, 0.3);
    }
    
    .banca-inicial-container {
      display: flex;
      gap: 1rem;
      margin-bottom: 0.5rem;
    }
    
    .banca-inicial-container input {
      flex: 1;
    }
    
    .banca-inicial-container button {
      width: auto;
      padding: 0.875rem 1.25rem;
    }
    
    .unidade-info {
      font-size: 0.9rem;
      color: var(--color-text-secondary);
      margin-top: 0.5rem;
    }
    
    .sub-value {
      font-size: 0.85rem;
      color: var(--color-text-tertiary);
      margin-top: 0.5rem;
    }
    
    .stats-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }
    
    .stat-item {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
    }
    
    .stat-label {
      color: var(--color-text-tertiary);
    }
    
    .stat-value {
      font-weight: 600;
      color: var(--color-text-primary);
    }

    /* Markets form */
    .market-form {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .market-input {
      flex: 1;
    }

    .add-market-button {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.25rem;
      background: linear-gradient(135deg, var(--color-primary-dark), var(--color-primary));
      color: #000;
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      font-size: 0.875rem;
      box-shadow: 0 0 10px rgba(0, 255, 100, 0.2);
    }

    .add-market-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 15px rgba(0, 255, 100, 0.4);
    }

    .markets-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      max-height: 500px;
      overflow-y: auto;
      padding-right: 0.5rem;
      margin-top: 1.5rem;
      scrollbar-width: thin;
      scrollbar-color: var(--color-primary) transparent;
    }

    .markets-list::-webkit-scrollbar {
      width: 6px;
    }

    .markets-list::-webkit-scrollbar-track {
      background: transparent;
    }

    .markets-list::-webkit-scrollbar-thumb {
      background-color: var(--color-primary);
      border-radius: 20px;
    }

    .market-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background: rgba(10, 14, 23, 0.6);
      border-radius: var(--radius-sm);
      transition: var(--transition);
      border: 1px solid rgba(0, 255, 100, 0.1);
    }

    .market-item:hover {
      background: rgba(10, 14, 23, 0.8);
      transform: translateY(-2px);
      box-shadow: 0 0 10px rgba(0, 255, 100, 0.15);
    }

    .remove-button {
      background: none;
      border: none;
      color: var(--color-danger);
      cursor: pointer;
      padding: 0.25rem;
      border-radius: 4px;
      transition: var(--transition);
    }

    .remove-button:hover {
      background-color: rgba(239, 68, 68, 0.1);
    }

    .calculated-result {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 1.5rem 0;
      padding: 1.25rem;
      background: rgba(0, 255, 100, 0.05);
      border-left: 4px solid var(--color-primary);
      border-radius: var(--radius-md);
    }

    .calculated-result p {
      font-weight: 500;
      color: var(--color-text-secondary);
    }

    .calculated-result .value {
      font-weight: 700;
      font-size: 1.25rem;
    }

    /* Responsiveness */
    @media (max-width: 1200px) {
      .container {
        padding: 1.5rem;
      }
    }

    @media (max-width: 768px) {
      .app-container {
        padding: 1rem;
        margin: 1rem auto;
      }

      .container {
        padding: 1.25rem;
        margin-bottom: 1.5rem;
      }

      .summary {
        grid-template-columns: 1fr;
      }

      .tab-button {
        padding: 0.625rem 1rem;
        font-size: 0.875rem;
        min-width: 100px;
      }

      .icon {
        width: 18px;
        height: 18px;
      }

      .tab-content {
        padding: 1.25rem;
      }

      .header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
        padding: 1rem 0;
      }

      .chart-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }

      .period-selector {
        width: 100%;
        overflow-x: auto;
      }

      .date-range-selector {
        width: 100%;
        justify-content: space-between;
      }

      .aposta-item {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
      }

      .aposta-actions {
        width: 100%;
        display: flex;
        justify-content: flex-end;
      }

      .market-form {
        flex-direction: column;
      }

      .add-market-button {
        width: 100%;
      }
    }

    @media (max-width: 480px) {
      .tabs {
        flex-direction: column;
        gap: 0.5rem;
      }

      .tab-button {
        width: 100%;
      }

      .container {
        padding: 1rem;
        border-radius: var(--radius-md);
      }

      .date-range-selector {
        flex-direction: column;
        align-items: stretch;
      }

      .date-input {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <div class="app-container">
    <div class="back-to-visualization">
      <a href="visualization.html" class="back-button-link">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5"></path>
          <path d="M12 19l-7-7 7-7"></path>
        </svg>
        Voltar
      </a>
      <button class="logout-button" onclick="logout()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16 17 21 12 16 7"></polyline>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
        Sair
      </button>
    </div>

    <div class="container">
      <header class="header">
        <h1 class="app-title">Controle de Apostas</h1>
        <div class="user-info">
          <div class="user-avatar" id="user-avatar"></div>
          <span id="user-email"></span>
        </div>
      </header>

      <div class="tabs">
        <button class="tab-button active" data-tab="dashboard">
          <span class="icon">📊</span> Dashboard
        </button>
        <button class="tab-button" data-tab="apostas">
          <span class="icon">💵</span> Nova Aposta
        </button>
        <button class="tab-button" data-tab="mercados">
          <span class="icon">📝</span> Mercados
        </button>
      </div>

      <!-- Dashboard Tab -->
      <div class="tab-content active" id="dashboard-tab">
        <div class="form-group">
          <label for="banca-inicial">Banca Inicial</label>
          <div class="banca-inicial-container">
            <input type="number" id="banca-inicial" placeholder="Valor da banca inicial" min="0" step="0.01">
            <button id="salvar-banca" class="submit-button">Salvar</button>
          </div>
          <div class="unidade-info">
            <span>Unidade (10 partes): </span>
            <span id="valor-unidade">R$ 0,00</span>
          </div>
        </div>
        
        <div class="summary">
          <div class="summary-item gain">
            <div class="label">Ganho Total</div>
            <div class="value" id="ganho-total">R$ 0,00</div>
            <div class="sub-value">Unidades: <span id="unidades-ganhas">0</span></div>
          </div>
          <div class="summary-item loss">
            <div class="label">Perda Total</div>
            <div class="value" id="perda-total">R$ 0,00</div>
            <div class="sub-value">Unidades: <span id="unidades-perdidas">0</span></div>
          </div>
          <div class="summary-item balance">
            <div class="label">Saldo Total</div>
            <div class="value" id="saldo-total">R$ 0,00</div>
          </div>
          <div class="summary-item">
            <div class="label">Estatísticas</div>
            <div class="stats-container">
              <div class="stat-item">
                <span class="stat-label">Greens:</span>
                <span id="total-greens" class="stat-value">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Reds:</span>
                <span id="total-reds" class="stat-value">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Reembolsos:</span>
                <span id="total-reembolsos" class="stat-value">0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Aguardando:</span>
                <span id="total-aguardando" class="stat-value">0</span>
              </div>
            </div>
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <h2 class="chart-title" id="chart-period-title">
              Desempenho (7 dias)
            </h2>
            <div class="period-selector">
              <button class="period-button active" data-days="7">1S</button>
              <button class="period-button" data-days="15">15D</button>
              <button class="period-button" data-days="30">1M</button>
              <button class="period-button" data-days="45">45D</button>
              <button class="period-button" data-days="60">2M</button>
            </div>
          </div>

          <div class="date-range-selector">
            <input type="date" id="start-date" class="date-input">
            <span>até</span>
            <input type="date" id="end-date" class="date-input">
            <button id="clear-date-range" class="clear-date-button">
              Limpar
            </button>
          </div>

          <div id="grafico"></div>
        </div>

        <h2 class="history-title">Histórico de Apostas</h2>
        <div id="apostas-lista" class="history-list">
          <!-- Apostas serão carregadas aqui -->
        </div>
      </div>

      <!-- Apostas Tab -->
      <div class="tab-content" id="apostas-tab">
        <form id="bet-form">
          <div class="form-group">
            <label for="liga">Liga</label>
            <select id="liga" required>
              <option value="">Selecione uma Liga</option>
              <option value="Battle 6 min">Battle 6 min</option>
              <option value="Battle 8 min">Battle 8 min</option>
              <option value="Battle 8 min (H2H)">Battle 8 min (H2H)</option>
              <option value="Adriact 10 min">Adriact 10 min</option>
              <option value="GT 12 min">GT 12 min</option>
            </select>
          </div>

          <div class="form-group">
            <label for="jogador1">Jogador 1</label>
            <input type="text" id="jogador1" placeholder="Nome do jogador 1" required list="jogadores-lista">
          </div>

          <div class="form-group">
            <label for="jogador2">Jogador 2</label>
            <input type="text" id="jogador2" placeholder="Nome do jogador 2" required list="jogadores-lista">
          </div>

          <div class="form-group">
            <label for="mercado">Mercado</label>
            <select id="mercado" required>
              <option value="">Selecione um Mercado</option>
              <!-- Mercados serão carregados aqui -->
            </select>
          </div>

          <div class="form-group">
            <label for="stake">Stake</label>
            <input type="text" id="stake" placeholder="Valor apostado" required>
          </div>

          <div class="form-group">
            <label for="odds">Odds</label>
            <input type="text" id="odds" placeholder="Odds da aposta" required>
          </div>

          <div class="form-group">
            <label for="resultado">Resultado</label>
            <select id="resultado" required>
              <option value="aguardando" selected>Aguardando</option>
              <option value="green">Green</option>
              <option value="red">Red</option>
              <option value="meio-green">Meio Green</option>
              <option value="meio-red">Meio Red</option>
              <option value="reembolso">Reembolso</option>
            </select>
          </div>

          <div class="calculated-result">
            <p>Resultado Final:</p>
            <span id="resultado-final" class="value">R$ 0,00</span>
          </div>

          <button type="submit" class="submit-button">Salvar Aposta</button>
        </form>
      </div>

      <!-- Mercados Tab -->
      <div class="tab-content" id="mercados-tab">
        <form id="market-form" class="market-form">
          <div class="market-input">
            <input type="text" id="novo-mercado" placeholder="Nome do novo mercado" required>
          </div>
          <button type="submit" class="add-market-button">
            <span class="icon-sm">+</span> Adicionar Mercado
          </button>
        </form>

        <div id="mercados-lista" class="markets-list">
          <!-- Mercados serão carregados aqui -->
        </div>
      </div>
    </div>
  </div>

  <datalist id="jogadores-lista">
    <!-- Lista de jogadores será carregada aqui -->
  </datalist>

  <!-- Importar Chart.js para os gráficos -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Importar Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      deleteDoc,
      doc,
      onSnapshot,
      serverTimestamp,
      query,
      where,
      orderBy,
      getDocs,
      setDoc,
      limit,
    } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyALiAKWq7Z6B9ut6KCHt9L4g8Vt8VHF6iM",
      authDomain: "rw-tips.firebaseapp.com",
      projectId: "rw-tips",
      storageBucket: "rw-tips.appspot.com",
      messagingSenderId: "806941219354",
      appId: "1:806941219354:web:6f904532b6884251444fa3",
      measurementId: "G-64HF8TWQV4",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Variáveis globais
    let currentUser = null;
    let currentUserKey = null;
    let chart = null;
    let todasApostas = [];
    let bancaInicial = 0;
    let valorUnidade = 0;
    
    // Função para calcular o valor da unidade
    function calcularValorUnidade() {
      if (bancaInicial > 0) {
        valorUnidade = bancaInicial / 100;
        document.getElementById('valor-unidade').textContent = valorUnidade.toFixed(2);
        console.log("Valor da unidade calculado:", valorUnidade);
      } else {
        console.log("Banca inicial é zero ou inválida:", bancaInicial);
      }
    }
    
    // Carregar banca inicial do localStorage ao iniciar
    document.addEventListener('DOMContentLoaded', function() {
      // Verificar se há uma banca inicial salva
      firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
          currentUser = user.uid;
          console.log("Usuário autenticado:", currentUser);
          
          const bancaSalva = localStorage.getItem('bancaInicial_' + currentUser);
          console.log("Banca salva:", bancaSalva);
          
          if (bancaSalva) {
            bancaInicial = parseFloat(bancaSalva);
            document.getElementById('banca-inicial').value = bancaInicial;
            calcularValorUnidade();
            console.log("Banca inicial carregada:", bancaInicial);
            console.log("Valor unidade calculado:", valorUnidade);
          }
          carregarApostas();
        }
      });
      
      // Configurar evento para salvar banca inicial
      document.getElementById('salvar-banca').addEventListener('click', function() {
        const valor = parseFloat(document.getElementById('banca-inicial').value);
        if (isNaN(valor) || valor <= 0) {
          alert('Por favor, insira um valor válido para a banca inicial.');
          return;
        }
        
        bancaInicial = valor;
        localStorage.setItem('bancaInicial_' + currentUser, bancaInicial);
        calcularValorUnidade();
        atualizarInterfaceApostas();
        alert('Banca inicial salva com sucesso!');
      });
    });

    // Função para atualizar o resultado de uma aposta
    window.atualizarResultado = async function(apostaId, novoResultado) {
      if (!confirm(`Tem certeza que deseja alterar o resultado para ${novoResultado}?`)) return;
      
      try {
        const apostaRef = doc(db, "apostas", apostaId);
        await setDoc(apostaRef, { resultado: novoResultado }, { merge: true });
        alert("Resultado atualizado com sucesso!");
        await carregarApostas();
      } catch (error) {
        console.error("Erro ao atualizar resultado:", error);
        alert("Erro ao atualizar resultado: " + error.message);
      }
    }
    
    // Função de logout
    window.logout = function () {
      sessionStorage.removeItem('loggedIn');
      localStorage.removeItem('currentUser');
      localStorage.removeItem('currentUserKey');
      window.location.replace('index.html');
    };

    // Definindo função removerAposta no escopo global
    window.removerAposta = async function (id) {
      if (!confirm("Tem certeza que deseja remover esta aposta?")) return;

      try {
        await deleteDoc(doc(db, "apostas", id));
        console.log("Aposta removida com sucesso!");
        await carregarApostas();
      } catch (error) {
        console.error("Erro ao remover aposta:", error);
        alert("Erro ao remover aposta: " + error.message);
      }
    };

    // Cache de jogadores
    let jogadoresCache = {};

    // Funções utilitárias
    function formatarMoeda(valor) {
      return new Intl.NumberFormat("pt-BR", {
        style: "currency",
        currency: "BRL",
      }).format(valor);
    }

    function formatarData(data) {
      return new Date(data).toLocaleDateString("pt-BR", {
        day: "2-digit",
        month: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
      });
    }

    function calcularValorFinal(stake, odds, resultado) {
      if (!stake || !odds) return 0;

      switch (resultado) {
        case 'green':
          return stake * (odds - 1);
        case 'red':
          return -stake;
        case 'meio-green':
          return (stake / 2) * (odds - 1);
        case 'meio-red':
          return -stake / 2;
        case 'reembolso':
          return 0;
        case 'aguardando':
          return 0;
        default:
          return 0;
      }
    }

    function atualizarValorFinal() {
      const stake = parseFloat(document.getElementById("stake").value.replace(',', '.')) || 0;
      const odds = parseFloat(document.getElementById("odds").value.replace(',', '.')) || 0;
      const resultado = document.getElementById("resultado").value;

      const valorFinal = calcularValorFinal(stake, odds, resultado);

      const elementoResultado = document.getElementById("resultado-final");
      elementoResultado.textContent = formatarMoeda(valorFinal);
      elementoResultado.className = 'value ' + (valorFinal >= 0 ? 'status-green' : 'status-red');
    }

    // Funções de navegação
    function setupTabs() {
      const tabButtons = document.querySelectorAll(".tab-button");
      tabButtons.forEach(button => {
        button.addEventListener("click", () => {
          // Remover classe active de todos os botões e conteúdos
          tabButtons.forEach(btn => btn.classList.remove("active"));
          document.querySelectorAll(".tab-content").forEach(content =>
            content.classList.remove("active")
          );

          // Adicionar classe active ao botão clicado e seu conteúdo
          button.classList.add("active");
          const tabId = button.dataset.tab;
          document.getElementById(`${tabId}-tab`).classList.add("active");
        });
      });
    }

    // Funções de autenticação
    function checkUserLogin() {
      if (!sessionStorage.getItem('loggedIn')) {
        window.location.replace('index.html');
        return false;
      }

      // Atualizar interface do usuário
      currentUser = localStorage.getItem('currentUser');
      currentUserKey = localStorage.getItem('currentUserKey') || 'user';
      if (currentUser) {
        document.getElementById('user-email').textContent = currentUser;
        document.getElementById('user-avatar').textContent = currentUser.charAt(0).toUpperCase();
      }

      // Verificar se é admin ou dono dos mercados para mostrar/ocultar o formulário de adicionar mercados
      const marketForm = document.getElementById("market-form");
      if (marketForm) {
        const mercadosRef = collection(db, "mercados");
        const q = query(mercadosRef, where("userEmail", "==", currentUser), limit(1));
        getDocs(q).then((snapshot) => {
          if (!snapshot.empty || currentUserKey === 'admin') {
            marketForm.style.display = "flex";
          } else {
            marketForm.style.display = "none";
          }
        });
      }

      return true;
    }

    // Função para adicionar mercado
    async function adicionarMercado(nome) {
      if (!currentUser || !nome) return;

      try {
        // Verificar se o usuário é admin ou dono dos mercados
        const mercadosRef = collection(db, "mercados");
        const q = query(mercadosRef, where("userEmail", "==", currentUser), limit(1));
        const snapshot = await getDocs(q);

        // Se o usuário for admin ou já tiver criado mercados, permitir a adição
        if (currentUserKey === 'admin' || !snapshot.empty) {
          await addDoc(collection(db, "mercados"), {
            nome,
            userEmail: currentUser,
            timestamp: serverTimestamp(),
          });

          document.getElementById("novo-mercado").value = "";
          await carregarMercados();
        } else {
          alert("Apenas o dono dos mercados ou administrador pode adicionar novos mercados.");
        }
      } catch (error) {
        console.error("Erro ao adicionar mercado:", error);
        alert("Erro ao adicionar mercado: " + error.message);
      }
    }

    // Função para carregar mercados
    async function carregarMercados() {
      if (!currentUser) return;

      try {
        // Para usuários não administradores, carregamos todos os mercados existentes
        // Isso permite que todos usuários possam escolher entre os mercados disponíveis
        const mercadosRef = collection(db, "mercados");

        // Não filtramos por usuário para permitir que todos vejam todos os mercados
        const querySnapshot = await getDocs(mercadosRef);

        const mercados = [];
        querySnapshot.forEach((doc) => {
          mercados.push({ id: doc.id, ...doc.data() });
        });

        // Ordenar mercados alfabeticamente
        mercados.sort((a, b) => a.nome.localeCompare(b.nome));

        // Atualizar select de mercados
        const selectMercado = document.getElementById("mercado");
        selectMercado.innerHTML = "";
        const optionDefault = document.createElement("option");
        optionDefault.value = "";
        optionDefault.textContent = "Selecione um Mercado";
        selectMercado.appendChild(optionDefault);

        mercados.forEach((mercado) => {
          const option = document.createElement("option");
          option.value = mercado.nome;
          option.textContent = mercado.nome;
          selectMercado.appendChild(option);
        });

        // Para a lista de mercados, mostramos apenas os mercados do usuário atual ou se for admin
        const mercadosUsuario = mercados.filter(m =>
          m.userEmail === currentUser || currentUserKey === 'admin'
        );

        // Atualizar lista de mercados
        const mercadosLista = document.getElementById("mercados-lista");
        mercadosLista.innerHTML = mercadosUsuario.length === 0
          ? '<div class="history-empty">Nenhum mercado cadastrado</div>'
          : mercadosUsuario.map(mercado => `
          <div class="market-item">
            <span>${mercado.nome}</span>
            <button class="remove-button" data-id="${mercado.id}">
              <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
              </svg>
            </button>
          </div>
        `).join("");

      } catch (error) {
        console.error("Erro ao carregar mercados:", error);
      }
    }

    async function removerMercado(id) {
      if (!confirm("Tem certeza que deseja remover este mercado?")) return;

      try {
        await deleteDoc(doc(db, "mercados", id));
        await carregarMercados();
      } catch (error) {
        console.error("Erro ao remover mercado:", error);
        alert("Erro ao remover mercado: " + error.message);
      }
    }

    // Nova função para atualizar a interface com as apostas carregadas
    function atualizarInterfaceApostas() {
      const apostasLista = document.getElementById("apostas-lista");

      if (todasApostas.length === 0) {
        apostasLista.innerHTML = '<div style="text-align: center; padding: 15px; color: #888;">Nenhuma aposta registrada</div>';
        document.getElementById("grafico").innerHTML = '<div style="text-align: center; padding: 15px; color: #888;">Sem dados para exibir</div>';
        
        // Zerar contadores
        document.getElementById('total-green').textContent = '0';
        document.getElementById('total-red').textContent = '0';
        document.getElementById('total-reembolso').textContent = '0';
        document.getElementById('total-aguardando').textContent = '0';
        return;
      }

      let ganhoTotal = 0;
      let perdaTotal = 0;
      
      // Contadores para estatísticas
      let totalGreen = 0;
      let totalRed = 0;
      let totalReembolso = 0;
      let totalAguardando = 0;

      apostasLista.innerHTML = "";

      todasApostas.forEach((aposta) => {
        const apostaItem = document.createElement("div");
        apostaItem.classList.add("aposta-item");

        const stake = parseFloat(aposta.stake?.toString().replace(/[^\d.,]/g, "").replace(",", ".") || "0");
        const odds = parseFloat(aposta.odds?.toString().replace(",", ".") || "0");
        let valorFinal = 0;

        switch (aposta.resultado) {
          case "green":
            valorFinal = stake * (odds - 1);
            ganhoTotal += valorFinal;
            totalGreen++;
            break;
          case "red":
            valorFinal = -stake;
            perdaTotal += stake;
            totalRed++;
            break;
          case "meio-green":
            valorFinal = (stake / 2) * (odds - 1);
            ganhoTotal += valorFinal;
            totalGreen++;
            break;
          case "meio-red":
            valorFinal = -stake / 2;
            perdaTotal += stake / 2;
            totalRed++;
            break;
          case "reembolso":
            valorFinal = 0;
            totalReembolso++;
            break;
          case "aguardando":
            valorFinal = 0;
            totalAguardando++;
            break;
        }

        const statusClass = getStatusClass(aposta.resultado);
        const statusText = getStatusText(aposta.resultado);
        const valorFinalText = valorFinal === 0 ? "" : ` (${formatarMoeda(valorFinal)})`;
        let dataFormatada = "Data não disponível";

        if (aposta.timestamp) {
          if (typeof aposta.timestamp.toDate === 'function') {
            dataFormatada = aposta.timestamp.toDate().toLocaleString('pt-BR');
          } else if (aposta.timestamp instanceof Date) {
            dataFormatada = aposta.timestamp.toLocaleString('pt-BR');
          } else if (aposta.timestamp.seconds) {
            dataFormatada = new Date(aposta.timestamp.seconds * 1000).toLocaleString('pt-BR');
          }
        }

        // Adicionar botões de edição para apostas com status "aguardando"
        let botoesEdicao = '';
        if (aposta.resultado === 'aguardando') {
          botoesEdicao = `
            <div class="botoes-edicao">
              <button class="botao-green" onclick="atualizarResultado('${aposta.id}', 'green')">Green</button>
              <button class="botao-meio-green" onclick="atualizarResultado('${aposta.id}', 'meio-green')">Meio Green</button>
              <button class="botao-red" onclick="atualizarResultado('${aposta.id}', 'red')">Red</button>
              <button class="botao-meio-red" onclick="atualizarResultado('${aposta.id}', 'meio-red')">Meio Red</button>
              <button class="botao-reembolso" onclick="atualizarResultado('${aposta.id}', 'reembolso')">Reembolso</button>
            </div>
          `;
        }
        
        apostaItem.innerHTML = `
          <div class="aposta-info">
            <strong>${aposta.liga}</strong> · <span class="${statusClass}">${statusText}${valorFinalText}</span><br>
            ${aposta.jogador1} vs ${aposta.jogador2}<br>
            <small>${aposta.mercado} · Stake: ${formatarMoeda(stake)} · Odds: ${odds}</small><br>
            <small>${dataFormatada}</small>
            ${botoesEdicao}
          </div>
          <div class="aposta-actions">
            <button onclick="removerAposta('${aposta.id}')">Remover</button>
          </div>
        `;

        apostasLista.appendChild(apostaItem);
      });

      // Atualizar resumo
      document.getElementById("ganho-total").textContent = formatarMoeda(ganhoTotal);
      document.getElementById("perda-total").textContent = formatarMoeda(perdaTotal);
      document.getElementById("saldo-total").textContent = formatarMoeda(ganhoTotal - perdaTotal);
      
      // Atualizar contadores de status
      document.getElementById("total-green").textContent = totalGreen;
      document.getElementById("total-red").textContent = totalRed;
      document.getElementById("total-reembolso").textContent = totalReembolso;
      document.getElementById("total-aguardando").textContent = totalAguardando;

      // Criar gráfico inicial com 7 dias
      criarGrafico(7);
    }

    // Modificar a função carregarApostas para usar getDocs em vez de onSnapshot
    async function carregarApostas() {
      const apostasLista = document.getElementById("apostas-lista");
      apostasLista.innerHTML = '<div class="loading">Carregando apostas...</div>';

      try {
        console.log("Carregando apostas para usuário:", currentUser);
        
        // Verificar se a banca inicial está definida
        if (!bancaInicial || bancaInicial <= 0) {
          const bancaSalva = localStorage.getItem('bancaInicial_' + currentUser);
          if (bancaSalva) {
            bancaInicial = parseFloat(bancaSalva);
            document.getElementById('banca-inicial').value = bancaInicial;
            calcularValorUnidade();
            console.log("Banca inicial carregada no carregarApostas:", bancaInicial);
          }
        }

        // Consulta com filtro por usuário atual
        const apostasRef = query(
          collection(db, "apostas"),
          where("userEmail", "==", currentUser),
          orderBy("timestamp", "desc")
        );

        const snapshot = await getDocs(apostasRef);
        console.log(`Consulta realizada, encontradas ${snapshot.size} apostas`);

        todasApostas = [];
        snapshot.forEach(doc => {
          console.log("Documento:", doc.id, doc.data());
          todasApostas.push({ id: doc.id, ...doc.data() });
        });

        atualizarInterfaceApostas();

      } catch (error) {
        console.error("Erro ao carregar apostas:", error);
        apostasLista.innerHTML = `<div style="text-align: center; padding: 15px; color: #888;">
          Erro ao carregar apostas: ${error.message}. Tente recarregar a página.
        </div>`;
      }
    }

    function getStatusText(resultado) {
      const statusMap = {
        'green': 'Green',
        'red': 'Red',
        'meio-green': '½ Green',
        'meio-red': '½ Red',
        'reembolso': 'Reembolso',
        'aguardando': 'Aguardando'
      };
      return statusMap[resultado] || resultado;
    }

    function getStatusClass(resultado) {
      const statusMap = {
        'green': 'status-green',
        'red': 'status-red',
        'meio-green': 'status-green',
        'meio-red': 'status-red',
        'reembolso': 'status-green',
        'aguardando': 'status-blue'
      };
      return statusMap[resultado] || 'status-green';
    }
    
    // Função para calcular o valor da unidade
    function calcularValorUnidade() {
      valorUnidade = bancaInicial / 10;
      document.getElementById('valor-unidade').textContent = formatarMoeda(valorUnidade);
    }
    
    // Função para atualizar resultado de uma aposta
    window.atualizarResultado = async function(id, novoResultado) {
      try {
        const apostaRef = doc(db, "apostas", id);
        await setDoc(apostaRef, { resultado: novoResultado }, { merge: true });
        console.log("Resultado atualizado com sucesso!");
        await carregarApostas();
      } catch (error) {
        console.error("Erro ao atualizar resultado:", error);
        alert("Erro ao atualizar resultado: " + error.message);
      }
    };

    async function updateChartPeriod(days) {
      // Update period buttons
      document.querySelectorAll('.period-button').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.days == days) {
          btn.classList.add('active');
        }
      });

      // Update chart title with dynamic period
      const periodText = days === 7 ? '7 dias' :
        days === 15 ? '15 dias' :
          days === 30 ? '30 dias' :
            days === 45 ? '45 dias' :
              days === 60 ? '60 dias' : `${days} dias`;

      document.getElementById('chart-period-title').textContent = `Desempenho (${periodText})`;

      // Create chart
      criarGrafico(days);
    }

    function criarGrafico(dias, dataInicial = null, dataFinal = null) {
      const graficoDiv = document.getElementById("grafico");
      graficoDiv.innerHTML = "";

      // Criar canvas para o Chart.js
      const ctx = document.createElement("canvas");
      graficoDiv.appendChild(ctx);

      // Definir período
      let startDate, endDate;
      if (dataInicial && dataFinal) {
        startDate = new Date(dataInicial);
        startDate.setHours(0, 0, 0, 0);
        endDate = new Date(dataFinal);
        endDate.setHours(23, 59, 59, 999);
      } else {
        endDate = new Date();
        endDate.setHours(23, 59, 59, 999);
        startDate = new Date();
        startDate.setDate(endDate.getDate() - (dias - 1));
        startDate.setHours(0, 0, 0, 0);
      }

      // Gerar array de datas
      const datas = [];
      const currentDate = new Date(startDate);
      while (currentDate <= endDate) {
        datas.push(new Date(currentDate));
        currentDate.setDate(currentDate.getDate() + 1);
      }

      // Calcular saldos diários
      const saldosDiarios = datas.map((data) => {
        const dataStr = data.toLocaleDateString("pt-BR");
        const inicioDoDia = new Date(data);
        inicioDoDia.setHours(0, 0, 0, 0);
        const fimDoDia = new Date(data);
        fimDoDia.setHours(23, 59, 59, 999);

        // Filtrar apostas para este dia
        const apostasDoDia = todasApostas.filter((aposta) => {
          // Tratar different formatos de timestamp (Firestore)
          let dataAposta = null;
          if (aposta.timestamp) {
            if (typeof aposta.timestamp.toDate === 'function') {
              dataAposta = aposta.timestamp.toDate();
            } else if (aposta.timestamp instanceof Date) {
              dataAposta = aposta.timestamp;
            } else if (aposta.timestamp.seconds) {
              dataAposta = new Date(aposta.timestamp.seconds * 1000);
            }
          }

          if (!dataAposta) return false;
          return dataAposta >= inicioDoDia && dataAposta <= fimDoDia;
        });

        // Calcular saldo para o dia
        let saldoDoDia = 0;
        apostasDoDia.forEach((aposta) => {
          const stake = parseFloat(aposta.stake?.toString().replace(/[^\d.,]/g, "").replace(",", ".") || 0);
          const odds = parseFloat(aposta.odds?.toString().replace(",", ".") || 0);

          switch (aposta.resultado) {
            case "green":
              saldoDoDia += stake * (odds - 1);
              break;
            case "red":
              saldoDoDia -= stake;
              break;
            case "meio-green":
              saldoDoDia += (stake / 2) * (odds - 1);
              break;
            case "meio-red":
              saldoDoDia -= stake / 2;
              break;
            case "reembolso":
              // Não altera o saldo
              break;
          }
        });

        return {
          data: dataStr,
          saldo: saldoDoDia,
        };
      });

      // Preparar dados para o gráfico
      const labels = saldosDiarios.map((item) => item.data);
      const dados = saldosDiarios.map((item) => item.saldo);

      // Criar gradiente para o fundo do gráfico
      const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 400);
      gradient.addColorStop(0, 'rgba(0, 255, 100, 0.3)');
      gradient.addColorStop(1, 'rgba(0, 255, 100, 0)');

      // Destruir gráfico anterior se existir
      if (chart) {
        chart.destroy();
      }

      // Criar gráfico
      chart = new Chart(ctx, {
        type: "line",
        data: {
          labels: labels,
          datasets: [
            {
              label: "Saldo Diário",
              data: dados,
              borderColor: "rgb(0, 255, 100)",
              backgroundColor: gradient,
              borderWidth: 3,
              pointBackgroundColor: "#03dac6",
              pointRadius: 5,
              pointHoverRadius: 7,
              tension: 0.4,
              fill: true,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          aspectRatio: 2,
          animation: {
            duration: 1000,
            easing: 'easeInOutQuart',
          },
          plugins: {
            legend: {
              display: false,
            },
            tooltip: {
              backgroundColor: "rgba(10, 14, 23, 0.95)",
              titleColor: "rgb(0, 255, 100)",
              bodyColor: "#e0e0e0",
              borderColor: "rgb(0, 255, 100)",
              borderWidth: 1,
              padding: 12,
              cornerRadius: 8,
              titleFont: {
                size: 14,
                weight: 'bold'
              },
              bodyFont: {
                size: 13
              },
              callbacks: {
                label: function (context) {
                  return "Saldo: " + formatarMoeda(context.raw);
                },
              },
            },
          },
          scales: {
            y: {
              grid: {
                color: "rgba(255, 255, 255, 0.1)",
                drawBorder: false,
                zeroLineColor: "rgba(255, 255, 255, 0.2)"
              },
              ticks: {
                color: "#e0e0e0",
                padding: 10,
                font: {
                  size: 12
                },
                callback: function (value) {
                  return formatarMoeda(value);
                },
                stepSize: 5, // Define o intervalo de 5 em 5 reais
              },
            },
            x: {
              grid: {
                display: false
              },
              ticks: {
                color: "#e0e0e0",
                padding: 8,
                font: {
                  size: 12
                },
                maxRotation: 45,
                minRotation: 45
              },
            },
          },
        },
      });
    }

    // Função para mapear liga da API para o select
    function mapearLiga(ligaNome) {
      // Primeiro verificar H2H para não conflitar com Battle 8 min normal
      if (ligaNome.includes("8 mins") && ligaNome.includes("H2H")) return "Battle 8 min (H2H)";
      if (ligaNome.includes("6 mins")) return "Battle 6 min";
      if (ligaNome.includes("8 mins")) return "Battle 8 min";
      if (ligaNome.includes("10 mins")) return "Adriact 10 min";
      if (ligaNome.includes("12 mins")) return "GT 12 min";
      return "Outro";
    }

    // Função para extrair nome do jogador
    function extrairNomeJogador(texto) {
      const match = texto.match(/\(([^)]+)\)/);
      return match ? match[1].trim() : texto.trim();
    }

    // Função para buscar jogadores da API
    async function buscarDadosAPI() {
      try {
        const response = await fetch('https://api.green365.com.br/api/events/ended?sport_id=4&competition_id=&page=1');
        const data = await response.json();

        if (data && data.data) {
          const jogadoresPorLiga = {};

          data.data.forEach(match => {
            const ligaOriginal = match.leagueName;
            const liga = mapearLiga(ligaOriginal);

            // Inicializar o Set para a liga se não existir
            if (!jogadoresPorLiga[liga]) {
              jogadoresPorLiga[liga] = new Set();
            }

            // Adicionar jogadores apenas se a liga for mapeada corretamente
            if (liga !== "Outro") {
              if (match.home) {
                const jogador = extrairNomeJogador(match.home);
                jogadoresPorLiga[liga].add(jogador);
              }
              if (match.away) {
                const jogador = extrairNomeJogador(match.away);
                jogadoresPorLiga[liga].add(jogador);
              }
            }
          });

          // Atualizar cache
          jogadoresCache = jogadoresPorLiga;

          // Criar e atualizar datalists
          atualizarDatalistsJogadores();
        }
      } catch (error) {
        console.error("Erro ao buscar dados da API:", error);
      }
    }

    // Função para atualizar datalists dos jogadores
    function atualizarDatalistsJogadores() {
      const liga = document.getElementById("liga").value;
      const jogadores = jogadoresCache[liga] || new Set();

      // Criar ou atualizar datalist
      let datalist = document.getElementById("jogadores-lista");
      if (!datalist) {
        datalist = document.createElement("datalist");
        datalist.id = "jogadores-lista";
        document.body.appendChild(datalist);
      }

      // Limpar e preencher datalist
      datalist.innerHTML = "";
      Array.from(jogadores).sort().forEach(jogador => {
        const option = document.createElement("option");
        option.value = jogador;
        datalist.appendChild(option);
      });

      // Conectar inputs ao datalist
      const jogador1 = document.getElementById("jogador1");
      const jogador2 = document.getElementById("jogador2");
      jogador1.setAttribute("list", "jogadores-lista");
      jogador2.setAttribute("list", "jogadores-lista");
    }

    // Event Listeners
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        // Verificar login
        if (!checkUserLogin()) return;

        // Inicializar a página
        setupTabs();
        await carregarMercados();

        // SOLUÇÃO: Tentar carregar as apostas com atraso maior e com retry
        let retryCount = 0;
        const maxRetries = 3;

        const tryLoadApostas = () => {
          setTimeout(async () => {
            try {
              console.log(`Tentativa ${retryCount + 1} de carregar apostas...`);

              // Carregar apostas diretamente com getDocs em vez de onSnapshot
              const apostasRef = query(
                collection(db, "apostas"),
                where("userEmail", "==", currentUser),
                orderBy("timestamp", "desc")
              );

              const snapshot = await getDocs(apostasRef);

              if (snapshot.empty) {
                console.log("Nenhuma aposta encontrada");
                document.getElementById("apostas-lista").innerHTML =
                  '<div style="text-align: center; padding: 15px; color: #888;">Nenhuma aposta registrada</div>';
                return;
              }

              console.log(`Encontradas ${snapshot.size} apostas`);

              // Processar as apostas manualmente
              todasApostas = [];
              snapshot.forEach(doc => {
                todasApostas.push({ id: doc.id, ...doc.data() });
              });

              // Atualizar a interface com as apostas carregadas
              atualizarInterfaceApostas();

            } catch (error) {
              console.error("Erro ao carregar apostas:", error);
              if (retryCount < maxRetries) {
                retryCount++;
                console.log(`Tentando novamente em ${1000 * retryCount}ms...`);
                tryLoadApostas();
              }
            }
          }, 1000 * (retryCount + 1));  // Tempo progressivo: 1s, 2s, 3s
        };

        // Iniciar tentativas de carregamento
        tryLoadApostas();

        await buscarDadosAPI();
      } catch (error) {
        console.error("Erro ao carregar a página:", error);
      }
    });

    // Adicionar evento para atualizar jogadores quando mudar a liga
    document.getElementById("liga").addEventListener("change", () => {
      atualizarDatalistsJogadores();
    });

    // Form de apostas
    document.getElementById("bet-form").addEventListener("submit", async (e) => {
      e.preventDefault();

      const formData = {
        liga: document.getElementById("liga").value,
        jogador1: document.getElementById("jogador1").value,
        jogador2: document.getElementById("jogador2").value,
        mercado: document.getElementById("mercado").value,
        stake: parseFloat(document.getElementById("stake").value.replace(',', '.')),
        odds: parseFloat(document.getElementById("odds").value.replace(',', '.')),
        resultado: document.getElementById("resultado").value,
        userEmail: currentUser,
        timestamp: serverTimestamp()
      };

      try {
        await addDoc(collection(db, "apostas"), formData);

        // Limpar formulário
        e.target.reset();
        document.getElementById("resultado-final").textContent = formatarMoeda(0);

        await carregarApostas();
      } catch (error) {
        console.error("Erro ao salvar aposta:", error);
        alert("Erro ao salvar aposta: " + error.message);
      }
    });

    // Form de mercados
    document.getElementById("market-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const novoMercado = document.getElementById("novo-mercado").value.trim();
      if (novoMercado) {
        await adicionarMercado(novoMercado);
      }
    });

    // Remover mercado
    document.addEventListener("click", async (e) => {
      if (e.target.closest(".remove-button:not(.remove-bet)")) {
        const button = e.target.closest(".remove-button");
        await removerMercado(button.dataset.id);
      }
    });

    // Cálculo dinâmico do resultado
    ["stake", "odds", "resultado"].forEach(id => {
      document.getElementById(id).addEventListener("input", atualizarValorFinal);
    });

    // Event listeners para os botões de período
    document.querySelectorAll('.period-button').forEach(button => {
      button.addEventListener('click', (e) => {
        if (!e.target.dataset.days) return;
        const days = parseInt(e.target.dataset.days);
        updateChartPeriod(days);
      });
    });

    // Add event listeners for date inputs
    document.getElementById('start-date').addEventListener('change', handleDateChange);
    document.getElementById('end-date').addEventListener('change', handleDateChange);

    document.getElementById('clear-date-range').addEventListener('click', () => {
      // Clear date inputs
      document.getElementById('start-date').value = '';
      document.getElementById('end-date').value = '';

      // Set 7 days as active period
      document.querySelectorAll('.period-button').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.days === '7') {
          btn.classList.add('active');
        }
      });

      // Update chart title and recreate chart for 7 days
      document.getElementById('chart-period-title').textContent = 'Desempenho (7 dias)';
      criarGrafico(7);
    });

    function handleDateChange() {
      const startDate = document.getElementById('start-date').value;
      const endDate = document.getElementById('end-date').value;

      if (startDate && endDate) {
        // Remove active from all period buttons
        document.querySelectorAll('.period-button').forEach(btn =>
          btn.classList.remove('active'));

        // Update chart title with custom date range
        const start = new Date(startDate);
        const end = new Date(endDate);

        // Validate date range
        if (end < start) {
          alert('A data final não pode ser anterior à data inicial');
          return;
        }

        document.getElementById('chart-period-title').textContent =
          `Desempenho (${start.toLocaleDateString()} - ${end.toLocaleDateString()})`;

        criarGrafico(null, startDate, endDate);
      }
    }

    // Defina os mapeamentos de dias da semana e meses em português
    Chart.defaults.locale = 'pt-BR';
    Chart.register({
      id: 'pt-BR',
      locale: {
        date: {
          months: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'],
          shortMonths: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
          days: ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'],
          shortDays: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb']
        }
      }
    });
  </script>
</body>

</html>